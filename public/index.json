




[{"content":"","date":"2 mars 2025","externalUrl":null,"permalink":"/blog-cyber/","section":"Jaybird1291","summary":"","title":"Jaybird1291","type":"page"},{"content":"\rSc√©nario #\rUn employ√© informatique d‚ÄôInfiniTech Solutions a signal√© une activit√© inhabituelle associ√©e √† son compte e-mail. Lors de l‚Äôinvestigation, il a √©t√© d√©couvert que les identifiants professionnels de l‚Äôemploy√© avaient √©t√© divulgu√©s lors d‚Äôune r√©cente fuite de donn√©es.\nL‚Äôemploy√© avait utilis√© son adresse mail professionnelle pour s‚Äôinscrire sur une plateforme tierce, ce qui a expos√© ses identifiants. Des acteurs malveillants ont exploit√© ces identifiants pour se connecter au compte mail de l‚Äôemploy√© et envoyer des e-mails de phishing √† d‚Äôautres employ√©s de l‚Äôorganisation.\nVotre t√¢che est d‚Äôenqu√™ter sur cet incident en analysant les logs, en d√©terminant l‚Äô√©tendue de l‚Äôattaque, en identifiant si des utilisateurs ont interagi avec les mails de phishing, et en d√©couvrant l‚Äôimpact de la campagne de phishing sur le r√©seau.\nSetup #\rPour ce sc√©nario d\u0026rsquo;investigation, nous allons principalement utiliser Splunk Search pour analyser les logs. En compl√©ment, nous utiliserons d‚Äôautres outils tels que xml.onlineviewer, Cyberchef ainsi que VirusTotal.\nRappels #\rSplunk est une plateforme d‚Äôanalyse qui permet de collecter, indexer et rechercher des donn√©es g√©n√©r√©es par des syst√®mes, applications et √©quipements r√©seau. Il r√©cup√®re ses logs via divers m√©canismes tels que des agents install√©s sur les endpoints, l‚Äôingestion de fichiers de logs ou encore des API.\nUne fois collect√©es, les donn√©es sont index√©es, ce qui permet de les organiser et de faciliter la recherche. Splunk utilise le langage de recherche SPL (Search Processing Language) pour interroger ces donn√©es.\nInitial Access #\rQuestion 1 #\rQuel compte de messagerie a √©t√© compromis et utilis√© pour lancer l\u0026rsquo;attaque ?\nPremi√®rement, v√©rifions les \u0026ldquo;sourcetype\u0026rdquo; disponibles sur notre\nindex=\u0026#34;main\u0026#34; | stats count by sourcetype Les sourcetypes dans Splunk sont des √©tiquettes qui indiquent le type de donn√©es ou l\u0026rsquo;origine des √©v√©nements collect√©s.\nPour r√©pondre √† cette question, on va se focus sur les \u0026ldquo;syslog\u0026rdquo; premi√®rement. En effet, les syslog regroupent les logs g√©n√©r√©s par divers √©quipements et contiennent g√©n√©ralement des informations d√©taill√©es sur les activit√©s syst√®me et de s√©curit√©.\nPour aller plus vite et √©viter de s\u0026rsquo;inonder d\u0026rsquo;informations, on va chercher avec un regex pour uniquement afficher les adresses mails :\n* sourcetype=syslog | regex _raw=\u0026#34;[\\w\\.-]+@[\\w\\.-]+\\.\\w+\u0026#34; On voit beaucoup de logs, pour nous faciliter la t√¢che, on va compter combien de fois chaque adresse mail appara√Æt et afficher les r√©sultats sous forme de tableau :\n* sourcetype=syslog | rex field=_raw \u0026#34;(?\u0026lt;email\u0026gt;[\\w\\.-]+@[\\w\\.-]+\\.\\w+)\u0026#34; | stats count by email | sort -count | head 10 | rename count AS \u0026#34;Number of occurrences\u0026#34;, email AS \u0026#34;Email address\u0026#34; On peut m√™me visualiser √ßa sous forme de graphique :\nR√©ponse : twhite@infinitechsolutions.xyz\nQuestion 2 #\rApr√®s avoir identifi√© le compte compromis, l\u0026rsquo;attaquant a envoy√© des mails de phishing √† d\u0026rsquo;autres employ√©s de l\u0026rsquo;entreprise. Quels sont les noms de ces employ√©s, class√©s par ordre chronologique et s√©par√©s par des virgules ?\nLe formatage de log d\u0026rsquo;envoi de mail est comme cela :\nUser [email_exp√©diteur] [adresse_IP]; Message [ID_message] for [email_destinataire] Pour la recherche on va donc faire :\n* sourcetype=syslog \u0026#34;User twhite@infinitechsolutions.xyz\u0026#34; | rex field=_raw \u0026#34;Message \u0026lt;[^\u0026gt;]+\u0026gt; for (?\u0026lt;recipient\u0026gt;[\\w\\.-]+@[\\w\\.-]+\\.\\w+)\u0026#34; | table _time recipient | sort _time | stats list(recipient) as recipients | eval recipients=mvjoin(recipients, \u0026#34;, \u0026#34;) Cette requ√™te nous permet d\u0026rsquo;identifier et lister chronologiquement les destinataires en question.\nEn effet, on y s√©lectionne le user du compte compromis et on utilise un regex pour extraire et stocker dans une variable l\u0026rsquo;adresse mail du destinataire.\nEnsuite, on trie les r√©sultats par ordre chronologique et on format le r√©sultat pour que √ßa soit bien lisible.\nR√©ponse : rnichols,llopez,gbaker,ahall\nQuestion 3 #\rQuel est le nom de la pi√®ce jointe malveillante envoy√©e depuis le compte compromis ?\nCette question m\u0026rsquo;a pos√© plus de probl√®me que ce que √† quoi je m\u0026rsquo;attendais. En effet, premi√®rement j\u0026rsquo;ai cherch√© :\n* sourcetype=syslog \u0026#34;User twhite@infinitechsolutions.xyz\u0026#34; | regex _raw=\u0026#34;for (rnichols|llopez|gbaker|ahall)@infinitechsolutions\\.xyz\u0026#34; N√©anmoins aucune trace de pi√®ce jointe. Je me suis donc dit \u0026ldquo;mhmm je ne dois pas √™tre sur le bon sourcetype, je vais rechercher les autres.\u0026rdquo;\nJ\u0026rsquo;ai donc recherch√© :\nindex=* \u0026#34;twhite@infinitechsolutions.xyz\u0026#34; | stats count by sourcetype Uniquement syslog, je suis donc sur le bon sourcetype. Je continue donc √† r√©fl√©chir et je me dis \u0026ldquo;je vais bypass le probl√®me de formatage et simplement chercher des extensions de fichier\u0026rdquo;\nJe demande donc √† ChatGPT de me faire une liste d\u0026rsquo;extension et je me retrouve avec cette requ√™te :\nindex=* sourcetype=syslog twhite@infinitechsolutions.xyz | rex field=_raw \u0026#34;attachment=(?\u0026lt;malicious_attachment\u0026gt;[\\w\\.-]+\\.(exe|zip|pdf|docx|xlsm|js|vbs|scr|bat))\u0026#34; | table _time malicious_attachment | sort _time Toujours rien, pas de pi√®ce jointe.\n√âtant toujours bloqu√©, j\u0026rsquo;ai d√©cid√© de r√©fl√©chir diff√©remment. Le titre du lab est \u0026ldquo;Midnight RDP\u0026rdquo;, ce qui me fait penser √† l\u0026rsquo;APT nomm√©e \u0026ldquo;Midnight Blizzard\u0026rdquo;.\nDans mes recherches, je suis tomb√© sur un article intitul√© \u0026ldquo;How Midnight Blizzard Uses Malicious .RDP Files to Exploit Windows Systems: A Technical Guide\u0026rdquo; (Yua Mikanana).\nBon, au vu du nom du lab, c\u0026rsquo;est √©vident. Je cherche donc \u0026ldquo;.RDP\u0026rdquo; et j\u0026rsquo;obtiens le fichier :\nR√©ponse : cloud zerotrust compliance.rdp\nExecution #\rQuestion 1 #\rApr√®s avoir analys√© les interactions des utilisateurs, quel employ√© a t√©l√©charg√© et ex√©cut√© la pi√®ce jointe malveillante ?\nOn change de sourcetype, on passe sur les WinEventLog.\nLes WinEventLog correspondent aux journaux d\u0026rsquo;√©v√©nements de Windows, qui enregistrent diverses activit√©s du syst√®me (comme les erreurs, les avertissements, les informations de s√©curit√© ou les activit√©s applicatives) pour permettre un suivi et une analyse des √©v√©nements sur un syst√®me Windows.\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; cloud zerotrust compliance.rdp On voit donc bien le username de l\u0026rsquo;utilisateur qui a t√©l√©charg√© ce fichier : C:\\Users\\rnichols\\Downloads\\cloud zerotrust compliance.rdp\nR√©ponse : rnichols\nQuestion 2 #\rSur la machine DC, une balise DLL a √©t√© ex√©cut√©e par l\u0026rsquo;attaquant en m√©moire. Quels sont les 10 premiers octets du hachage SHA-256 de ce fichier DLL malveillant ?\nPremi√®rement, listons les DLL ayant un lien avec PowerShell sur le DC :\nindex=* sourcetype=xmlwineventlog \u0026#34;Powershell\u0026#34; | search host=\u0026#34;DC01\u0026#34; | rex field=_raw \u0026#34;(?\u0026lt;file\u0026gt;\\b\\w{6,8}\\.\\w{3}\\b)\u0026#34; | search file=\u0026#34;*dll\u0026#34; On remarque que le script complet est trop long pour √™tre enregistr√© en un seul √©v√©nement. Il est donc d√©coup√© en segments. On peut le voir gr√¢ce au MessageNumber :\nLes deux √©v√©nements partagent le m√™me ActivityID {0B39225B-3C43-0001-5078-390B433CDB01} ainsi que d‚Äôautres identifiants, ce qui montre qu‚Äôils appartiennent √† la m√™me ex√©cution de script.\nLe premier segment (MessageNumber = 1) contient le d√©but du script, incluant la configuration de l‚Äôenvironnement PowerShell et la d√©finition de fonctions telles que func_get_proc_address et func_get_delegate_type.\nLe dernier segment (MessageNumber = 33) contient la fin du script, notamment la partie qui effectue le d√©codage d‚Äôune cha√Æne Base64 (XOR√©e avec la cl√© 35) et qui alloue de la m√©moire pour ex√©cuter le code d√©cod√©.\nEnsemble, ces segments reconstituent l‚Äôint√©gralit√© d‚Äôun payload qui cherche vraisemblablement √† injecter et ex√©cuter du code en m√©moire.\nLe script, une fois reconstitu√©, d√©code un payload obfusqu√© (d‚Äôabord en Base64, puis XOR√© avec 35) et utilise des fonctions Windows natives (comme VirtualAlloc via GetProcAddress et GetDelegateForFunctionPointer) pour allouer de la m√©moire et ex√©cuter le code malveillant.\n[...] $var [...] -bxor 35 [...] On peut le reconstituer via une recherche Splunk :\nindex=* sourcetype=xmlwineventlog EventID=4104 0B39225B-3C43-0001-5078-390B433CDB01 | stats values(ScriptBlockText) as Script by SystemTime | table Script On peut ensuite d√©sencoder le script via Cyberchef :\nOn retrouve notre DLL en question :\nEnfin, on extrait le fichier et on r√©cup√®re son hash :\nR√©ponse : 0ee6bc20a7f855d881cce962de09c77960ea5c85ca013e3d123fce61109ff8c5\nPersistence #\rQuestion 1 #\rApr√®s l\u0026rsquo;√©tablissement de la connexion malveillante, un fichier a √©t√© d√©pos√© sur le syst√®me. Quel est le nom de ce fichier d√©pos√© ?\nOn sait que le fichier .rdp a √©t√© ex√©cut√© vers 20:45:27 (cf. question 1 de la partie Execution).\nOn va donc chercher √† partir de ce moment-l√†.\nPremi√®rement, j\u0026rsquo;ai tent√© de rechercher dans Splunk des t√©l√©chargements via des commandes PowerShell (Invoke-WebRequest, curl, etc.), mais √ßa n\u0026rsquo;a rien donn√©.\nJ\u0026rsquo;ai donc modifi√© ma recherche :\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; \u0026#34;rnichols\u0026#34; | rex field=_raw \u0026#34;CommandLine=(?\u0026lt;CommandLine\u0026gt;.*)\u0026#34; | fillnull value=\u0026#34;\u0026#34; | search NOT CommandLine=\u0026#34;\u0026lt;/Data\u0026gt;\u0026lt;/EventData\u0026gt;\u0026lt;/Event\u0026gt;\u0026#34;,\u0026#34;\u0026#34; | stats values(CommandLine) as CommandLine by _time, ParentCommandLine | sort ‚Äî _time Alors pourquoi cela fonctionne ?\nVoici le d√©tail de l‚Äô√©v√©nement :\nLe champ TerminalSessionId=3 sugg√®re fortement que l\u0026rsquo;utilisateur √©tait connect√© via une session RDP, car :\nLa session 0 est souvent utilis√©e par SYSTEM. Les sessions interactives locales commencent g√©n√©ralement √† 1. Les sessions RDP prennent souvent des ID plus √©lev√©s (2, 3, etc.). explorer.exe est le processus principal de l‚Äôinterface graphique Windows et agit comme un lanceur pour les programmes d√©marr√©s par un utilisateur interactif.\nSc√©narios possibles expliquant ce comportement :\nSession interactive (RDP ou non) : Si rnichols s\u0026rsquo;est connect√© via RDP, explorer.exe s‚Äôest lanc√© en tant que shell utilisateur et a ex√©cut√© les programmes d√©finis dans Startup (ztssvc.exe). Cette situation se produit m√™me sans RDP si l‚Äôutilisateur se connecte physiquement ou via un service comme runas. Ex√©cution automatique au d√©marrage de l\u0026rsquo;utilisateur : ztssvc.exe √©tant dans Startup, il est ex√©cut√© d√®s que l\u0026rsquo;utilisateur se connecte (que ce soit en local ou via RDP). Injection ou Persistance via explorer.exe : Si un attaquant a persist√© un malware via Startup, explorer.exe va automatiquement ex√©cuter ce binaire d√®s qu\u0026rsquo;un utilisateur se connecte. Exploit ou Ex√©cution forc√©e par un attaquant : Si explorer.exe a √©t√© compromis (via injection DLL ou autre technique), il aurait pu √™tre utilis√© pour ex√©cuter ztssvc.exe. R√©ponse : ztssvc.exe\nQuestion 2 #\rPour conserver un acc√®s √† long terme, l\u0026rsquo;attaquant a cr√©√© une t√¢che planifi√©e sur la machine compromise. Quel est le nom de cette t√¢che ?\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; EventCode=4698 OR EventCode=4702 | search user=\u0026#34;rnichols\u0026#34; | table _time EventCode TaskName Command User | rename EventCode as \u0026#34;Event ID\u0026#34;, TaskName as \u0026#34;Scheduled Task\u0026#34;, Command as \u0026#34;Executed Command\u0026#34; | sort _time Question 3 #\rDans le cadre de sa strat√©gie de persistance, l\u0026rsquo;attaquant a cr√©√© un nouveau compte utilisateur. Quel est le nom de ce compte non autoris√© ?\nToujours avec la m√™me requ√™te que pour la question 1 :\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; \u0026#34;rnichols\u0026#34; | rex field=_raw \u0026#34;CommandLine=(?\u0026lt;CommandLine\u0026gt;.*)\u0026#34; | fillnull value=\u0026#34;\u0026#34; | search NOT CommandLine=\u0026#34;\u0026lt;/Data\u0026gt;\u0026lt;/EventData\u0026gt;\u0026lt;/Event\u0026gt;\u0026#34;,\u0026#34;\u0026#34; | stats values(CommandLine) as CommandLine by _time, ParentCommandLine | sort ‚Äî _time On peut y trouver une commande PowerShell encod√©e qui para√Æt tr√®s suspecte :\nOn prend cette commande et on la d√©code via Cyberchef :\nR√©ponse : Administrator\nQuestion 4 #\rPour faciliter l\u0026rsquo;acc√®s √† distance, l\u0026rsquo;attaquant a modifi√© les param√®tres du bureau √† distance. Quel est le nom de la cl√© de registre qui d√©termine si les connexions RDP (Remote Desktop Protocol) sont autoris√©es ?\nAyant d√©j√† investigu√© et administr√© pas mal de Windows, je connaissais d√©j√† la r√©ponse. N√©anmoins, voici comment la trouver :\nOn recherche toujours les commandes PowerShell avec -EncodedCommand, car l\u0026rsquo;attaquant en a ex√©cut√© plusieurs :\nOn y trouve cette commande :\nR√©ponse : fDenyTSConnections\nQuestion 5 #\rDes recherches suppl√©mentaires ont r√©v√©l√© la cr√©ation d\u0026rsquo;un nouveau compte d\u0026rsquo;utilisateur sur le DC. Quel est le nom de ce compte ?\nOn peut supposer que cela a √©t√© fait de la m√™me mani√®re que sur l\u0026rsquo;autre host. On recherche donc :\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; host=\u0026#34;DC01\u0026#34; \u0026#34;-EncodedCommand\u0026#34; R√©ponse : rniclos\nPrivilege Escalation #\rQuestion 1 #\rEn examinant la technique d\u0026rsquo;escalade de privil√®ge, quels sont les 6 derniers octets du CLSID de l\u0026rsquo;interface COM privil√©gi√©e que l\u0026rsquo;attaquant a exploit√©e ?\nLe CLSID est un identifiant unique global (GUID) utilis√© par Windows COM (Component Object Model) pour identifier des objets COM dans le registre.\nLes attaquants utilisent des CLSID de COM Interfaces privil√©gi√©es pour ex√©cuter du code avec des privil√®ges √©lev√©s :\nIls exploitent des COM Objects mal configur√©s pour escalader leurs privil√®ges. Un attaquant peut cr√©er, manipuler ou appeler une interface COM privil√©gi√©e* via regsvr32.exe, powershell, mshta.exe ou rundll32.exe. Ici, on sait que le malware est ztssvc.exe. On va donc rechercher tout EventCode \u0026ldquo;1\u0026rdquo; (cr√©ation de processus) li√© √† l\u0026rsquo;ex√©cution de ztssvc.exe et filtrer uniquement sur les IntegrityLevel \u0026ldquo;High\u0026rdquo; :\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; EventCode=1 | search Image=\u0026#34;*ztssvc.exe*\u0026#34; | search IntegrityLevel=\u0026#34;High\u0026#34; | table _time User CommandLine IntegrityLevel ParentCommandLine | sort _time R√©ponse : 7CE93B6DC937\nQuestion 2 #\rPour √©lever ses privil√®ges, l\u0026rsquo;attaquant a d√©pos√© un autre fichier sur le syst√®me. Quel est le nom de ce fichier ?\nOn refait la m√™me commande et on v√©rifie tout ce qui s\u0026rsquo;est pass√© apr√®s le t√©l√©chargement du premier fichier (ztssvc.exe) :\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; \u0026#34;rnichols\u0026#34; | rex field=_raw \u0026#34;CommandLine=(?\u0026lt;CommandLine\u0026gt;.*)\u0026#34; | fillnull value=\u0026#34;\u0026#34; | search NOT CommandLine=\u0026#34;\u0026lt;/Data\u0026gt;\u0026lt;/EventData\u0026gt;\u0026lt;/Event\u0026gt;\u0026#34;,\u0026#34;\u0026#34; | search NOT ParentCommandLine=\u0026#34;\u0026#34; | stats values(CommandLine) as CommandLine by _time, ParentCommandLine | sort ‚Äî _time R√©ponse : Akagi64.exe\nDefense Evasion #\rQuestion 1 #\rL\u0026rsquo;attaquant a cherch√© √† modifier le comportement du syst√®me pour affaiblir les param√®tres de s√©curit√©. Quel est le nom de la cl√© de registre qui r√©git les param√®tres de l\u0026rsquo;invite du Contr√¥le de compte d\u0026rsquo;utilisateur (UAC) pour les utilisateurs administratifs ?\nOn trouve la r√©ponse dans les commandes PowerShell encod√©es d√©j√† observ√©es :\nR√©ponse : ConsentPromptBehaviorAdmin\nQuestion 2 #\rPour √©viter d\u0026rsquo;√™tre d√©tect√©, l\u0026rsquo;attaquant a d√©plac√© la balise dans un r√©pertoire prot√©g√© du syst√®me. Quel est le nom de ce fichier malveillant d√©plac√© ?\nS‚Äôil y a eu d√©placement, il devrait y avoir un √©v√©nement de cr√©ation ou de renommage de fichier (Event ID 11 ou 2).\nindex=* sourcetype=xmlwineventlog EventCode=11 OR EventCode=2 \u0026#34;rnichols\u0026#34; | search TargetFilename=\u0026#34;C:\\\\Windows\\\\System32\\\\*\u0026#34; OR TargetFilename=\u0026#34;C:\\\\Windows\\\\SysWOW64\\\\*\u0026#34; OR TargetFilename=\u0026#34;C:\\\\ProgramData\\\\*\u0026#34; | table _time User TargetFilename ProcessName | sort _time R√©ponse : Amazon ZeroTrust Compl.exe\nDiscovery #\rQuestion 1 #\rEn d√©terminant la premi√®re action de l\u0026rsquo;attaquant sur la machine compromise, quelle a √©t√© la premi√®re commande ex√©cut√©e pour recueillir des informations sur le syst√®me ?\nSachant que la machine a √©t√© compromise √† 20:45:27 (cf. question 1 de la partie Execution), on va chercher √† partir de ce moment-l√† :\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; \u0026#34;rnichols\u0026#34; | rex field=_raw \u0026#34;CommandLine=(?\u0026lt;CommandLine\u0026gt;.*)\u0026#34; | fillnull value=\u0026#34;\u0026#34; | search NOT CommandLine=\u0026#34;\u0026lt;/Data\u0026gt;\u0026lt;/EventData\u0026gt;\u0026lt;/Event\u0026gt;\u0026#34;,\u0026#34;\u0026#34; | search NOT ParentCommandLine=\u0026#34;\u0026#34; | stats values(CommandLine) as CommandLine by _time, ParentCommandLine | sort ‚Äî _time R√©ponse : whoami /groups\nLateral Movement #\rQuestion 1 #\rQuel outil l\u0026rsquo;attaquant a-t-il utilis√© pour se d√©placer lat√©ralement vers le DC ?\nEncore une fois, on va devoir investiguer les commandes PowerShell encod√©es, cette fois-ci celles √©mises par Amazon ZeroTrust Compl.exe.\npowershell -nop -exec bypass -EncodedCommand UwBlAHQALQBJAHQAZQBtACAAVwBTAE0AYQBuADoAXABsAG8AYwBhAGwAaABvAHMAdABcAEMAbABpAGUAbgB0AFwAVAByAHUAcwB0AGUAZABIAG8AcwB0AHMAIAAtAFYAYQBsAHUAZQAgACIARABDADAAMQAuAGEAZAAuAGkAbgBmAGkAbgBpAHQAZQBjAGgAcwBvAGwAdQB0AGkAbwBuAHMALgB4AHkAegAiACAALQBGAG8AcgBjAGUA Cette commande modifie les param√®tres de Windows Remote Management (WinRM) sur IT01 pour faire confiance √† DC01.ad.infinitechsolutions.xyz pour les connexions distantes. C‚Äôest un bon indicateur de mouvement lat√©ral via PowerShell Remoting (WinRM).\nR√©ponse : WinRM\nCommand \u0026amp; Control #\rQuestion 1 #\rEn remontant le fil des activit√©s de l\u0026rsquo;attaquant, quelle √©tait l\u0026rsquo;adresse IP √† partir de laquelle les courriels malveillants ont √©t√© envoy√©s ?\nOn revient aux toutes premi√®res questions en cherchant le user qui a envoy√© le phishing :\nindex=* sourcetype=syslog \u0026#34;User twhite@infinitechsolutions.xyz\u0026#34; R√©ponse : 3.78.253.99\nQuestion 2 #\rPuisque cloud zerotrust compliance.rdp a √©t√© ex√©cut√© sur IT01 et qu‚Äôon conna√Æt l‚Äôadresse IP de l‚Äôexp√©diteur de mail, on peut tester directement :\nindex=* sourcetype=xmlwineventlog (EventCode=1 OR EventCode=3) | search host=\u0026#34;IT01\u0026#34; | search DestinationPort=3389 AND DestinationIp=3.78.253.99 | table _time User DestinationIp DestinationPort | sort _time R√©ponse : 3.78.253.99:3389\nQuestion 3 #\rL\u0026rsquo;analyse a r√©v√©l√© que le fichier d√©pos√© fonctionne comme une balise Cobalt Strike. Quel est le point de terminaison du serveur de commande et de contr√¥le (C\u0026amp;C) avec lequel cette balise communique ?\nPremi√®rement v√©rifions bien quel fichier est le Cobalt Strike beacon :\nEnsuite, on continue l\u0026rsquo;investigation en recherchant √† quelle IP/port s‚Äôest connect√© Amazon ZeroTrust Compl.exe :\nindex=* sourcetype=xmlwineventlog EventCode=3 | search Image=\u0026#34;*Amazon ZeroTrust Compl.exe*\u0026#34; | search NOT DestinationIp=\u0026#34;\u0026#34; | table _time User Image DestinationIp DestinationPort Protocol | sort _time (EventCode 3 correspond √† une connexion r√©seau √©tablie par un processus sur une machine Windows)\nR√©ponse : 3.78.244.11:8080\nQuestion 4 #\rEn examinant la configuration de la DLL, quelle valeur est associ√©e √† la cl√© \u0026lsquo;C2Server\u0026rsquo; qui dirige la communication de la balise ?\nOn retourne sur VirusTotal et on retrouve cette information dans l\u0026rsquo;onglet \u0026ldquo;Behavior\u0026rdquo;.\nR√©ponse : 3.78.244.11,/dot.gif\nLab termin√© !\n","date":"2 mars 2025","externalUrl":null,"permalink":"/blog-cyber/posts/midnight-rdp/","section":"Posts","summary":"Sc√©nario #\rUn employ√© informatique d‚ÄôInfiniTech Solutions a signal√© une activit√© inhabituelle associ√©e √† son compte e-mail.","title":"Midnight RDP Lab","type":"posts"},{"content":"","date":"2 mars 2025","externalUrl":null,"permalink":"/blog-cyber/posts/","section":"Posts","summary":"","title":"Posts","type":"posts"},{"content":"","date":"19 mai 2024","externalUrl":null,"permalink":"/blog-cyber/tags/medium/","section":"Tags","summary":"","title":"Medium","type":"tags"},{"content":"\rSc√©nario #\rNous avons r√©ussi √† confirmer la localisation de l\u0026rsquo;acteur malveillant qui a compromis le r√©seau WiFi de notre gouvernement.\nR√©cemment, un raid √† l\u0026rsquo;aube dans le cadre de l\u0026rsquo;OP ERADICATE a √©t√© men√© √† une adresse dans la capitale v√©lorienne et une quantit√© consid√©rable d\u0026rsquo;√©l√©ments de preuve a √©t√© saisie. On notera en particulier un appareil Android appartenant √† l\u0026rsquo;agent, dont on pense qu\u0026rsquo;il se trouvait sur le lieu de l\u0026rsquo;attaque.\nNous avons besoin de votre expertise pour analyser cet appareil et r√©pondre aux questions d√©taill√©es ci-dessous. Vous n\u0026rsquo;avez pas beaucoup de temps, une r√©union du COBR v√©lorien a √©t√© organis√©e pour discuter de vos r√©sultats\u0026hellip;\nFichiers #\ropshieldwall2.zip contenant \u0026ldquo;EVIDENCE-CASE-RAVENSKIAN-AGENT-002\u0026rdquo; o√π on le retrouve le dossier \u0026ldquo;data\u0026rdquo; et \u0026ldquo;storage\u0026rdquo; d\u0026rsquo;un Android Cela nous laisse pas mal de marge de man≈ìuvre, en effet, le /data contient √©norm√©ment d\u0026rsquo;informations telles que :\nCheatsheet SANS FOR585\rAvant propos #\rAvant de commencer, voici quelques informations importantes sur Android :\nLes donn√©es utilisateur peuvent √™tre stock√©es en interne et en externe sur Android. Les donn√©es internes sont enregistr√©es dans la m√©moire flash NAND, une m√©moire non volatile qui conserve les donn√©es m√™me en cas de coupure d\u0026rsquo;alimentation. La NAND stocke le bootloader, le syst√®me d\u0026rsquo;exploitation et les donn√©es utilisateur. Les donn√©es des applications sont stock√©es sur la m√©moire flash NAND ou sur la carte SD.\nAndroid est bas√© sur des variantes des branches LTS (long-term support) du Kernel Linux. Avec Android v8 (Oreo), Google a impos√© l\u0026rsquo;utilisation de la version 4.4 ou sup√©rieur du Kernel Linux. Par exemple Android v9 (Pie) fonctionne sur les versions 4.4, 4.9 ou 4.14 selon l\u0026rsquo;appareil. Plus d\u0026rsquo;info disponnible sur le wiki d\u0026rsquo;Android OS https://source.android.com/docs/core/architecture/kernel/android-common?hl=fr.\nandroid-mainline¬†est la principale branche de d√©veloppement des fonctionnalit√©s Android. La ligne principale Linux est fusionn√©e avec¬†android-mainline¬†chaque fois que Linus Torvalds publie une version ou une version candidate :\nOn retrouve principalement ces syst√®mes de fichiers :\nEXT4 F2FS YAFFS2 exFAT La plupart des artefacts sont des DB SQLite et des fichiers XML. Android isole les applications au niveau du Kernel, leur attribuant un identifiant unique (UID) pour suivre les applications ex√©cut√©es.\nAndroid Architecture #\rLe noyau Linux constitue la base d\u0026rsquo;Android, supportant des fonctionnalit√©s cruciales telles que les threads et la gestion de la m√©moire de bas niveau utilis√©es par Android Runtime (ART).\nLe HAL fournit des interfaces standardis√©es qui exposent les fonctionnalit√©s mat√©rielles aux API Java de niveau sup√©rieur. Il est compos√© de modules de biblioth√®que sp√©cifiques √† chaque composant mat√©riel (comme la cam√©ra ou le Bluetooth). Lorsqu\u0026rsquo;une API acc√®de au mat√©riel, Android charge le module de biblioth√®que correspondant\nL\u0026rsquo;environnement d\u0026rsquo;ex√©cution Android (Android Runtime dit ART) ex√©cute chaque application dans son propre processus et instance. G√©rant plusieurs machines virtuelles sur des appareils √† faible m√©moire gr√¢ce au bytecode DEX sp√©cialement con√ßu et optimis√© pour Android. Les outils de compilation comme d8 transforment le code Java en bytecode DEX pour l\u0026rsquo;ex√©cution sur Android.\nDe nombreux composants et services syst√®me Android essentiels, tels qu\u0026rsquo;ART et HAL, sont cr√©√©s √† partir de code natif n√©cessitant des biblioth√®ques natives √©crites en C et C++.\nLes fonctionnalit√©s d\u0026rsquo;Android sont accessibles via des API Java, facilitant la r√©utilisation des principaux composants et services syst√®me modulaires comme les notifications, la gestion des ressources et la localisation.\nLes applications syst√®me sont l\u0026rsquo;ensemble des applications de base fournies avec Android.\nAndroid Virtual Machine #\rLes VM sont utilis√©s comme couches d\u0026rsquo;abstraction entre une application et l\u0026rsquo;appareil Android sous-jacent.\nChaque application fonctionne dans sa propre instance dans une VM, isolant les applications les unes des autres.\nLes applications Android sont √©crites en Java mais sont compil√©es et compil√©es en bytecode Java.\nCe bytecode est ensuite transform√© en bytecode Dalvik (fichiers .dex) ou bytecode ART.\nDalvik et ART ex√©cutent le bytecode (.dex) dans une machine virtuelle, permettant aux applications de fonctionner ind√©pendamment du mat√©riel sous-jacent.\nAvant KitKat (v.4.4), Android utilisait des VM Dalvik.\nAvec Lollipop (v5.0), Android a commenc√© √† utiliser Android Runtime (ART) et a cess√© d\u0026rsquo;utiliser la VM Dalvik.\nLes deux environnements d\u0026rsquo;ex√©cution Dalvik et ART fonctionnent avec le bytecode DEX, mais ART poss√®de de nouvelles fonctionnalit√©s d\u0026rsquo;optimisation.\nDirectory structure #\r/cache : peut contenir des pi√®ces jointes gmail, des t√©l√©chargements, des donn√©es de navigation et des mises √† jour OTA /efs : contient des fichiers n√©cessaires au fonctionnement de l\u0026rsquo;appareil en cas de d√©faillance /data : /data/data : contient les dossiers des applications (/data/data/com.example.app), les fichiers de configurations des apps, les DB SQLite des apps, leurs logs, cache etc. /app : contient des fichiers .apk du march√© Android *Des malwares peuvent √™tre trouv√©s ici /backup : stocke l\u0026rsquo;API de sauvegarde pour les d√©veloppeurs donc les donn√©es de sauvegarde des utilisateurs ne sont pas stock√©es ici /media : l\u0026rsquo;emplacement de stockage interne √©quivalent √† une carte SD. *Des malwares malveillants peuvent √™tre trouv√©s ici /misc : les fichiers li√©s √† Bluetooth, dhcp, vpn, Wi-Fi, etc. sont stock√©s ici /system : contient des fichiers cl√©s tels que gesture.key et passwords.key ; le fichier accounts.db qui contient les usernames et les mots de passe pour l\u0026rsquo;authentification des fichiers etc. /property : contient les propri√©t√©s du syst√®me, y compris le fuseau horaire, les param√®tres de langue, etc. /mnt : /asec : stocke les donn√©es non chiffr√©s des apps /DCIM : stocke les thumbnails des albums /Pictures : stocke les images de l\u0026rsquo;appareil photo /downloads : fichiers t√©l√©charg√©s localement /secure/asec : stocke les donn√©es chiffr√©s des apps /system : /app : contient des fichiers .apk. *Des malwares peuvent √™tre trouv√©s ici /priv-app : contient des fichiers \u0026amp; apk avec des permissions au niveau du syst√®me. *Des malwares peuvent √™tre trouv√©s ici Pour avoir plus d\u0026rsquo;informations sur\nles permissions des app : https://developer.android.com/guide/topics/permissions/overview?hl=fr ; https://blog.mindorks.com/what-are-the-different-protection-levels-in-android-permission/ la CLI d\u0026rsquo;Android : https://developer.android.com/tools/adb?hl=fr Setup #\rAu vu des fichiers et du sc√©nario, je vais utiliser l\u0026rsquo;outil Autopsy. Cela peut prendre un peu de temps √† ce setup, c\u0026rsquo;est pour cela que j\u0026rsquo;attaque cela ici.\nSi vous ne connaissez pas Autopsy, voici une bri√®ve description :\nAutopsy est un outil d\u0026rsquo;investigation num√©rique opensource. Il se rapporte √† l\u0026rsquo;interface graphique du Sleuth Kit et d\u0026rsquo;autres outils de forensic. Il est utilis√© pour analyser des disques durs et des smartphones dans le cadre d\u0026rsquo;enqu√™tes. Les fonctionnalit√©s cl√©s d\u0026rsquo;Autopsy incluent la r√©cup√©ration de fichiers supprim√©s, l\u0026rsquo;analyse des m√©tadonn√©es, la recherche par mots-cl√©s, la visualisation des timelines d\u0026rsquo;activit√©s, et l\u0026rsquo;analyse des syst√®mes de fichiers etc.\nPour l\u0026rsquo;utiliser, nous devons cr√©er une \u0026ldquo;Case\u0026rdquo; :\nIci, nous savons que nous n\u0026rsquo;avons pas √† faire √† une \u0026ldquo;Disk Image\u0026rdquo; ou √† une VM, de m√™me pour un disque local. Nous choisissons donc l\u0026rsquo;option appropri√©e \u0026ldquo;Logical Files\u0026rdquo; :\nOn attend qu\u0026rsquo;Autopsy \u0026amp; ses modules terminent l\u0026rsquo;ingestion. Cela peut prendre un moment.\nC\u0026rsquo;est bon, on peut commencer l\u0026rsquo;investigation :\nQuestions #\rQuestion 1 #\rQuelle est l\u0026rsquo;adresse mail de l\u0026rsquo;agent qui a √©t√© utilis√©e dans diverses applications/services ?\nPour y r√©pondre, je vais utiliser le rapport qu\u0026rsquo;Autopsy a g√©n√©r√© via ALEAPP (Android Logs Events And Protobuf Parser), un projet open-source qui vise √† analyser tous les artefacts Android connus √† des fins d\u0026rsquo;analyse forensic.\nPour trouver rapidement et simplement nous pouvons chercher dans :\n/data/data/com.android.vending/databases/library.db pour y trouver le compte google utilis√© pour download des apps /data/data/com.android.providers.contacts/databases/contacts2.db pour y trouver le compte google utilis√© pour synchroniser ses contacts Mais aussi (mais non applicable sur ce challenge) ici :\n/data/com.android.vending/shared_prefs/lastaccount.xml (dernier compte utilis√© sur Google PlayStore (Android 9 et plus)) /data/com.google.android.gms/shared_prefs/BackupAccount.xml (email du compte de backup) /data/com.android.email/databases/EmailProvider.db (email accounts, 3rd party app data et les messages associ√©s aux notifications par emails) Enfin bref, on se retrouve donc avec le rapport en format html :\nOn peut retrouver son adresse mail un peu partout.\nDans l\u0026rsquo;app \u0026ldquo;Chrome\u0026rdquo; par exemple avec la partie \u0026ldquo;Autofill\u0026rdquo; (fonctionnalit√© qui permet de remplir automatiquement des formulaires avec des informations pr√©enregistr√©es) :\nDans les \u0026ldquo;Login Data\u0026rdquo; de Chrome :\nEnfin dans la partie \u0026ldquo;Installed Apps (Library)\u0026rdquo; nous retrouvons l\u0026rsquo;adresse mail du compte google utilis√© pour download des apps :\nR√©ponse : olegpachinksy@gmail.com\nQuestion 2 #\rQuel est le num√©ro de contact du gestionnaire (handler) affect√© √† l\u0026rsquo;agent qui a √©t√© arr√™t√© ?\nDans la partie \u0026ldquo;Contacts\u0026rdquo; :\nR√©ponse : +323145232315\nQuestion 3 #\rR√©cup√©rer les identifiants et le lien du portail officiel des agents ravenskiens. Cela peut nous donner un avantage en mati√®re de renseignement car nous pouvons utiliser cet acc√®s pour obtenir d\u0026rsquo;autres informations exploitables sur les op√©rations que le gouvernement ravenskien planifie.\nNous avons d√©j√† trouv√© la r√©ponse √† cette question √† la question n¬∞1 via les \u0026ldquo;Login Data\u0026rdquo; de Chrome :\nR√©ponse : agent.ravensk.idu.com:olegpachinksy007:HBLKNKD0MADsdfsa2334(*\u0026amp;DSMDB\nQuestion 4 #\rQuel est le code de contact utilis√© pour confirmer l\u0026rsquo;identit√© de l\u0026rsquo;agent et du gestionnaire lors de l\u0026rsquo;utilisation d\u0026rsquo;un canal de discussion s√©curis√© ?\nPremi√®rement je vais v√©rifier les potentiels SMS ici : /data/data/com.android.providers.telephony/databases/mmssms.db.\nNous n\u0026rsquo;y trouvons rien.\nNous pourrions aussi chercher ici mais non applicable sur ce challenge :\n/data/com.google.android.gms/databases/icing_mmssms.db (SMS/MMS) /data/com.google.android.gms/databases/ipa_mmssms.db (SMS/MMS) Nous devons donc trouver l\u0026rsquo;app de messagerie utilis√©. On peut voir toutes les apps install√©es dans la partie \u0026ldquo;Installed Programs\u0026rdquo; d\u0026rsquo;Autopsy :\nOn y trouve diff√©rente cat√©gorie :\nInstalled Apps (GMS) Installed Apps (Library) Installed Apps (Vending) Installed Apps - GMS : Cette cat√©gorie concerne les applications install√©es sur l\u0026rsquo;appareil, quel que soit leur mode d\u0026rsquo;installation. On peut retrouver ces donn√©es ici :¬†/data/com.google.android.gms/databases/.\nInstalled Apps - Library : Cette cat√©gorie se r√©f√®re √† la biblioth√®que d\u0026rsquo;applications pour l\u0026rsquo;utilisateur Google utilisant l\u0026rsquo;appareil. Il est important de noter que cette DB n\u0026rsquo;est pas li√©e aux applications install√©es sur l\u0026rsquo;appareil, elle peut contenir des applications install√©es par le m√™me compte Google sur un autre appareil ou sur une pr√©c√©dente installation de l\u0026rsquo;appareil analys√©. On peut retrouver ces donn√©es ici :¬†/data/com.android.vending/databases/.\nInstalled Apps - Vending : Cette cat√©gorie concerne sp√©cifiquement les applications install√©es sur l\u0026rsquo;appareil via le Google Play Store, excluant celles install√©es par d\u0026rsquo;autres moyens. Ces donn√©es ne sont pas supprim√©es lorsque l\u0026rsquo;application est d√©sinstall√©e. Elles sont stock√©es dans une DB SQLite situ√©e ici : /data/com.android.vending/databases/.\nPour plus de lisibilit√© retournons sur ALEAPP et concentrons-nous sur les apps de type \u0026ldquo;Vending\u0026rdquo; :\nL\u0026rsquo;app qui saute au yeux c\u0026rsquo;est mega.privacy.android.app. Et en effet, c\u0026rsquo;est une application de messagerie :\nJustement ALEAPP a pars√© les messages √©chang√©s via MEGA :\nOn peut retrouver ces infomations ici : /data/data/mega.privacy.android.app/karere-TU1IaTh4TUJpdTQKAfO_2P0qU8NMP7zDRlgv.db.\nR√©ponse : REDAPPLEONACAR\nQuestion 5 #\rLe gestionnaire a partag√© un document avec l\u0026rsquo;agent en utilisant un service de stockage cloud. Quand ce fichier a-t-il √©t√© partag√© avec l\u0026rsquo;agent ?\nRien dans les messages. Le document a donc d√ª √™tre transmis d\u0026rsquo;une autre mani√®re. Nous savons qu\u0026rsquo;il n\u0026rsquo;y a pas d\u0026rsquo;autre app de messagerie et qu\u0026rsquo;il n\u0026rsquo;a pas pu lui communiquer via SMS/MMS.\nDans les app install√© nous avons vu com.google.android.apps.docs. Allons donc chercher ici : \\data\\data\\com.google.android.apps.docs.\nOn y trouve la DB /data/data/com.google.android.apps.docs/app_cello/olegpachinksy@gmail.com/cello.db contenant ces informations :\nOn peut d\u0026rsquo;ailleurs retrouver ce fichier ici : EVIDENCE-CASE-RAVENSKIAN-AGENT-002/storage/emulated/0/Download/Debrief-Velorian OP Expansion East.pdf :\nN√©anmoins attention, par d√©faut Autopsy interpr√®te les timestamps avec la time zone de votre ordinateur. Pensez bien √† modifier ce param√®tre dans Autopsy (Tools \u0026gt; Options \u0026gt; View \u0026gt; Time Zone).\nR√©ponse : 2024-04-01 09:36:41\nQuestion 6 #\rQuel est l\u0026rsquo;URI de t√©l√©chargement du fichier partag√© pr√©c√©demment identifi√© ?\nNous savons que le fichier a √©t√© t√©l√©charg√© car nous l\u0026rsquo;avons retrouv√© dans /storage/emulated/0/Download/.\nNous pouvons donc chercher dans /data/data/com.android.providers.downloads/databases/downloads.db :\nR√©ponse : https://www.googleapis.com/drive/v2internal/files/1iQKKlBU2vuJD1Xet6IYPt7IODVtDHxv1?alt=media\u0026amp;source=downloadUrl\u0026amp;auditContext=fileAction\u0026amp;reason=909\u0026amp;syncType=1\u0026amp;featureLabel=android-sync-classic\u0026amp;openDrive=false\u0026amp;errorRecovery=false\u0026amp;originatorApp=102\nQuestion 7 #\rAfin d\u0026rsquo;obtenir davantage d\u0026rsquo;informations pour le contre-espionnage de Veloria, quel √©tait l\u0026rsquo;objectif principal de cette cyber-op√©ration men√©e par le gouvernement de Ravensk ?\nRevenons au document :\nR√©ponse : Infiltrate the Velorian secured network to gather intelligence on upcoming cyber-attacks, their techniques, and target countries.\nQuestion 8 #\rL\u0026rsquo;identification du gestionnaire est √©galement cruciale pour que les forces de l\u0026rsquo;ordre v√©loriennes puissent comprendre l\u0026rsquo;√©tendue de cette op√©ration. Quelle est l\u0026rsquo;adresse √©lectronique utilis√©e par le manipulateur ?\nNous l\u0026rsquo;avons d√©j√† vu dans les messages de l\u0026rsquo;app MEGA :\nR√©ponse : ivoryalex783@gmail.com\nQuestion 9 #\rQuel est le nom de l\u0026rsquo;endroit o√π l\u0026rsquo;agent et le gestionnaire se sont rencontr√©s ?\nRevenons aux messages :\nC\u0026rsquo;est la question qui m\u0026rsquo;a pris le plus de temps, j\u0026rsquo;ai d√ª bloquer une bonne heure dessus.\nPremi√®rement, j\u0026rsquo;ai cherch√© dans les endroits habituels :\n/data/com.google.android.apps.maps/databases/gmm_storage.db /data/com.google.android.apps.maps/databases/search_history.db /data/com.google.android.apps.maps/databases/da_destination_history /data/com.sec.android.daemonapp/db/weatherClock /data/com.google.android.apps.maps/app_tts-cache/ /data/com.google.android.apps.maps/cache/image_manager_disk_cache/ Apr√®s n\u0026rsquo;avoir rien trouv√©, je me suis dit qu\u0026rsquo;il √©tait sans doute possible que la r√©ponse soit dans les metadatas des images sur le t√©l√©phone. En effet, on retrouve 48 images dont plusieurs de bar :\nN√©anmoins, rien de probant.\nJe me suis donc pos√© plusieurs questions :\nil y a-t-il d\u0026rsquo;autres applications de navigation / localisation sur le t√©l√©phone ? est-il s√ªr que je dois chercher dans l\u0026rsquo;app Google Maps ? Non, seulement Google Maps. Non, il est peut-√™tre possible qu\u0026rsquo;il ait fait la recherche sur son navigateur et non sur l\u0026rsquo;app etc. Ayant d√©j√† v√©rifi√© les points habituels des artefacts de google maps j\u0026rsquo;ai pr√©f√©r√© chercher dans le navigateur mais je n\u0026rsquo;ai rien trouv√©.\nJe suis donc retourn√© fouiller dans les artefacts de google maps :\napp : RAS app_offline_downloads : RAS app_offline_hashes : RAS app_textures : RAS app_webview : RAS cache : RAS databases : trop de fichiers, j\u0026rsquo;y reviendrai plus tard files : \u0026ldquo;new_recent_history_cache_search.cs\u0026rdquo; Je me rends compte que j\u0026rsquo;aurais simplement pu chercher par mot-cl√© \u0026ldquo;Pub\u0026rdquo; ü§°\nR√©ponse : Levstik Pub\nQuestion 10 #\rD\u0026rsquo;apr√®s le chat retrouv√© entre l\u0026rsquo;agent et le gestionnaire, il semble que ce dernier ait envoy√© √† l\u0026rsquo;agent arr√™t√© une image relative √† l\u0026rsquo;infrastructure utilis√©e par le gouvernement ravenskien pour cette op√©ration de cyberespionnage. Quel est le cadre C2 utilis√© par le gouvernement ravenskien ?\nAyant d√©j√† v√©rifi√© toutes les images pour r√©pondre √† la question 9 j\u0026rsquo;ai d√©j√† la r√©ponse.\nR√©ponse : Empire\nQuestion 11 #\rLa collecte d\u0026rsquo;informations sur l\u0026rsquo;infrastructure, telles que les adresses IP ou les noms d\u0026rsquo;h√¥tes, est cruciale pour les autorit√©s v√©loriennes, qui pr√©parent une op√©ration de contre-offensive. D\u0026rsquo;apr√®s l\u0026rsquo;image r√©cup√©r√©e envoy√©e par le gestionnaire √† l\u0026rsquo;agent, quelle est l\u0026rsquo;adresse IP de l\u0026rsquo;un des serveurs C2 exploit√©s par les acteurs de la menace ravenskiens ?\nR√©ponse : 98.24.12.45\n","date":"19 mai 2024","externalUrl":null,"permalink":"/blog-cyber/posts/opshieldwall-2/","section":"Posts","summary":"Sc√©nario #\rNous avons r√©ussi √† confirmer la localisation de l\u0026rsquo;acteur malveillant qui a compromis le r√©seau WiFi de notre gouvernement.","title":"OpShieldWall-2","type":"posts"},{"content":"","date":"19 mai 2024","externalUrl":null,"permalink":"/blog-cyber/tags/sherlock/","section":"Tags","summary":"","title":"Sherlock","type":"tags"},{"content":"","date":"19 mai 2024","externalUrl":null,"permalink":"/blog-cyber/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"},{"content":"","date":"19 mai 2024","externalUrl":null,"permalink":"/blog-cyber/tags/writeup/","section":"Tags","summary":"","title":"Writeup","type":"tags"},{"content":"\rSc√©nario #\rMerci d\u0026rsquo;avoir r√©pondu √† notre appel. Le minist√®re de la D√©fense de Velorian a d√©sesp√©r√©ment besoin d\u0026rsquo;aide\u0026hellip;\nNous devons rester discrets, mais nous pensons que le Wi-Fi public des bureaux du minist√®re de la D√©fense de Velorian a √©t√© compromis. L\u0026rsquo;impact semble faible, mais les diagrammes du r√©seau montrent qu\u0026rsquo;aucune segmentation r√©elle du r√©seau n\u0026rsquo;a √©t√© r√©alis√©e et que le trafic entre les appareils est autoris√©. Les ministres du gouvernement utilisent ce r√©seau avec des √©quipements BYoD et des h√¥tes Velorian MoDNet. Veuillez analyser le pcap fourni et confirmer comment et quand cela s\u0026rsquo;est produit. N\u0026rsquo;oubliez pas que cette enqu√™te est de type TLP Amber.\nFichiers #\ropshieldwall1.zip contenant la capture r√©seau \u0026ldquo;VELORIA-NETWORK.pcap\u0026rdquo; Setup #\rAu vu de la simplicit√© de ce challenge, on peut simplement se limiter √† tshark / wireshark.\nQuestions #\rQuestion 1 #\rVeuillez confirmer le SSID de notre r√©seau WiFi.\nPremi√®rement, familiarisez-nous avec la capture. Nous allons utiliser la commande suivante afin d\u0026rsquo;avoir des statistiques :\n$ tshark -r traffic.pcapng -qz -r permet de lire (read) un fichier -q permet d\u0026rsquo;√™tre plus \u0026ldquo;quiet\u0026rdquo; √† la sortie (utile pour les stats car cela permet d\u0026rsquo;afficher les statistiques globales, et non par paquet.) -z permet l\u0026rsquo;affichage de statistiques Il y a beaucoup de valeurs possible (tshark -z help pour les afficher) mais ici nous souhaitons avant tout savoir :\nle nombre de paquet la dur√©e de la capture les IPv4 avec le plus de paquet les IPv4 endpoints √©changeant ensemble le plus les protocoles les plus utilis√©s Nombre de paquet et dur√©e : 106 ; 31.6 sec\n$ tshark -r VELORIA-NETWORK.pcap -qz io,stat,0 =================================== | IO Statistics | | | | Duration: 31.6 secs | | Interval: 31.6 secs | | | | Col 1: Frames and bytes | |---------------------------------| | |1 | | | Interval | Frames | Bytes | | |-------------------------------| | | 0.0 \u0026lt;\u0026gt; 31.6 | 106 | 20759 | | =================================== IPv4 endpoints :\navec le plus de paquet : $ tshark -r VELORIA-NETWORK.pcap -qz endpoints,ip ================================================================================ IPv4 Endpoints Filter:\u0026lt;No Filter\u0026gt; | Packets | | Bytes | | Tx Packets | | Tx Bytes | | Rx Packets | | Rx Bytes | 0.0.0.0 3 1044 3 1044 0 0 255.255.255.255 3 1044 0 0 3 1044 10.0.3.1 3 1048 3 1048 0 0 10.0.3.52 3 1048 0 0 3 1048 ================================================================================ √©changeant le plus : tshark -r VELORIA-NETWORK.pcap -qz conv,ip ================================================================================ IPv4 Conversations Filter:\u0026lt;No Filter\u0026gt; | \u0026lt;- | | -\u0026gt; | | Total | Relative | Duration | | Frames Bytes | | Frames Bytes | | Frames Bytes | Start | | 0.0.0.0 \u0026lt;-\u0026gt; 255.255.255.255 0 0 bytes 3 1044 bytes 3 1044 bytes 23.256576000 8.3680 10.0.3.1 \u0026lt;-\u0026gt; 10.0.3.52 0 0 bytes 3 1048 bytes 3 1048 bytes 23.256959000 8.3693 ================================================================================ Protocoles les plus utilis√©s :\ntshark -r VELORIA-NETWORK.pcap -qz io,phs =================================================================== Protocol Hierarchy Statistics Filter: sll frames:106 bytes:20759 radiotap frames:92 bytes:17572 wlan_radio frames:92 bytes:17572 wlan frames:92 bytes:17572 wlan.mgt frames:92 bytes:17572 eapol frames:6 bytes:999 eap frames:6 bytes:999 ip frames:6 bytes:2092 udp frames:6 bytes:2092 dhcp frames:6 bytes:2092 arp frames:2 bytes:96 =================================================================== Pour r√©pondre √† la question, il suffit d\u0026rsquo;utiliser la commande :\n$ tshark -r VELORIA-NETWORK.pcap -T fields -e wlan.ssid | head -n 1 | xxd -r -p VELORIA-MoD-AP012 Explication : (https://www.wireshark.org/docs/dfref/w/wlan.html)\n-t affiche uniquement les champs sp√©cifi√©s par l\u0026rsquo;utilisateur (n√©cessite donc forc√©ment l\u0026rsquo;utilisation de l\u0026rsquo;option -e pour sp√©cifier les champs). -e wlan.ssid sp√©cifie que le champ wlan.ssid (SSID des r√©seaux sans fil) doit √™tre extrait et affich√©. -xxd -r -p l\u0026rsquo;output √©tant une suite hexad√©cimale, cela permet de le convertir en texte lisible R√©ponse : VELORIA-MoD-AP012\nQuestion 2 #\rVeuillez confirmer l\u0026rsquo;adresse MAC du point d\u0026rsquo;acc√®s (AP).\ntshark -r VELORIA-NETWORK.pcap -T fields -e wlan.sa | head -n 1 02:00:00:00:01:00 R√©ponse : 02:00:00:00:01:00\nQuestion 3 #\rVeuillez confirmer l\u0026rsquo;√©tat/le m√©canisme d\u0026rsquo;authentification de l\u0026rsquo;AP et le vecteur d\u0026rsquo;attaque.\nPassons √† Wireshark.\nR√©ponse : WPS\nQuestion 4 #\rQuel est le num√©ro de paquet o√π l\u0026rsquo;attaque a-t-elle commenc√© ?\nOn peut facilement en d√©duire que c\u0026rsquo;est √† la premi√®re tentative de connexion (√©tant les seuls dans la capture).\nR√©ponse : 93\nQuestion 5 #\rQuel est le num√©ro de paquet o√π l\u0026rsquo;attaque s\u0026rsquo;est-elle termin√©e ?\nOn peut facilement en d√©duire que c\u0026rsquo;est lorsque l\u0026rsquo;authentifcation a √©chou√©.\nR√©ponse : 8\n","date":"7 mai 2024","externalUrl":null,"permalink":"/blog-cyber/posts/opshieldwall-1/","section":"Posts","summary":"Sc√©nario #\rMerci d\u0026rsquo;avoir r√©pondu √† notre appel.","title":"OpShieldWall-1","type":"posts"},{"content":"\rDipl√¥mes #\rLes images sont des liens cliquables.\nEn cours Mast√®re (BAC+5) - Expert de la s√©curit√© des donn√©es, des r√©seaux et des syst√®mes\nUniquement en alternance\nhttps://www.francecompetences.fr/recherche/rncp/38951/\rBachelor (BAC+3) - Cybers√©curit√© \u0026 Ethical Hacking\n3√®me ann√©e en alternance\nMention - Tr√®s bien\rBachelor (BAC+3) - Concepteur de Syst√®mes d'Information Mention - Tr√®s bien\rListe de tous les challenges, labs, box etc. que j\u0026rsquo;ai effectu√© mais aussi des cours, conf√©rences et trainings auquels j\u0026rsquo;ai assist√© :\nHackTheBox #\rIron = Insane Red = Hard Orange = Medium Green = Easy Purple = Very Easy Certaines images ne redirigent pas vers les pages de r√©sultat d\u0026rsquo;HTB car se sont des boxs / sherlocks uniquement disponibles sur la plateforme HackTheBox Entreprise (qui ne permet pas de faire des liens de partage).\nSherlock #\rDFIR / SOC #\rOpShieldWall-7\rHeartbreaker\rTrent\rAPTNightmare\rOpShieldWall-4\rOpShieldWall-2\rOpShieldWall-1\rJingle Bell\rRecollection\rNoted\rTracer\rLog Jammer\rRogue One\rCrownJewel-2\rCrownJewel-1\rBrutus\rMalware Analysis #\rOpShieldWall-6\rLoggy\rHeartbreaker\rCloud #\rNubilum-2\rBox #\rLinux #\rOpShieldWall-5\rOpShieldWall-3\rBlurry\rRunner\rIClean\rPerfection\rBoardLight\rHeadless\rWifinetic\rMetaTwo\rLame\rNibbles\rPrecious\rWindows #\rJerry\rNetmon\rBlue\rHackTheBox Academy #\rTranscript.pdf\nRootMe #\rCyberdefenders #\rThreat Hunting #\rHard\rNetwork Forensics #\rHard\rMedium\rMedium\rMedium\rMedium\rMedium\rEasy\rEasy\rEasy\rEasy\rEasy\rEasy\rEasy\rEasy\rEndpoint Forensics #\rMedium\rEasy\rThreat Intel #\rMedium\rMedium\rEasy\rEasy\rEasy\rEasy\rCloud Forensics #\rEasy\rTryHackMe #\r92 rooms compl√©t√©s\nPath :\nPre Security Complete Beginner Web Fundamentals Comptia Pentest+ Cours #\rOALABS : Reverse Engineering 101 (RE101) Evasive Malware : A Field Guide to Detecting, Analyzing, and Defeating Advanced Threats (Kyle Cucci - no starch press) Kaspersky : Advanced Malware Analysis Techniques Kaspersky : Hunting APTs like a Ninja with YARA 13Cubed : Investigating Windows Endpoint 13Cubed : Investigating Windows Memory Roman Stuehler : Android App Hacking - Black Belt Edition Pentherz : Intro to SDR Hacking Christopher Negus : Linux Bible OSINT (Open Source Intelligence Techniques) : IntelTechniques Opdisk : The Cyber Plumber\u0026rsquo;s Handbook Conf \u0026amp; meetups #\r2024 #\rDEFCON Paris\rMeetups HTB France\r2023 #\rHexacon\rDEFCON Paris\rLeHack\rMeetups HTB France\r","date":"6 mai 2024","externalUrl":null,"permalink":"/blog-cyber/posts/portfolio/","section":"Posts","summary":"Dipl√¥mes #\rLes images sont des liens cliquables.","title":"Portfolio","type":"posts"},{"content":"Liste des projets que j\u0026rsquo;ai effecut√©.\nSelf-Hosted Infrastructure #\rJuin 2023 - maintenant\nProfessional Server (HP ProLiant DL380 Gen9 2U) sous Proxmox Firewall sous OPNsense Self-hosted services et tools: VPN, Security Onion, Wazuh, Cuckoo Sandbox, GitLab, VM pour CTF, labs en tout genre (red team / blue team\u0026hellip;) Un lab sp√©cial de Malware Analysis \u0026amp; d\u0026rsquo;OSINT avec une emphase sur la s√©curit√©, la vie priv√©e et l\u0026rsquo;OPSEC Architecture, network segmentation, int√©gration IPS/IDS, load balancing, SRE, VPN CTF Challenge Creator #\rJuin 2024 - Juin 2024\nCr√©ation de deux challenges de radio (misc easy and medium) pour le \u0026ldquo;PwnMe CTF 2024\u0026rdquo;.\nhttps://ctftime.org/ctf/807/\nhttps://www.phreaks2600.fr/\nSide Quest - Toolkit Network Forensic \u0026amp; Malware Analysis #\rF√©vr. 2024 - Juin 2024\nNotre side quest est un projet collaboratif d\u0026rsquo;√©tudiants pour fournir un toolkit puissant pour la forensique r√©seau et l\u0026rsquo;analyse de malware. Ce repository contient deux sous-projets qui se concentrent sur diff√©rents aspects de l\u0026rsquo;investigation :\nNetwork Forensic Analysis : Outils d\u0026rsquo;analyse du trafic r√©seau captur√© dans des fichiers PCAP. Analyse des malwares : Outils permettant de diss√©quer les fichiers binaires afin de d√©couvrir des informations cach√©es et de d√©tecter des caract√©ristiques malveillantes. https://github.com/jaybird1291/toolkit-network-forensic-malware-analysis-sidequest\n","date":"5 mai 2024","externalUrl":null,"permalink":"/blog-cyber/posts/projets/","section":"Posts","summary":"Liste des projets que j\u0026rsquo;ai effecut√©.","title":"Projets","type":"posts"},{"content":"","externalUrl":null,"permalink":"/blog-cyber/authors/","section":"Authors","summary":"","title":"Authors","type":"authors"},{"content":"","externalUrl":null,"permalink":"/blog-cyber/categories/","section":"Categories","summary":"","title":"Categories","type":"categories"},{"content":"","externalUrl":null,"permalink":"/blog-cyber/series/","section":"Series","summary":"","title":"Series","type":"series"}]