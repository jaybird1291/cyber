[{"content":"","date":"2 May 2025","externalUrl":null,"permalink":"/blog-cyber/en/","section":"Jaybird1291","summary":"","title":"Jaybird1291","type":"page"},{"content":"","date":"2 May 2025","externalUrl":null,"permalink":"/blog-cyber/en/posts/","section":"Posts","summary":"","title":"Posts","type":"posts"},{"content":"","date":"2 March 2025","externalUrl":null,"permalink":"/blog-cyber/ja/tags/cyberdefenders/","section":"Tags","summary":"","title":"Cyberdefenders","type":"tags"},{"content":"","date":"2 March 2025","externalUrl":null,"permalink":"/blog-cyber/ja/tags/hard/","section":"Tags","summary":"","title":"Hard","type":"tags"},{"content":" ã‚·ãƒŠãƒªã‚ª # InfiniTech Solutions ã® IT å¾“æ¥­å“¡ãŒã€è‡ªèº«ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«é–¢é€£ã™ã‚‹ç•°å¸¸ãªã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’å ±å‘Šã—ã¾ã—ãŸã€‚èª¿æŸ»ã®çµæœã€ãã®å¾“æ¥­å“¡ã®æ¥­å‹™ç”¨èªè¨¼æƒ…å ±ãŒã€æœ€è¿‘ã®ãƒ‡ãƒ¼ã‚¿æ¼æ´©ã«ã‚ˆã‚Šæµå‡ºã—ã¦ã„ãŸã“ã¨ãŒåˆ¤æ˜ã—ã¾ã—ãŸã€‚\nå¾“æ¥­å“¡ã¯ã€æ¥­å‹™ç”¨ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ä½¿ã£ã¦ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã«ç™»éŒ²ã—ãŸãŸã‚ã€èªè¨¼æƒ…å ±ãŒéœ²å‡ºã—ã¦ã—ã¾ã„ã¾ã—ãŸã€‚æ”»æ’ƒè€…ã¯ã“ã®èªè¨¼æƒ…å ±ã‚’æ‚ªç”¨ã—ã€å¾“æ¥­å“¡ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã€ç¤¾å†…ã®ä»–ã®å¾“æ¥­å“¡ã¸ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚\nã‚ãªãŸã®ã‚¿ã‚¹ã‚¯ã¯ã€ãƒ­ã‚°ã‚’è§£æã—ã€æ”»æ’ƒã®ç¯„å›²ã‚’æŠŠæ¡ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°ãƒ¡ãƒ¼ãƒ«ã¨ã©ã®ã‚ˆã†ã«é–¢ã‚ã£ãŸã®ã‹ã‚’ç‰¹å®šã—ã€ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ãŒãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ä¸ãˆãŸå½±éŸ¿ã‚’æ˜ã‚‰ã‹ã«ã™ã‚‹ã“ã¨ã§ã™ã€‚\nã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— # ã“ã®èª¿æŸ»ã‚·ãƒŠãƒªã‚ªã§ã¯ã€ä¸»ã« Splunk Search ã‚’ä½¿ã£ã¦ãƒ­ã‚°ã‚’è§£æã—ã¾ã™ã€‚ã¾ãŸã€xml.onlineviewerã€Cyberchefã€VirusTotal ã¨ã„ã£ãŸä»–ã®ãƒ„ãƒ¼ãƒ«ã‚‚ä½µç”¨ã—ã¾ã™ã€‚\næ³¨æ„äº‹é … # Splunk ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ©Ÿå™¨ãªã©ãŒç”Ÿæˆã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’åé›†ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ–ã€æ¤œç´¢ã™ã‚‹ãŸã‚ã®è§£æãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã™ã€‚ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚ŒãŸã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã€ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã®å–ã‚Šè¾¼ã¿ã€ã‚ã‚‹ã„ã¯ API ã‚’é€šã˜ã¦ãƒ­ã‚°ã‚’å–å¾—ã—ã¾ã™ã€‚\nå–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã¯ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ–ã•ã‚Œã€æ•´ç†ã•ã‚Œã‚‹ã“ã¨ã§æ¤œç´¢ãƒ—ãƒ­ã‚»ã‚¹ãŒå®¹æ˜“ã«ãªã‚Šã¾ã™ã€‚Splunk ã¯ã€ã“ã®ãƒ‡ãƒ¼ã‚¿ã‚’å•ã„åˆã‚ã›ã‚‹ãŸã‚ã« SPLï¼ˆSearch Processing Languageï¼‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚\nåˆæœŸã‚¢ã‚¯ã‚»ã‚¹ # è³ªå• 1 # ã©ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä¾µå®³ã•ã‚Œã€æ”»æ’ƒã®ç™ºä¿¡ã«ä½¿ã‚ã‚ŒãŸã®ã‹ï¼Ÿ\nã¾ãšã€ã‚·ã‚¹ãƒ†ãƒ ä¸Šã§åˆ©ç”¨å¯èƒ½ãª \u0026ldquo;sourcetypes\u0026rdquo; ã‚’ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†:\nindex=\u0026#34;main\u0026#34; | stats count by sourcetype Splunk ã® sourcetype ã¯ã€åé›†ã•ã‚ŒãŸã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—ã‚„ç™ºä¿¡å…ƒã‚’ç¤ºã™ãƒ©ãƒ™ãƒ«ã§ã™ã€‚\nã“ã®è³ªå•ã«ç­”ãˆã‚‹ãŸã‚ã€ã¾ãš \u0026ldquo;syslog\u0026rdquo; ã«æ³¨ç›®ã—ã¾ã™ã€‚syslog ã¯ã€æ§˜ã€…ãªãƒ‡ãƒã‚¤ã‚¹ã‹ã‚‰ç”Ÿæˆã•ã‚Œã‚‹ãƒ­ã‚°ã‚’é›†ç´„ã—ã€ã‚·ã‚¹ãƒ†ãƒ ã‚„ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã®è©³ç´°ãªæƒ…å ±ã‚’å«ã‚€ã“ã¨ãŒå¤šã„ã§ã™ã€‚\næƒ…å ±ãŒæº¢ã‚Œå‡ºã™ã®ã‚’é˜²ããŸã‚ã€æ­£è¦è¡¨ç¾ã‚’ç”¨ã„ã¦ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ã¿ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«æ¤œç´¢ã—ã¾ã™:\n* sourcetype=syslog | regex _raw=\u0026#34;[\\w\\.-]+@[\\w\\.-]+\\.\\w+\u0026#34; å¤§é‡ã®ãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€å„ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å‡ºç¾å›æ•°ã‚’ã‚«ã‚¦ãƒ³ãƒˆã—ã€ãƒ†ãƒ¼ãƒ–ãƒ«å½¢å¼ã§çµæœã‚’è¡¨ç¤ºã—ã¾ã™:\n* sourcetype=syslog | rex field=_raw \u0026#34;(?\u0026lt;email\u0026gt;[\\w\\.-]+@[\\w\\.-]+\\.\\w+)\u0026#34; | stats count by email | sort -count | head 10 | rename count AS \u0026#34;Number of occurrences\u0026#34;, email AS \u0026#34;Email address\u0026#34; ã“ã‚Œã‚’ã‚°ãƒ©ãƒ•ã§å¯è¦–åŒ–ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™:\nå›ç­”: twhite@infinitechsolutions.xyz\nè³ªå• 2 # ä¾µå®³ã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç‰¹å®šã—ãŸå¾Œã€æ”»æ’ƒè€…ã¯ç¤¾å†…ã®ä»–ã®å¾“æ¥­å“¡ã«ãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚æ™‚ç³»åˆ—é †ã«ã€ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§ã“ã‚Œã‚‰ã®å¾“æ¥­å“¡ã®åå‰ã‚’æ•™ãˆã¦ãã ã•ã„ã€‚\nãƒ¡ãƒ¼ãƒ«é€ä¿¡ãƒ­ã‚°ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™:\nUser [sender_email] [IP_address]; Message [message_ID] for [recipient_email] æ¤œç´¢ã«ã¯ä»¥ä¸‹ã®ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã—ã¾ã™:\n* sourcetype=syslog \u0026#34;User twhite@infinitechsolutions.xyz\u0026#34; | rex field=_raw \u0026#34;Message \u0026lt;[^\u0026gt;]+\u0026gt; for (?\u0026lt;recipient\u0026gt;[\\w\\.-]+@[\\w\\.-]+\\.\\w+)\u0026#34; | table _time recipient | sort _time | stats list(recipient) as recipients | eval recipients=mvjoin(recipients, \u0026#34;, \u0026#34;) ã“ã®ã‚¯ã‚¨ãƒªã«ã‚ˆã‚Šã€å—ä¿¡è€…ãŒæ™‚ç³»åˆ—é †ã«æŠ½å‡ºã•ã‚Œã€ä¸€è¦§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚\nå…·ä½“çš„ã«ã¯ã€ä¾µå®³ã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’é¸æŠã—ã€æ­£è¦è¡¨ç¾ã§å—ä¿¡è€…ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŠ½å‡ºã—ã¦å¤‰æ•°ã«æ ¼ç´ã—ã¦ã„ã¾ã™ã€‚ãã®å¾Œã€çµæœã‚’æ™‚ç³»åˆ—ã§ä¸¦ã¹æ›¿ãˆã€èª­ã¿ã‚„ã™ã„å½¢å¼ã«æ•´ãˆã¦ã„ã¾ã™ã€‚\nå›ç­”: rnichols,llopez,gbaker,ahall\nè³ªå• 3 # ä¾µå®³ã•ã‚ŒãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‹ã‚‰é€ä¿¡ã•ã‚ŒãŸæ‚ªæ„ã®ã‚ã‚‹æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ã¯ä½•ã§ã™ã‹ï¼Ÿ\nã“ã®è³ªå•ã¯ã€äºˆæƒ³ä»¥ä¸Šã«æ‰‹é–“å–ã‚Šã¾ã—ãŸã€‚æœ€åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æ¤œç´¢ã—ã¾ã—ãŸ:\n* sourcetype=syslog \u0026#34;User twhite@infinitechsolutions.xyz\u0026#34; | regex _raw=\u0026#34;for (rnichols|llopez|gbaker|ahall)@infinitechsolutions\\.xyz\u0026#34; ã—ã‹ã—ã€æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã®ç—•è·¡ã¯ä¸€åˆ‡è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚ãã“ã§ã€ã€Œãµã‚€ã€æ­£ã—ã„ sourcetype ã«ã„ãªã„ã®ã‹ã€ä»–ã®ã‚‚ã®ã‚‚æ¤œç´¢ã—ã¦ã¿ã‚ˆã†ã€ã¨æ€ã„ã€æ¬¡ã®ã‚¯ã‚¨ãƒªã§æ¤œç´¢ã—ã¾ã—ãŸ:\nindex=* \u0026#34;twhite@infinitechsolutions.xyz\u0026#34; | stats count by sourcetype åˆ©ç”¨å¯èƒ½ãª sourcetype ã¯ syslog ã®ã¿ãªã®ã§ã€æ­£ã—ã„å ´æ‰€ã«ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ãã‚Œã‹ã‚‰ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®å•é¡Œã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã€å˜ã«ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­ã‚’æ¢ã™æ–¹æ³•ã«åˆ‡ã‚Šæ›¿ãˆã¾ã—ãŸã€‚\nChatGPT ã«ãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µå­ã®ãƒªã‚¹ãƒˆã‚’æ±‚ã‚ãŸçµæœã€ä»¥ä¸‹ã®ã‚¯ã‚¨ãƒªã«ãŸã©ã‚Šç€ãã¾ã—ãŸ:\nindex=* sourcetype=syslog twhite@infinitechsolutions.xyz | rex field=_raw \u0026#34;attachment=(?\u0026lt;malicious_attachment\u0026gt;[\\w\\.-]+\\.(exe|zip|pdf|docx|xlsm|js|vbs|scr|bat))\u0026#34; | table _time malicious_attachment | sort _time ãã‚Œã§ã‚‚æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\nã©ã†ã—ã¦ã‚‚è¡Œãè©°ã¾ã£ãŸã®ã§ã€åˆ¥ã®è¦–ç‚¹ã‹ã‚‰è€ƒãˆã‚‹ã“ã¨ã«ã—ã¾ã—ãŸã€‚ãƒ©ãƒœã®ã‚¿ã‚¤ãƒˆãƒ«ãŒ \u0026ldquo;Midnight RDP\u0026rdquo; ã§ã‚ã‚‹ã“ã¨ã‹ã‚‰ã€ã“ã‚Œã¯ã€ŒMidnight Blizzardã€ã¨ã—ã¦çŸ¥ã‚‰ã‚Œã‚‹ APT ã‚’æ€ã„å‡ºã•ã›ã¾ã—ãŸã€‚\nèª¿æŸ»ä¸­ã«ã€ã€ŒHow Midnight Blizzard Uses Malicious .RDP Files to Exploit Windows Systems: A Technical Guideã€ï¼ˆè‘—: Yua Mikananaï¼‰ã¨ã„ã†è¨˜äº‹ã‚‚è¦‹ã¤ã‘ã¾ã—ãŸã€‚\nãƒ©ãƒœã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’è€ƒãˆã‚‹ã¨ã€ç­”ãˆã¯æ˜ã‚‰ã‹ã§ã—ãŸã€‚ãã“ã§ã€\u0026quot;.RDP\u0026quot; ã‚’æ¤œç´¢ã—ãŸçµæœã€ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ:\nå›ç­”: cloud zerotrust compliance.rdp\nå®Ÿè¡Œ # è³ªå• 1 # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ç›¸äº’ä½œç”¨ã‚’åˆ†æã—ãŸçµæœã€æ‚ªæ„ã®ã‚ã‚‹æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦å®Ÿè¡Œã—ãŸå¾“æ¥­å“¡ã¯èª°ã§ã™ã‹ï¼Ÿ\nsourcetype ã‚’å¤‰æ›´ã—ã¦ã€WinEventLog ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™ã€‚\nWinEventLog ã¯ã€Windows ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒ­ã‚°ã§ã€ã‚¨ãƒ©ãƒ¼ã€è­¦å‘Šã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æƒ…å ±ã€ã¾ãŸã¯ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆãªã©ã€ã‚·ã‚¹ãƒ†ãƒ ä¸Šã®æ§˜ã€…ãªæ´»å‹•ã‚’è¨˜éŒ²ã—ã€è¿½è·¡ãŠã‚ˆã³è§£æã‚’å¯èƒ½ã«ã—ã¾ã™ã€‚\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; cloud zerotrust compliance.rdp ã“ã“ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åãŒæ˜ç¢ºã«ç¢ºèªã§ãã¾ã™: C:\\Users\\rnichols\\Downloads\\cloud zerotrust compliance.rdp\nå›ç­”: rnichols\nè³ªå• 2 # DC ãƒã‚·ãƒ³ä¸Šã§ã€æ”»æ’ƒè€…ãŒãƒ¡ãƒ¢ãƒªå†…ã§å®Ÿè¡Œã—ãŸ DLL ã‚¿ã‚°ã«ã¤ã„ã¦ã€ã“ã®æ‚ªæ„ã®ã‚ã‚‹ DLL ãƒ•ã‚¡ã‚¤ãƒ«ã® SHA-256 ãƒãƒƒã‚·ãƒ¥ã®æœ€åˆã® 10 ãƒã‚¤ãƒˆã¯ä½•ã§ã™ã‹ï¼Ÿ\nã¾ãšã€DC ä¸Šã§ PowerShell ã«é–¢é€£ã™ã‚‹ DLL ã‚’ãƒªã‚¹ãƒˆã‚¢ãƒƒãƒ—ã—ã¾ã™:\nindex=* sourcetype=xmlwineventlog \u0026#34;Powershell\u0026#34; | search host=\u0026#34;DC01\u0026#34; | rex field=_raw \u0026#34;(?\u0026lt;file\u0026gt;\\b\\w{6,8}\\.\\w{3}\\b)\u0026#34; | search file=\u0026#34;*dll\u0026#34; å®Œå…¨ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒ 1 ã¤ã®ã‚¤ãƒ™ãƒ³ãƒˆã«åéŒ²ã™ã‚‹ã«ã¯é•·ã™ãã‚‹ãŸã‚ã€ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã«åˆ†å‰²ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ MessageNumber ã«ã‚ˆã£ã¦ç¢ºèªã§ãã¾ã™:\n2 ã¤ã®ã‚¤ãƒ™ãƒ³ãƒˆã¯åŒã˜ ActivityID {0B39225B-3C43-0001-5078-390B433CDB01} ã‚„ãã®ä»–ã®è­˜åˆ¥å­ã‚’å…±æœ‰ã—ã¦ãŠã‚Šã€åŒã˜ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œã«å±ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚\næœ€åˆã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ (MessageNumber = 1) ã«ã¯ã€PowerShell ç’°å¢ƒã®è¨­å®šã‚„ã€func_get_proc_addressã€func_get_delegate_type ã¨ã„ã£ãŸé–¢æ•°ã®å®šç¾©ãªã©ã€ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å†’é ­éƒ¨åˆ†ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚\næœ€å¾Œã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ (MessageNumber = 33) ã«ã¯ã€Base64 æ–‡å­—åˆ—ï¼ˆã‚­ãƒ¼ 35 ã§ XOR ã•ã‚ŒãŸã‚‚ã®ï¼‰ã®ãƒ‡ã‚³ãƒ¼ãƒ‰ã‚„ã€ãƒ‡ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒ¡ãƒ¢ãƒªå‰²ã‚Šå½“ã¦éƒ¨åˆ†ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚\nã“ã‚Œã‚‰ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’åˆã‚ã›ã‚‹ã“ã¨ã§ã€ãƒ¡ãƒ¢ãƒªå†…ã«ã‚³ãƒ¼ãƒ‰ã‚’æ³¨å…¥ãƒ»å®Ÿè¡Œã™ã‚‹ãŸã‚ã®ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰å…¨ä½“ãŒå†æ§‹æˆã•ã‚Œã¾ã™ã€‚\nå†æ§‹æˆã•ã‚ŒãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ã€é›£èª­åŒ–ã•ã‚ŒãŸãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ï¼ˆã¾ãš Base64ã€æ¬¡ã« 35 ã§ XOR ã•ã‚ŒãŸã‚‚ã®ï¼‰ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã€ãƒã‚¤ãƒ†ã‚£ãƒ–ãª Windows é–¢æ•°ï¼ˆä¾‹: VirtualAlloc ã‚’ä»‹ã—ãŸ GetProcAddress ã‚„ GetDelegateForFunctionPointerï¼‰ã‚’ä½¿ç”¨ã—ã¦ãƒ¡ãƒ¢ãƒªã‚’å‰²ã‚Šå½“ã¦ã€æ‚ªæ„ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚\n[...] $var [...] -bxor 35 [...] Splunk æ¤œç´¢ã‚’ä½¿ç”¨ã—ã¦å†æ§‹æˆã™ã‚‹ã“ã¨ãŒã§ãã¾ã™:\nindex=* sourcetype=xmlwineventlog EventID=4104 0B39225B-3C43-0001-5078-390B433CDB01 | stats values(ScriptBlockText) as Script by SystemTime | table Script ãã®å¾Œã€Cyberchef ã‚’ä½¿ã£ã¦ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¾ã™:\nãã—ã¦ã€å•é¡Œã® DLL ãŒè¦‹ã¤ã‹ã‚Šã¾ã™:\næœ€å¾Œã«ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŠ½å‡ºã—ã€ãã®ãƒãƒƒã‚·ãƒ¥ã‚’å–å¾—ã—ã¾ã™:\nå›ç­”: 0ee6bc20a7f855d881cce962de09c77960ea5c85ca013e3d123fce61109ff8c5\nPersistence # è³ªå• 1 # æ‚ªæ„ã‚ã‚‹æ¥ç¶šãŒç¢ºç«‹ã•ã‚ŒãŸå¾Œã€ã‚·ã‚¹ãƒ†ãƒ ä¸Šã«ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚Œã¾ã—ãŸã€‚ã“ã®ãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ã¯ä½•ã§ã™ã‹ï¼Ÿ\n.rdp ãƒ•ã‚¡ã‚¤ãƒ«ãŒ 20:45:27 ã”ã‚ã«å®Ÿè¡Œã•ã‚ŒãŸã“ã¨ãŒåˆ†ã‹ã£ã¦ã„ã¾ã™ï¼ˆå®Ÿè¡Œã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è³ªå• 1 ã‚’å‚ç…§ï¼‰ã€‚\nãã®ãŸã‚ã€ãã®æ™‚åˆ»ã‹ã‚‰æ¤œç´¢ã‚’é–‹å§‹ã—ã¾ã™ã€‚\nã¾ãšã€PowerShell ã‚³ãƒãƒ³ãƒ‰ï¼ˆInvoke-WebRequestã€curl ãªã©ï¼‰ã‚’ä½¿ã£ã¦ Splunk ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’æ¤œç´¢ã—ã¦ã¿ã¾ã—ãŸãŒã€çµæœã¯å¾—ã‚‰ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚\nãã“ã§ã€æ¤œç´¢ã‚¯ã‚¨ãƒªã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã—ãŸ:\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; \u0026#34;rnichols\u0026#34; | rex field=_raw \u0026#34;CommandLine=(?\u0026lt;CommandLine\u0026gt;.*)\u0026#34; | fillnull value=\u0026#34;\u0026#34; | search NOT CommandLine=\u0026#34;\u0026lt;/Data\u0026gt;\u0026lt;/EventData\u0026gt;\u0026lt;/Event\u0026gt;\u0026#34;,\u0026#34;\u0026#34; | stats values(CommandLine) as CommandLine by _time, ParentCommandLine | sort â€” _time ãªãœã“ã‚ŒãŒå‹•ä½œã™ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ\nä»¥ä¸‹ã¯ã‚¤ãƒ™ãƒ³ãƒˆã®è©³ç´°ã§ã™:\nãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ TerminalSessionId=3 ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ RDP ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä»‹ã—ã¦æ¥ç¶šã—ã¦ã„ãŸã“ã¨ã‚’å¼·ãç¤ºå”†ã—ã¦ã„ã¾ã™ã€‚ãªãœãªã‚‰:\nã‚»ãƒƒã‚·ãƒ§ãƒ³ 0 ã¯ã—ã°ã—ã° SYSTEM ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚ ãƒ­ãƒ¼ã‚«ãƒ«ã®å¯¾è©±ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ é€šå¸¸ 1 ã‹ã‚‰å§‹ã¾ã‚Šã¾ã™ã€‚ RDP ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¯ã—ã°ã—ã°ã‚ˆã‚Šé«˜ã„ IDï¼ˆä¾‹: 2, 3 ãªã©ï¼‰ã‚’æŒã¡ã¾ã™ã€‚ explorer.exe ã¯ Windows ã®ã‚°ãƒ©ãƒ•ã‚£ã‚«ãƒ«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ä¸»è¦ãƒ—ãƒ­ã‚»ã‚¹ã§ã‚ã‚Šã€å¯¾è©±å‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèµ·å‹•ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®ãƒ©ãƒ³ãƒãƒ£ãƒ¼ã¨ã—ã¦æ©Ÿèƒ½ã—ã¾ã™ã€‚\nã“ã®å‹•ä½œã‚’èª¬æ˜ã™ã‚‹è€ƒãˆã‚‰ã‚Œã‚‹ã‚·ãƒŠãƒªã‚ª:\nå¯¾è©±ã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼ˆRDP ã§ã‚ã‚‹ã‹ã©ã†ã‹ã«ã‹ã‹ã‚ã‚‰ãšï¼‰:\nã‚‚ã— rnichols ãŒ RDP çµŒç”±ã§æ¥ç¶šã—ã¦ã„ã‚Œã°ã€explorer.exe ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚·ã‚§ãƒ«ã¨ã—ã¦èµ·å‹•ã—ã€Startup ã«å®šç¾©ã•ã‚ŒãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ï¼ˆztssvc.exeï¼‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç‰©ç†çš„ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸå ´åˆã‚„ã€runas ãªã©ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’é€šã˜ã¦ã‚‚åŒæ§˜ã®çŠ¶æ³ãŒç™ºç”Ÿã—ã¾ã™ã€‚ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«è‡ªå‹•å®Ÿè¡Œ:\nztssvc.exe ãŒ Startup ã«é…ç½®ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ã¨ã™ãã«å®Ÿè¡Œã•ã‚Œã¾ã™ï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ãƒ­ã‚°ã‚¤ãƒ³ã§ã‚‚ RDP çµŒç”±ã§ã‚‚ï¼‰ã€‚ explorer.exe ã‚’ä»‹ã—ãŸã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¾ãŸã¯æ°¸ç¶šåŒ–:\næ”»æ’ƒè€…ãŒ Startup ã‚’åˆ©ç”¨ã—ã¦ãƒãƒ«ã‚¦ã‚§ã‚¢ã‚’æŒç¶šã•ã›ãŸå ´åˆã€explorer.exe ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹ãŸã³ã«è‡ªå‹•çš„ã«ãã®ãƒã‚¤ãƒŠãƒªã‚’å®Ÿè¡Œã—ã¾ã™ã€‚ æ”»æ’ƒè€…ã«ã‚ˆã‚‹ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ã‚¤ãƒˆã¾ãŸã¯å¼·åˆ¶å®Ÿè¡Œ:\nã‚‚ã— explorer.exe ãŒï¼ˆä¾‹ãˆã° DLL ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ãªã©ã«ã‚ˆã‚Šï¼‰æ”¹ã–ã‚“ã•ã‚Œã¦ã„ã‚Œã°ã€ztssvc.exe ã‚’å®Ÿè¡Œã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã•ã‚ŒãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ å›ç­”: ztssvc.exe\nè³ªå• 2 # é•·æœŸçš„ãªã‚¢ã‚¯ã‚»ã‚¹ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã«ã€æ”»æ’ƒè€…ã¯ä¾µå®³ã•ã‚ŒãŸãƒã‚·ãƒ³ä¸Šã§ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã—ã¾ã—ãŸã€‚ã“ã®ã‚¿ã‚¹ã‚¯ã®åå‰ã¯ä½•ã§ã™ã‹ï¼Ÿ\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; EventCode=4698 OR EventCode=4702 | search user=\u0026#34;rnichols\u0026#34; | table _time EventCode TaskName Command User | rename EventCode as \u0026#34;Event ID\u0026#34;, TaskName as \u0026#34;Scheduled Task\u0026#34;, Command as \u0026#34;Executed Command\u0026#34; | sort _time è³ªå• 3 # æ°¸ç¶šæ€§æˆ¦ç•¥ã®ä¸€ç’°ã¨ã—ã¦ã€æ”»æ’ƒè€…ã¯æ–°ãŸãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚ã“ã®ä¸æ­£ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®åå‰ã¯ä½•ã§ã™ã‹ï¼Ÿ\nè³ªå• 1 ã¨åŒã˜ã‚¯ã‚¨ãƒªã‚’ä½¿ç”¨ã—ã¾ã™:\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; \u0026#34;rnichols\u0026#34; | rex field=_raw \u0026#34;CommandLine=(?\u0026lt;CommandLine\u0026gt;.*)\u0026#34; | fillnull value=\u0026#34;\u0026#34; | search NOT CommandLine=\u0026#34;\u0026lt;/Data\u0026gt;\u0026lt;/EventData\u0026gt;\u0026lt;/Event\u0026gt;\u0026#34;,\u0026#34;\u0026#34; | stats values(CommandLine) as CommandLine by _time, ParentCommandLine | sort â€” _time çµæœã®ä¸­ã«ã€éå¸¸ã«æ€ªã—ã’ãªã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸ PowerShell ã‚³ãƒãƒ³ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã™:\nã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’ Cyberchef ã‚’ä½¿ã£ã¦ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¾ã—ãŸ:\nå›ç­”: Administrator\nè³ªå• 4 # ãƒªãƒ¢ãƒ¼ãƒˆã‚¢ã‚¯ã‚»ã‚¹ã‚’å®¹æ˜“ã«ã™ã‚‹ãŸã‚ã€æ”»æ’ƒè€…ã¯ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã®è¨­å®šã‚’å¤‰æ›´ã—ã¾ã—ãŸã€‚RDP (Remote Desktop Protocol) æ¥ç¶šã®è¨±å¯ã‚’æ±ºå®šã™ã‚‹ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚­ãƒ¼ã®åå‰ã¯ä½•ã§ã™ã‹ï¼Ÿ\nå¤šæ•°ã® Windows ã‚·ã‚¹ãƒ†ãƒ ã®èª¿æŸ»ãƒ»ç®¡ç†çµŒé¨“ã‹ã‚‰ã€æ—¢ã«ç­”ãˆã¯åˆ†ã‹ã£ã¦ã„ã¾ã—ãŸãŒã€ç¢ºèªæ–¹æ³•ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™:\næ”»æ’ƒè€…ãŒå®Ÿè¡Œã—ãŸè¤‡æ•°ã® -EncodedCommand ã‚’å«ã‚€ PowerShell ã‚³ãƒãƒ³ãƒ‰ã‚’å¸¸ã«æ¤œç´¢ã—ã¾ã™:\nãã®ä¸­ã§ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ãŒç¢ºèªã§ãã¾ã™:\nå›ç­”: fDenyTSConnections\nè³ªå• 5 # ã•ã‚‰ãªã‚‹èª¿æŸ»ã«ã‚ˆã‚Šã€DC ä¸Šã§æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãŒä½œæˆã•ã‚ŒãŸã“ã¨ãŒåˆ¤æ˜ã—ã¾ã—ãŸã€‚ã“ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®åå‰ã¯ä½•ã§ã™ã‹ï¼Ÿ\nã“ã‚Œã¯ä»–ã®ãƒ›ã‚¹ãƒˆã§è¡Œã‚ã‚ŒãŸã®ã¨åŒã˜æ–¹æ³•ã§å®Ÿæ–½ã•ã‚ŒãŸã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚ãã“ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æ¤œç´¢ã—ã¾ã™:\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; host=\u0026#34;DC01\u0026#34; \u0026#34;-EncodedCommand\u0026#34; å›ç­”: rniclos\nç‰¹æ¨©æ˜‡æ ¼ # è³ªå• 1 # ç‰¹æ¨©æ˜‡æ ¼æ‰‹æ³•ã‚’èª¿æŸ»ã—ãŸéš›ã€æ”»æ’ƒè€…ãŒæ‚ªç”¨ã—ãŸç‰¹æ¨© COM ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã® CLSID ã®æœ€å¾Œã® 6 ãƒã‚¤ãƒˆã¯ä½•ã§ã™ã‹ï¼Ÿ\nCLSID ã¯ã€Windows COM (Component Object Model) ã«ãŠã„ã¦ã€ãƒ¬ã‚¸ã‚¹ãƒˆãƒªå†…ã® COM ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è­˜åˆ¥ã™ã‚‹ãŸã‚ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ã«ä¸€æ„ãªè­˜åˆ¥å­ (GUID) ã§ã™ã€‚\næ”»æ’ƒè€…ã¯ã€ç‰¹æ¨©ã‚’æŒã¤ COM ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã® CLSID ã‚’åˆ©ç”¨ã—ã¦ã€ã‚ˆã‚Šé«˜ã„æ¨©é™ã§ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š\nèª¤è¨­å®šã•ã‚ŒãŸ COM ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æ‚ªç”¨ã—ã¦ç‰¹æ¨©ã‚’æ˜‡æ ¼ã•ã›ã¾ã™ã€‚ æ”»æ’ƒè€…ã¯ regsvr32.exeã€powershellã€mshta.exeã€ã¾ãŸã¯ rundll32.exe ã‚’ä»‹ã—ã¦ã€ç‰¹æ¨© COM ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹* ã‚’ä½œæˆã€æ“ä½œã€ã¾ãŸã¯å‘¼ã³å‡ºã™ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚ ã“ã“ã§ã¯ã€ãƒãƒ«ã‚¦ã‚§ã‚¢ãŒ ztssvc.exe ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã£ã¦ã„ã‚‹ã®ã§ã€ztssvc.exe ã®å®Ÿè¡Œã«é–¢é€£ã™ã‚‹ EventCode \u0026ldquo;1\u0026rdquo;ï¼ˆãƒ—ãƒ­ã‚»ã‚¹ä½œæˆï¼‰ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ¤œç´¢ã—ã€IntegrityLevel ãŒ \u0026ldquo;High\u0026rdquo; ã®ã‚‚ã®ã ã‘ã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã—ã¾ã™:\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; EventCode=1 | search Image=\u0026#34;*ztssvc.exe*\u0026#34; | search IntegrityLevel=\u0026#34;High\u0026#34; | table _time User CommandLine IntegrityLevel ParentCommandLine | sort _time å›ç­”: 7CE93B6DC937\nè³ªå• 2 # ç‰¹æ¨©æ˜‡æ ¼ã®ãŸã‚ã«ã€æ”»æ’ƒè€…ã¯ã‚·ã‚¹ãƒ†ãƒ ä¸Šã«åˆ¥ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¾ã—ãŸã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ã¯ä½•ã§ã™ã‹ï¼Ÿ\næœ€åˆã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆztssvc.exeï¼‰ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¾Œã«ç™ºç”Ÿã—ãŸã™ã¹ã¦ã®å‹•ä½œã‚’ç¢ºèªã™ã‚‹ãŸã‚ã€åŒã˜ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™:\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; \u0026#34;rnichols\u0026#34; | rex field=_raw \u0026#34;CommandLine=(?\u0026lt;CommandLine\u0026gt;.*)\u0026#34; | fillnull value=\u0026#34;\u0026#34; | search NOT CommandLine=\u0026#34;\u0026lt;/Data\u0026gt;\u0026lt;/EventData\u0026gt;\u0026lt;/Event\u0026gt;\u0026#34;,\u0026#34;\u0026#34; | search NOT ParentCommandLine=\u0026#34;\u0026#34; | stats values(CommandLine) as CommandLine by _time, ParentCommandLine | sort â€” _time å›ç­”: Akagi64.exe\né˜²å¾¡å›é¿ # è³ªå• 1 # æ”»æ’ƒè€…ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã®å‹•ä½œã‚’å¤‰æ›´ã—ã¦ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®šã‚’å¼±ä½“åŒ–ã•ã›ã‚ˆã†ã¨è©¦ã¿ã¾ã—ãŸã€‚ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆåˆ¶å¾¡ (UAC) ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆè¨­å®šã‚’ç®¡ç†ã™ã‚‹ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚­ãƒ¼ã®åå‰ã¯ä½•ã§ã™ã‹ï¼Ÿ\nã“ã®å›ç­”ã¯ã€å…ˆã«è¦³å¯Ÿã•ã‚ŒãŸã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸ PowerShell ã‚³ãƒãƒ³ãƒ‰å†…ã«è¦‹ã¤ã‹ã‚Šã¾ã™:\nå›ç­”: ConsentPromptBehaviorAdmin\nè³ªå• 2 # æ¤œå‡ºã‚’å›é¿ã™ã‚‹ãŸã‚ã€æ”»æ’ƒè€…ã¯ã‚¿ã‚°ã‚’ä¿è­·ã•ã‚ŒãŸã‚·ã‚¹ãƒ†ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ã•ã›ã¾ã—ãŸã€‚ã“ã®ç§»å‹•ã•ã‚ŒãŸæ‚ªæ„ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ã¯ä½•ã§ã™ã‹ï¼Ÿ\nç§»å‹•ãŒè¡Œã‚ã‚ŒãŸå ´åˆã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆã¾ãŸã¯åå‰å¤‰æ›´ã®ã‚¤ãƒ™ãƒ³ãƒˆ (Event ID 11 ã¾ãŸã¯ 2) ãŒç™ºç”Ÿã—ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚\nindex=* sourcetype=xmlwineventlog EventCode=11 OR EventCode=2 \u0026#34;rnichols\u0026#34; | search TargetFilename=\u0026#34;C:\\\\Windows\\\\System32\\\\*\u0026#34; OR TargetFilename=\u0026#34;C:\\\\Windows\\\\SysWOW64\\\\*\u0026#34; OR TargetFilename=\u0026#34;C:\\\\ProgramData\\\\*\u0026#34; | table _time User TargetFilename ProcessName | sort _time å›ç­”: Amazon ZeroTrust Compl.exe\nç™ºè¦‹ # è³ªå• 1 # ä¾µå®³ã•ã‚ŒãŸãƒã‚·ãƒ³ä¸Šã§æ”»æ’ƒè€…ã®æœ€åˆã®è¡Œå‹•ã‚’ç‰¹å®šã™ã‚‹ãŸã‚ã€ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ã‚’åé›†ã™ã‚‹æœ€åˆã®ã‚³ãƒãƒ³ãƒ‰ã¯ä½•ã§ã—ãŸã‹ï¼Ÿ\nãƒã‚·ãƒ³ãŒ 20:45:27 ã«ä¾µå®³ã•ã‚ŒãŸã“ã¨ãŒåˆ†ã‹ã£ã¦ã„ã‚‹ã®ã§ï¼ˆå®Ÿè¡Œã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è³ªå• 1 ã‚’å‚ç…§ï¼‰ã€ãã®æ™‚åˆ»ã‹ã‚‰æ¤œç´¢ã‚’é–‹å§‹ã—ã¾ã™:\nindex=* sourcetype=\u0026#34;xmlwineventlog\u0026#34; \u0026#34;rnichols\u0026#34; | rex field=_raw \u0026#34;CommandLine=(?\u0026lt;CommandLine\u0026gt;.*)\u0026#34; | fillnull value=\u0026#34;\u0026#34; | search NOT CommandLine=\u0026#34;\u0026lt;/Data\u0026gt;\u0026lt;/EventData\u0026gt;\u0026lt;/Event\u0026gt;\u0026#34;,\u0026#34;\u0026#34; | search NOT ParentCommandLine=\u0026#34;\u0026#34; | stats values(CommandLine) as CommandLine by _time, ParentCommandLine | sort â€” _time å›ç­”: whoami /groups\næ¨ªæ–¹å‘ã®ç§»å‹• # è³ªå• 1 # æ”»æ’ƒè€…ã¯ã©ã®ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨ã—ã¦ DC ã¸ã®æ¨ªæ–¹å‘ã®ç§»å‹•ã‚’è¡Œã„ã¾ã—ãŸã‹ï¼Ÿ\nå†åº¦ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸ PowerShell ã‚³ãƒãƒ³ãƒ‰ã‚’èª¿æŸ»ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä»Šå›ã¯ã€Amazon ZeroTrust Compl.exe ã«ã‚ˆã£ã¦ç™ºè¡Œã•ã‚ŒãŸã‚³ãƒãƒ³ãƒ‰ã§ã™:\npowershell -nop -exec bypass -EncodedCommand UwBlAHQALQBJAHQAZQBtACAAVwBTAE0AYQBuADoAXABsAG8AYwBhAGwAaABvAHMAdABcAEMAbABpAGUAbgB0AFwAVAByAHUAcwB0AGUAZABIAG8AcwB0AHMAIAAtAFYAYQBsAHUAZQAgACIARABDADAAMQAuAGEAZAAuAGkAbgBmAGkAbgBuAGkAdABlAGMAaABzAG8AbAB1AHQAZQBuAHMALgB4AHkAegAiACAALQBGAG8AcgBjAGUA ã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã€IT01 ä¸Šã® Windows Remote Management (WinRM) ã®è¨­å®šã‚’å¤‰æ›´ã—ã€DC01.ad.infinitechsolutions.xyz ã‚’ãƒªãƒ¢ãƒ¼ãƒˆæ¥ç¶šç”¨ã«ä¿¡é ¼ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€PowerShell ãƒªãƒ¢ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ï¼ˆWinRMï¼‰ã‚’ä»‹ã—ãŸæ¨ªæ–¹å‘ã®ç§»å‹•ã®å¼·ã„æŒ‡æ¨™ã§ã™ã€‚\nå›ç­”: WinRM\nã‚³ãƒãƒ³ãƒ‰ï¼†ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« # è³ªå• 1 # æ”»æ’ƒè€…ã®æ´»å‹•ã‚’ãŸã©ã‚‹ã¨ã€æ‚ªæ„ã®ã‚ã‚‹ãƒ¡ãƒ¼ãƒ«ãŒé€ä¿¡ã•ã‚ŒãŸå…ƒã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ä½•ã§ã—ãŸã‹ï¼Ÿ\nãƒ•ã‚£ãƒƒã‚·ãƒ³ã‚°ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¤œç´¢ã™ã‚‹ã“ã¨ã§ã€æœ€åˆã®è³ªå•ã«æˆ»ã‚Šã¾ã™:\nindex=* sourcetype=syslog \u0026#34;User twhite@infinitechsolutions.xyz\u0026#34; å›ç­”: 3.78.253.99\nè³ªå• 2 # cloud zerotrust compliance.rdp ãŒ IT01 ã§å®Ÿè¡Œã•ã‚Œã€é€ä¿¡è€…ã®ãƒ¡ãƒ¼ãƒ« IP ã‚¢ãƒ‰ãƒ¬ã‚¹ãŒåˆ¤æ˜ã—ã¦ã„ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ã‚¯ã‚¨ãƒªã§ç›´æ¥ãƒ†ã‚¹ãƒˆã§ãã¾ã™:\nindex=* sourcetype=xmlwineventlog (EventCode=1 OR EventCode=3) | search host=\u0026#34;IT01\u0026#34; | search DestinationPort=3389 AND DestinationIp=3.78.253.99 | table _time User DestinationIp DestinationPort | sort _time å›ç­”: 3.78.253.99:3389\nè³ªå• 3 # è§£æã®çµæœã€ãƒ‰ãƒ­ãƒƒãƒ—ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒ Cobalt Strike ã®ãƒ“ãƒ¼ã‚³ãƒ³ã¨ã—ã¦æ©Ÿèƒ½ã—ã¦ã„ã‚‹ã“ã¨ãŒæ˜ã‚‰ã‹ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã®ãƒ“ãƒ¼ã‚³ãƒ³ãŒé€šä¿¡ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ï¼†ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ« (C\u0026amp;C) ã‚µãƒ¼ãƒãƒ¼ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ä½•ã§ã™ã‹ï¼Ÿ\nã¾ãšã€ã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒ Cobalt Strike ã®ãƒ“ãƒ¼ã‚³ãƒ³ã§ã‚ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™:\nãã®å¾Œã€Amazon ZeroTrust Compl.exe ãŒã©ã® IP/ãƒãƒ¼ãƒˆã«æ¥ç¶šã—ãŸã‹ã‚’èª¿æŸ»ã—ã¾ã™:\nindex=* sourcetype=xmlwineventlog EventCode=3 | search Image=\u0026#34;*Amazon ZeroTrust Compl.exe*\u0026#34; | search NOT DestinationIp=\u0026#34;\u0026#34; | table _time User Image DestinationIp DestinationPort Protocol | sort _time (EventCode 3 ã¯ã€Windows ãƒã‚·ãƒ³ä¸Šã®ãƒ—ãƒ­ã‚»ã‚¹ãŒç¢ºç«‹ã—ãŸãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã«å¯¾å¿œã—ã¾ã™)\nå›ç­”: 3.78.244.11:8080\nè³ªå• 4 # DLL ã®è¨­å®šã‚’èª¿æŸ»ã™ã‚‹ã¨ã€ãƒ“ãƒ¼ã‚³ãƒ³ã®é€šä¿¡ã‚’æŒ‡ç¤ºã™ã‚‹ \u0026lsquo;C2Server\u0026rsquo; ã‚­ãƒ¼ã«ã¯ã©ã®ã‚ˆã†ãªå€¤ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ\nVirusTotal ã«æˆ»ã‚Šã€ã€ŒBehaviorã€ã‚¿ãƒ–ã§ã“ã®æƒ…å ±ã‚’ç¢ºèªã—ã¾ã™ã€‚\nå›ç­”: 3.78.244.11,/dot.gif\nLab å®Œäº†ï¼\n","date":"2 March 2025","externalUrl":null,"permalink":"/blog-cyber/ja/posts/midnight-rdp/","section":"Posts","summary":"ã‚·ãƒŠãƒªã‚ª # InfiniTech Solutions ã® IT å¾“æ¥­å“¡ãŒã€è‡ªèº«ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«é–¢é€£ã™ã‚‹ç•°å¸¸ãªã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£ã‚’å ±å‘Šã—ã¾ã—ãŸã€‚èª¿æŸ»ã®çµæœã€ãã®å¾“æ¥­å“¡ã®æ¥­å‹™ç”¨èªè¨¼æƒ…å ±ãŒã€æœ€è¿‘ã®ãƒ‡ãƒ¼ã‚¿æ¼æ´©ã«ã‚ˆã‚Šæµå‡ºã—ã¦ã„ãŸã“ã¨ãŒåˆ¤æ˜ã—ã¾ã—ãŸã€‚","title":"Midnight RDP Lab","type":"posts"},{"content":"","date":"2 March 2025","externalUrl":null,"permalink":"/blog-cyber/ja/tags/splunk/","section":"Tags","summary":"","title":"Splunk","type":"tags"},{"content":"","date":"2 March 2025","externalUrl":null,"permalink":"/blog-cyber/ja/tags/threat-hunting/","section":"Tags","summary":"","title":"Threat Hunting","type":"tags"},{"content":"","date":"19 May 2024","externalUrl":null,"permalink":"/blog-cyber/en/tags/android-forensic/","section":"Tags","summary":"","title":"Android Forensic","type":"tags"},{"content":"","date":"19 May 2024","externalUrl":null,"permalink":"/blog-cyber/en/tags/autopsy/","section":"Tags","summary":"","title":"Autopsy","type":"tags"},{"content":"","date":"19 May 2024","externalUrl":null,"permalink":"/blog-cyber/en/tags/medium/","section":"Tags","summary":"","title":"Medium","type":"tags"},{"content":" Scenario # We have successfully confirmed the location of the malicious actor who compromised our governmentâ€™s WiFi network.\nRecently, a dawn raid was conducted as part of OP ERADICATE at an address in the Velorian capital, resulting in the seizure of a substantial amount of evidence. Notably, an Android device belonging to the agent was confiscated, and it is believed to have been at the scene of the attack.\nWe require your expertise to analyze this device and answer the detailed questions below. Time is limited; a Velorian COBR meeting has been organized to discuss your findings\u0026hellip;\nFiles # opshieldwall2.zip containing \u0026ldquo;EVIDENCE-CASE-RAVENSKIAN-AGENT-002,\u0026rdquo; which includes the \u0026ldquo;data\u0026rdquo; and \u0026ldquo;storage\u0026rdquo; folders of an Android device. This provides a significant amount of room for analysis, as the /data directory contains a wealth of information, such as:\nCheatsheet SANS FOR585 Foreword # Before we begin, here is some important information about Android:\nUser data on Android can be stored both internally and externally. Internal data is saved in NAND flash memory, a non-volatile memory that retains data even when the power is off. NAND stores the bootloader, the operating system, and user data. Application data is stored on NAND flash memory or on the SD card.\nAndroid is based on variants of the Long-Term Support (LTS) branches of the Linux Kernel. With Android v8 (Oreo), Google required the use of Linux Kernel version 4.4 or higher. For example, Android v9 (Pie) runs on versions 4.4, 4.9, or 4.14, depending on the device. More information is available on the Android OS wiki: https://source.android.com/docs/core/architecture/kernel/android-common?hl=en.\nandroid-mainline is the primary development branch for Android features. The mainline Linux branch is merged with android-mainline every time Linus Torvalds releases a version or release candidate:\nCommonly found file systems include:\nEXT4 F2FS YAFFS2 exFAT Most artifacts are stored as SQLite databases and XML files. Android isolates applications at the kernel level, assigning each one a unique identifier (UID) to track running applications.\nAndroid Architecture # The Linux kernel forms the foundation of Android, supporting essential features like threads and low-level memory management used by Android Runtime (ART).\nThe Hardware Abstraction Layer (HAL) provides standardized interfaces that expose hardware functionality to higher-level Java APIs. It consists of library modules specific to each hardware component (such as the camera or Bluetooth). When an API accesses hardware, Android loads the corresponding library module.\nThe Android Runtime (ART) environment runs each application in its own process and instance. ART manages multiple virtual machines on low-memory devices, using DEX bytecode specially designed and optimized for Android. Compilation tools like d8 transform Java code into DEX bytecode for execution on Android.\nMany essential Android system components and services, such as ART and HAL, are created from native code requiring native libraries written in C and C++.\nAndroid\u0026rsquo;s features are accessible via Java APIs, facilitating the reuse of key modular system components and services like notifications, resource management, and localization.\nSystem applications are the core set of apps that come with Android.\nAndroid Virtual Machine # Virtual Machines (VMs) act as abstraction layers between an application and the underlying Android device.\nEach application runs in its own instance within a VM, isolating it from other applications.\nAndroid applications are written in Java but are compiled into Java bytecode.\nThis bytecode is then transformed into Dalvik bytecode (.dex files) or ART bytecode.\nDalvik and ART run the bytecode (.dex) in a virtual machine, allowing applications to function independently of the underlying hardware.\nBefore KitKat (v.4.4), Android used Dalvik VMs.\nStarting with Lollipop (v5.0), Android began using Android Runtime (ART) and phased out Dalvik VM.\nBoth Dalvik and ART use DEX bytecode, but ART includes new optimization features.\nDirectory Structure # /cache: Can contain Gmail attachments, downloads, browsing data, and OTA updates. /efs: Contains files necessary for device operation in case of failure. /data: /data/data: Contains application folders (/data/data/com.example.app), app configuration files, SQLite databases, logs, cache, etc. /app: Stores .apk files from the Android market. *Malware may be found here. /backup: Stores backup APIs for developers; user backup data is not stored here. /media: Internal storage equivalent to an SD card. *Malware may be found here. /misc: Stores files related to Bluetooth, DHCP, VPN, Wi-Fi, etc. /system: Contains key files such as gesture.key and passwords.key; the accounts.db file, which stores usernames and passwords for file authentication, etc. /property: Stores system properties, including timezone, language settings, etc. /mnt: /asec: Stores unencrypted app data. /DCIM: Stores album thumbnails. /Pictures: Stores camera images. /downloads: Locally downloaded files. /secure/asec: Stores encrypted app data. /system: /app: Contains .apk files. *Malware may be found here. /priv-app: Contains .apk files with system-level permissions. *Malware may be found here. For more information on:\nApp permissions: https://developer.android.com/guide/topics/permissions/overview?hl=en, https://blog.mindorks.com/what-are-the-different-protection-levels-in-android-permission/ Android CLI: https://developer.android.com/tools/adb?hl=en Setup # Given the files and the scenario, I will use the Autopsy tool. Setting it up may take some time, so Iâ€™m starting with it here.\nIf you\u0026rsquo;re unfamiliar with Autopsy, hereâ€™s a brief description:\nAutopsy is an open-source digital investigation tool. It serves as the graphical interface for the Sleuth Kit and other forensic tools. It is commonly used to analyze hard drives and smartphones in the context of investigations. Key features of Autopsy include deleted file recovery, metadata analysis, keyword searching, timeline visualization, file system analysis, and more.\nTo use it, we need to create a \u0026ldquo;Case\u0026rdquo;:\nHere, we know weâ€™re not dealing with a \u0026ldquo;Disk Image\u0026rdquo; or a VM, nor a local disk. Therefore, we select the appropriate option, \u0026ldquo;Logical Files\u0026rdquo;:\nWe wait for Autopsy and its modules to complete the ingestion process. This may take some time.\nAll set, we can begin the investigation:\nQuestions # Question 1 # What is the email address used by the agent in various applications/services? To answer this, I will use the report generated by Autopsy via ALEAPP (Android Logs Events And Protobuf Parser), an open-source project aimed at parsing all known Android artifacts for forensic analysis.\nTo find it quickly and easily, we can search in:\n/data/data/com.android.vending/databases/library.db to find the Google account used to download apps. /data/data/com.android.providers.contacts/databases/contacts2.db to find the Google account used to sync contacts. Additionally (not applicable in this challenge):\n/data/com.android.vending/shared_prefs/lastaccount.xml (last account used on Google PlayStore for Android 9 and later). /data/com.google.android.gms/shared_prefs/BackupAccount.xml (email for backup account). /data/com.android.email/databases/EmailProvider.db (email accounts, 3rd-party app data, and messages associated with email notifications). Finally, we end up with the HTML report:\nThe email address can be found in various places.\nFor example, in the \u0026ldquo;Chrome\u0026rdquo; app under \u0026ldquo;Autofill\u0026rdquo; (a feature that automatically fills in forms with saved information):\nIn the Chrome \u0026ldquo;Login Data\u0026rdquo;:\nAnd in the \u0026ldquo;Installed Apps (Library)\u0026rdquo; section, we find the Google account email used for app downloads:\nAnswer: olegpachinksy@gmail.com\nQuestion 2 # What is the contact number of the handler assigned to the arrested agent?\nIn the \u0026ldquo;Contacts\u0026rdquo; section:\nAnswer: +323145232315\nQuestion 3 # Retrieve the credentials and link to the official portal for Ravenski agents. This could provide an intelligence advantage by using this access to gather actionable information about upcoming operations planned by the Ravenski government.\nWe already found the answer to this question in Question 1 via Chrome \u0026ldquo;Login Data\u0026rdquo;:\nAnswer: agent.ravensk.idu.com:olegpachinksy007:HBLKNKD0MADsdfsa2334(*\u0026amp;DSMDB\nQuestion 4 # What is the contact code used to confirm the identity of the agent and handler when using a secure chat channel?\nFirst, Iâ€™ll check for potential SMS messages here: /data/data/com.android.providers.telephony/databases/mmssms.db.\nNothing found.\nWe could also check here, though not applicable in this challenge:\n/data/com.google.android.gms/databases/icing_mmssms.db (SMS/MMS). /data/com.google.android.gms/databases/ipa_mmssms.db (SMS/MMS). We need to find the messaging app used. In Autopsyâ€™s \u0026ldquo;Installed Programs\u0026rdquo; section, we can view all installed apps:\nDifferent categories are shown:\nInstalled Apps (GMS) Installed Apps (Library) Installed Apps (Vending) Installed Apps - GMS: This category refers to apps installed on the device, regardless of their installation method. Data can be found here: /data/com.google.android.gms/databases/.\nInstalled Apps - Library: This category refers to the app library for the Google user on the device. It may contain apps installed by the same Google account on another device or a previous installation. Data is stored here: /data/com.android.vending/databases/.\nInstalled Apps - Vending: This category specifically refers to apps installed via the Google Play Store. Data is retained even if the app is uninstalled and is located here: /data/com.android.vending/databases/.\nFor clarity, letâ€™s return to ALEAPP and focus on \u0026ldquo;Vending\u0026rdquo; type apps:\nThe app that stands out is mega.privacy.android.app. Indeed, itâ€™s a messaging application:\nALEAPP has parsed messages exchanged via MEGA:\nWe can find this information here: /data/data/mega.privacy.android.app/karere-TU1IaTh4TUJpdTQKAfO_2P0qU8NMP7zDRlgv.db.\nAnswer: REDAPPLEONACAR\nQuestion 5 # The handler shared a document with the agent using a cloud storage service. When was this file shared with the agent?\nNothing found in messages. The document must have been sent another way. We know thereâ€™s no other messaging app, and it couldnâ€™t have been sent via SMS/MMS.\nIn the installed apps, we saw com.google.android.apps.docs. Letâ€™s check here: \\data\\data\\com.google.android.apps.docs.\nWe find the database /data/data/com.google.android.apps.docs/app_cello/olegpachinksy@gmail.com/cello.db containing this information:\nThe file can also be found here: EVIDENCE-CASE-RAVENSKIAN-AGENT-002/storage/emulated/0/Download/Debrief-Velorian OP Expansion East.pdf:\nNote: Autopsy interprets timestamps using your computerâ€™s time zone by default. Remember to adjust this setting in Autopsy (Tools \u0026gt; Options \u0026gt; View \u0026gt; Time Zone).\nAnswer: 2024-04-01 09:36:41\nQuestion 6 # What is the download URI for the previously identified shared file?\nWe know the file was downloaded, as we found it in /storage/emulated/0/Download/.\nThus, we can search in /data/data/com.android.providers.downloads/databases/downloads.db:\nAnswer: https://www.googleapis.com/drive/v2internal/files/1iQKKlBU2vuJD1Xet6IYPt7IODVtDHxv1?alt=media\u0026amp;source=downloadUrl\u0026amp;auditContext=fileAction\u0026amp;reason=909\u0026amp;syncType=1\u0026amp;featureLabel=android-sync-classic\u0026amp;openDrive=false\u0026amp;errorRecovery=false\u0026amp;originatorApp=102\nQuestion 7 # To gather further intelligence for Veloriaâ€™s counter-espionage efforts, what was the primary objective of this cyber operation led by the Ravenski government?\nReturning to the document:\nAnswer: Infiltrate the Velorian secured network to gather intelligence on upcoming cyber-attacks, their techniques, and target countries.\nQuestion 8 # Identifying the handler is also crucial for Velorian law enforcement to understand the scope of this operation. What is the handlerâ€™s email address?\nWe already saw this in the MEGA app messages:\nAnswer: ivoryalex783@gmail.com\nQuestion 9 # What is the name of the place where the agent and handler met?\nReturning to the messages:\nThis question took the most time; I spent about an hour on it.\nInitially, I searched the usual locations:\n/data/com.google.android.apps.maps/databases/gmm_storage.db /data/com.google.android.apps.maps/databases/search_history.db /data/com.google.android.apps.maps/databases/da_destination_history /data/com.sec.android.daemonapp/db/weatherClock /data/com.google.android.apps.maps/app_tts-cache/ /data/com.google.android.apps.maps/cache/image_manager_disk_cache/ After finding nothing, I thought the answer might be in the metadata of images on the phone. Indeed, there were 48 images, several of which showed bars:\nHowever, nothing conclusive.\nI then questioned:\nAre there other navigation/location apps on the phone? Is it certain I should look in the Google Maps app? No, only Google Maps. No, itâ€™s possible the search was made in the browser instead. After checking typical Google Maps artifacts, I decided to search in the browser but found nothing.\nSo I returned to digging through Google Maps artifacts:\napp: nothing relevant app_offline_downloads: nothing relevant app_offline_hashes: nothing relevant app_textures: nothing relevant app_webview: nothing relevant cache: nothing relevant databases: too many files, will revisit files: \u0026ldquo;new_recent_history_cache_search.cs\u0026rdquo; It turns out I could have simply searched for the keyword \u0026ldquo;Pub\u0026rdquo; ğŸ¤¡\nAnswer: Levstik Pub\nQuestion 10 # According to the chat between the agent and handler, it appears that the handler sent the agent an image related to the infrastructure used by the Ravenski government for this cyber-espionage operation. What C2 framework is used by the Ravenski government?\nHaving already reviewed all images for Question 9, I have the answer.\nAnswer: Empire\nQuestion 11 # Collecting information on infrastructure, such as IP addresses or hostnames, is crucial for Velorian authorities as they prepare a counter-offensive. Based on the recovered image sent by the handler to the agent, what is the IP address of one of the C2 servers operated by Ravenski threat actors?\nAnswer: 98.24.12.45\n","date":"19 May 2024","externalUrl":null,"permalink":"/blog-cyber/en/posts/opshieldwall-2/","section":"Posts","summary":"Scenario # We have successfully confirmed the location of the malicious actor who compromised our governmentâ€™s WiFi network.","title":"OpShieldWall-2","type":"posts"},{"content":"","date":"19 May 2024","externalUrl":null,"permalink":"/blog-cyber/en/tags/sherlock/","section":"Tags","summary":"","title":"Sherlock","type":"tags"},{"content":"","date":"19 May 2024","externalUrl":null,"permalink":"/blog-cyber/en/tags/","section":"Tags","summary":"","title":"Tags","type":"tags"},{"content":"","date":"7 May 2024","externalUrl":null,"permalink":"/blog-cyber/en/tags/easy/","section":"Tags","summary":"","title":"Easy","type":"tags"},{"content":"","date":"7 May 2024","externalUrl":null,"permalink":"/blog-cyber/en/tags/network-forensic/","section":"Tags","summary":"","title":"Network Forensic","type":"tags"},{"content":" Scenario # Thank you for responding to our call. The Ministry of Defense of Velorian is in desperate need of assistance\u0026hellip;\nWe need to keep this discreet, but we believe that the public WiFi at the Ministry of Defense offices in Velorian has been compromised. The impact seems minimal, but network diagrams show that no real segmentation of the network has been implemented and that device-to-device traffic is allowed. Government ministers use this network with BYoD equipment and Velorian MoDNet hosts. Please analyze the provided pcap file and confirm how and when this occurred. Remember that this investigation is classified as TLP Amber.\nFiles # opshieldwall1.zip containing the network capture \u0026ldquo;VELORIA-NETWORK.pcap\u0026rdquo; Setup # Given the simplicity of this challenge, we can limit ourselves to tshark / wireshark.\nQuestions # Question 1 # Please confirm the SSID of our WiFi network.\nFirst, letâ€™s get familiar with the capture. Weâ€™ll use the following command to gather some statistics:\n$ tshark -r traffic.pcapng -qz -r allows reading a file -q makes the output quieter (useful for stats as it displays global statistics, not per packet) -z enables statistics display There are many possible values (tshark -z help to display them), but here we primarily want to know:\nthe packet count the capture duration the IPv4 addresses with the most packets the IPv4 endpoints exchanging the most the most used protocols Packet count and duration: 106; 31.6 sec\n$ tshark -r VELORIA-NETWORK.pcap -qz io,stat,0 =================================== | IO Statistics | | | | Duration: 31.6 secs | | Interval: 31.6 secs | | | | Col 1: Frames and bytes | |---------------------------------| | |1 | | | Interval | Frames | Bytes | | |-------------------------------| | | 0.0 \u0026lt;\u0026gt; 31.6 | 106 | 20759 | | =================================== IPv4 endpoints:\nwith the most packets: $ tshark -r VELORIA-NETWORK.pcap -qz endpoints,ip ================================================================================ IPv4 Endpoints Filter:\u0026lt;No Filter\u0026gt; | Packets | | Bytes | | Tx Packets | | Tx Bytes | | Rx Packets | | Rx Bytes | 0.0.0.0 3 1044 3 1044 0 0 255.255.255.255 3 1044 0 0 3 1044 10.0.3.1 3 1048 3 1048 0 0 10.0.3.52 3 1048 0 0 3 1048 ================================================================================ exchanging the most: tshark -r VELORIA-NETWORK.pcap -qz conv,ip ================================================================================ IPv4 Conversations Filter:\u0026lt;No Filter\u0026gt; | \u0026lt;- | | -\u0026gt; | | Total | Relative | Duration | | Frames Bytes | | Frames Bytes | | Frames Bytes | Start | | 0.0.0.0 \u0026lt;-\u0026gt; 255.255.255.255 0 0 bytes 3 1044 bytes 3 1044 bytes 23.256576000 8.3680 10.0.3.1 \u0026lt;-\u0026gt; 10.0.3.52 0 0 bytes 3 1048 bytes 3 1048 bytes 23.256959000 8.3693 ================================================================================ Most used protocols:\ntshark -r VELORIA-NETWORK.pcap -qz io,phs =================================================================== Protocol Hierarchy Statistics Filter: sll frames:106 bytes:20759 radiotap frames:92 bytes:17572 wlan_radio frames:92 bytes:17572 wlan frames:92 bytes:17572 wlan.mgt frames:92 bytes:17572 eapol frames:6 bytes:999 eap frames:6 bytes:999 ip frames:6 bytes:2092 udp frames:6 bytes:2092 dhcp frames:6 bytes:2092 arp frames:2 bytes:96 =================================================================== To answer, we can simply use the command:\n$ tshark -r VELORIA-NETWORK.pcap -T fields -e wlan.ssid | head -n 1 | xxd -r -p VELORIA-MoD-AP012 Explication : (https://www.wireshark.org/docs/dfref/w/wlan.html)\n-t displays only user-specified fields (thus requiring the use of the -e option to specify fields) -e wlan.ssid specifies that the wlan.ssid field (SSID of wireless networks) should be extracted and displayed -xxd -r -p converts the output from hexadecimal to readable text Answer : VELORIA-MoD-AP012\nQuestion 2 # Please confirm the MAC address of the access point (AP).\ntshark -r VELORIA-NETWORK.pcap -T fields -e wlan.sa | head -n 1 02:00:00:00:01:00 Answer : 02:00:00:00:01:00\nQuestion 3 # Please confirm the APâ€™s authentication state/mechanism and attack vector.\nSwitching to Wireshark.\nAnswer : WPS\nQuestion 4 # What is the packet number where the attack began?\nWe can easily deduce that itâ€™s at the first connection attempt (the only one in the capture).\nAnswer : 93\nQuestion 5 # What is the packet number where the attack ended?\nItâ€™s clear that it ends when the authentication fails.\nAnswer : 8\n","date":"7 May 2024","externalUrl":null,"permalink":"/blog-cyber/en/posts/opshieldwall-1/","section":"Posts","summary":"Scenario # Thank you for responding to our call.","title":"OpShieldWall-1","type":"posts"},{"content":" Diplomas # The images are clickable links.\nIn progress Masterâ€™s Degree (BAC+5) - Expert in Data, Network, and System Security\nOnly available through work-study programs\nhttps://www.francecompetences.fr/recherche/rncp/38951/ Bachelorâ€™s Degree (BAC+3) - Cybersecurity \u0026 Ethical Hacking\n3rd year in work-study program\nWith Highest Honour Bachelorâ€™s Degree (BAC+3) - Network and Systems Architect\nWith Highest Honour List of all the challenges, labs, boxes, etc., that I have completed, as well as conferences and trainings I have attended:\nHackTheBox # Iron = Insane Red = Hard Orange = Medium Green = Easy Purple = Very Easy Some images do not link to the HTB result pages as they are boxes/Sherlocks only available on the HackTheBox Enterprise platform (which does not allow for shareable links).\nSherlock # DFIR / SOC # OpShieldWall-7 Heartbreaker Trent APTNightmare OpShieldWall-4 OpShieldWall-2 OpShieldWall-1 Jingle Bell Recollection Noted Tracer Log Jammer Rogue One CrownJewel-2 CrownJewel-1 Brutus Malware Analysis # OpShieldWall-6 Loggy Heartbreaker Cloud # Nubilum-2 Box # Linux # OpShieldWall-5 OpShieldWall-3 Blurry Runner IClean Perfection BoardLight Headless Wifinetic MetaTwo Lame Nibbles Precious Windows # Jerry Netmon Blue HackTheBox Academy # Transcript.pdf\nRootMe # Cyberdefenders # Threat Hunting # Hard Network Forensics # Hard Medium Medium Medium Medium Medium Easy Easy Easy Easy Easy Easy Easy Easy Endpoint Forensics # Medium Easy Threat Intel # Medium Medium Easy Easy Easy Easy Cloud Forensics # Easy TryHackMe # 92 rooms completed\nPath :\nPre Security Complete Beginner Web Fundamentals Comptia Pentest+ Cours # OALABS : Reverse Engineering 101 (RE101) Evasive Malware : A Field Guide to Detecting, Analyzing, and Defeating Advanced Threats (Kyle Cucci - no starch press) Kaspersky : Advanced Malware Analysis Techniques Kaspersky : Hunting APTs like a Ninja with YARA 13Cubed : Investigating Windows Endpoint 13Cubed : Investigating Windows Memory Roman Stuehler : Android App Hacking - Black Belt Edition Pentherz : Intro to SDR Hacking Christopher Negus : Linux Bible OSINT (Open Source Intelligence Techniques) : IntelTechniques Opdisk : The Cyber Plumber\u0026rsquo;s Handbook Conf \u0026amp; meetups # 2024 # DEFCON Paris Meetups HTB France 2023 # Hexacon DEFCON Paris LeHack HTB Meetups France ","date":"6 May 2024","externalUrl":null,"permalink":"/blog-cyber/en/posts/portfolio/","section":"Posts","summary":"Diplomas # The images are clickable links.","title":"Portfolio","type":"posts"},{"content":" Self-Hosted Infrastructure # Juin 2023 - maintenant\nProfessional Server (HP ProLiant DL380 Gen9 2U) running Proxmox Firewall running OPNsense Self-hosted services and tools: VPN, Security Onion, Wazuh, Cuckoo Sandbox, GitLab, CTF machines, various labs (red team / blue team) A special Malware Analysis lab \u0026amp; OSINT lab with security, privacy and OPSEC in mind Architecture, network segmentation, IPS/IDS integration, load balancing, SRE, VPN CTF Challenge Creator # Juin 2024 - Juin 2024\nCreation of two radio challenges (misc easy and medium) for the \u0026ldquo;PwnMe CTF 2024\u0026rdquo;.\nhttps://ctftime.org/ctf/807/\nhttps://www.phreaks2600.fr/\nSide Quest - Toolkit Network Forensic \u0026amp; Malware Analysis # FÃ©vr. 2024 - Juin 2024\nOur Side Quest is a collaborative student project designed to provide a powerful toolkit for network forensic analysis and malware analysis. This repository contains two sub-projects that focus on different aspects of investigation:\nNetwork Forensic Analysis: Tools for analyzing network traffic captured in PCAP files. Malware Analysis: Tools for dissecting binary files to uncover hidden information and detect malicious characteristics. https://github.com/jaybird1291/toolkit-network-forensic-malware-analysis-sidequest\n","date":"5 May 2024","externalUrl":null,"permalink":"/blog-cyber/en/posts/projets/","section":"Posts","summary":"Self-Hosted Infrastructure # Juin 2023 - maintenant","title":"Projets","type":"posts"},{"content":"","externalUrl":null,"permalink":"/blog-cyber/en/authors/","section":"Authors","summary":"","title":"Authors","type":"authors"},{"content":"","externalUrl":null,"permalink":"/blog-cyber/en/categories/","section":"Categories","summary":"","title":"Categories","type":"categories"},{"content":"","externalUrl":null,"permalink":"/blog-cyber/en/series/","section":"Series","summary":"","title":"Series","type":"series"}]